#!/bin/sh

set -e

#INCLUDE_SHELL_LIB#

if [ "$1" = "triggered" ]; then
	for triggername in $2; do
		case "$triggername" in
			# new "bundled" extensions (since 3.3)
			"/@OOBRANDDIR@/share/extensions")
			  sync_extensions
			;;
			"/@OOBASISDIR@/registered-components")
			  update_services_rdb
			;;
		esac
	done
fi

if [ "$1" = "configure" ]; then
	if dpkg-maintscript-helper supports rm_conffile; then
		dpkg-maintscript-helper rm_conffile "/etc/bash_completion.d/ooffice.sh" 1:3.3.0~rc4-2 libreoffice-common -- "$@"
	fi
 
	if dpkg-maintscript-helper supports mv_conffile; then
		dpkg-maintscript-helper mv_conffile \
			"/etc/openoffice/psprint.conf" "/etc/libreoffice/psprint.conf" "" libreoffice-common -- "$@"
		dpkg-maintscript-helper mv_conffile \
			"/etc/openoffice/sofficerc" "/etc/libreoffice/sofficerc" "" libreoffice-common -- "$@"
		dpkg-maintscript-helper mv_conffile \
			"/etc/openoffice/soffice.sh" "/etc/libreoffice/soffice.sh" "" libreoffice-common -- "$@"
	fi

	# try to remove, hopefully empty now
	rmdir /etc/openoffice 2>/dev/null || true

	if dpkg --compare-versions "$2" lt "1:3.3.0-3"; then
		dpkg-trigger /@OOBRANDDIR@/share/extensions
	fi
	if dpkg --compare-versions "$2" lt "1:3.4.0-1"; then
		dpkg-trigger /@OOBASISDIR@/registered-components
	fi
fi

#DEBHELPER#

