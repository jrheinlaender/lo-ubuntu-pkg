--- /dev/null	2011-02-09 23:43:13.080975836 +0100
+++ libreoffice-3.3.1/libreoffice-build/patches/dev300/arm-optimization.diff	2011-02-19 17:42:32.000000000 +0100
@@ -0,0 +1,137 @@
+--- configure.in-old	2011-02-20 18:17:53.000000000 +0100
++++ configure.in	2011-02-20 18:20:55.000000000 +0100
+@@ -1256,6 +1256,16 @@
+                           can get up to CPUS*max_jobs. Defaults to 1, unless
+                           you configure --enable-icecream - then to 10.
+ ],,)
++AC_ARG_WITH(arm-target,
++[  --arm-target        The minimal targeted arm processor
++                          used for the build environment.
++                          Cases :
++                            arm-target < 6 : armv4t compatibility
++                            arm-target = 6 : exact armv6 compatibility
++                           arm-target > 6 : armv7-a compatibility
++
++                          Usage: --with-arm-target=7
++],with_arm_target=$withval,with_arm_target=4)
+ 
+ BUILD_TYPE="OOo"
+ 
+@@ -1354,6 +1364,25 @@
+ AC_SUBST(PTHREAD_LIBS)
+ 
+ dnl ===================================================================
++dnl Check the ARM target
++dnl ===================================================================
++
++if test "$_os" = "Linux" && echo "$build_cpu" | $GREP -q arm; then
++    # default value
++    ARM_TARGET=ARMV4T
++    AC_MSG_CHECKING([which ARM processor optimization to use])
++    if test "$with_arm_target" -lt "6"; then
++	ARM_TARGET=ARMV4T
++    elif test "$with_arm_target" = "6"; then
++	ARM_TARGET=ARMV6
++    elif test "$with_arm_target" -gt "6"; then
++	ARM_TARGET=ARMV7
++    fi
++    AC_MSG_RESULT([$ARM_TARGET])
++    AC_SUBST(ARM_TARGET)
++fi
++
++dnl ===================================================================
+ dnl Set the ENABLE_CRASHDUMP variable.
+ dnl ===================================================================
+ AC_MSG_CHECKING([whether to enable crashdump feature])
+diff -r 67e476e04669 sal/osl/unx/interlck.c
+--- sal/osl/unx/interlck.c	Fri Nov 12 20:02:04 2010 +0100
++++ sal/osl/unx/interlck.c	Fri Feb 18 21:47:58 2011 +0100
+@@ -134,6 +134,54 @@
+     return nCount;
+ }
+ 
++#elif defined ( GCC ) && defined ( ARM )
++
++/*****************************************************************************/
++/* osl_incrementInterlockedCount */
++/*****************************************************************************/
++oslInterlockedCount SAL_CALL osl_incrementInterlockedCount(oslInterlockedCount* pCount)
++{
++#if defined( ARMV7 ) || defined( ARMV6 )
++    register oslInterlockedCount nCount __asm__ ("r1");
++    int nResult;
++
++    __asm__ __volatile__ (
++"1:	ldrex %0, [%3]\n"
++"	add %0, %0, #1\n"
++"	strex %1, %0, [%3]\n"
++"	teq %1, #0\n"
++"	bne 1b"
++        : "=&r" (nCount), "=&r" (nResult), "=m" (*pCount)
++        : "r" (pCount)
++        : "memory");
++
++    return nCount;
++#else
++    return __sync_add_and_fetch( pCount, 1 );
++#endif
++}
++
++oslInterlockedCount SAL_CALL osl_decrementInterlockedCount(oslInterlockedCount* pCount)
++{
++#if defined( ARMV7 ) || defined( ARMV6 )
++    register oslInterlockedCount nCount __asm__ ("r1");
++    int nResult;
++
++    __asm__ __volatile__ (
++"0:	ldrex %0, [%3]\n"
++"	sub %0, %0, #1\n"
++"	strex %1, %0, [%3]\n"
++"	teq %1, #0\n"
++"	bne 0b"
++        : "=&r" (nCount), "=&r" (nResult), "=m" (*pCount)
++        : "r" (pCount)
++        : "memory");
++    return nCount;
++#else
++    return __sync_sub_and_fetch( pCount, 1 );
++#endif
++}
++
+ #else
+ /* use only if nothing else works, expensive due to single mutex for all reference counts */
+ 
+diff -r 67e476e04669 set_soenv.in
+--- set_soenv.in	Fri Nov 12 20:02:04 2010 +0100
++++ set_soenv.in	Fri Feb 18 21:47:58 2011 +0100
+@@ -1694,6 +1694,7 @@
+ ToFile( "SET_EXCEPTIONS",    $SET_EXCEPTIONS,    "e" );
+ ToFile( "use_shl_versions",  $use_shl_versions,  "e" );
+ ToFile( "FLIPCMD",           $FLIPCMD,           "e" );
++ToFile( "ARM_TARGET",          "@ARM_TARGET@",     "e" );
+ #
+ # Writing the variables to file.
+ # (c = comment, e = environment variable, a = alias, n = newline )
+diff -r 67e476e04669 solenv/inc/unxlngr.mk
+--- solenv/inc/unxlngr.mk	Fri Nov 12 20:02:04 2010 +0100
++++ solenv/inc/unxlngr.mk	Fri Feb 18 21:47:58 2011 +0100
+@@ -32,3 +32,19 @@
+ CDEFS+=-DARM32
+ CFLAGS+=-fno-omit-frame-pointer
+ DLLPOSTFIX=lr
++
++.IF "$(ARM_TARGET)" == "ARMV4T"
++ARCH_FLAGS+=-march=armv4t
++CDEFS+=-DARMV4T
++.ENDIF
++
++.IF "$(ARM_TARGET)" == "ARMV6"
++ARCH_FLAGS+=-march=armv6
++CDEFS+=-DARMV6
++.ENDIF
++
++.IF "$(ARM_TARGET)" == "ARMV7"
++ARCH_FLAGS+=-march=armv7-a -mtune=cortex-a8 -mfpu=neon
++CDEFS+=-DARMV7
++.ENDIF
++
--- libreoffice-3.3.1/libreoffice-build/patches/dev300/apply-old	2011-02-19 17:44:18.000000000 +0100
+++ libreoffice-3.3.1/libreoffice-build/patches/dev300/apply	2011-02-19 17:45:10.000000000 +0100
@@ -34,7 +34,7 @@
 	      KDE4Experimental, MinGW, CalcExperimental, \
 	      OOXMLExportExperimental, CrossWin32Patches, AutoLayout, \
 	      WriterNavigation \
-	      HPPA, AXP, Speed, GSoC2010, Toolbars
+	      HPPA, AXP, ARM, Speed, GSoC2010, Toolbars
 DebianLooseSections: DebianBaseNoHelpContent
 # Optional sections
 Optional : LiberationFontsOnWindows, NovellOnlyExtensionFixes
@@ -66,7 +66,7 @@
 # Slackware
 Slackware : LinuxCommon, SlackwareOnly, NotDebian, Mono, msaccess
 # Debian
-DebianBase : LinuxCommon, DebianBaseOnly, GCCSTL, BerkeleyDB43, Split, PostgreSQL
+DebianBase : LinuxCommon, DebianBaseOnly, GCCSTL, BerkeleyDB43, Split, PostgreSQL, ARM
 Debian : DebianBase, DebianOnly, DebianSidOnly, Debian32Only, HPPA, AXP, kFreeBSD
 DebianEtch : DebianBase, DebianOnly, DebianEtchOnly, Debian32Only
 # Ubuntu
@@ -2386,3 +2386,7 @@
 
 [ TemporaryHacks ]
 hack-no-rm-fr-of-smoketest-userconfig.diff
+
+[ ARM ]
+arm-optimization.diff
+
