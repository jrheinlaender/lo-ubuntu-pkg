From: Debian LibreOffice Maintainers <debian-openoffice@lists.debian.org>
Date: Sat, 9 Nov 2013 02:00:27 +0100
Subject: [PATCH] fix-system-lpsolve-build.diff

Change-Id: Ibe23717730dfb8365b738e366d083ffae9cfbe5a

---
 RepositoryExternal.mk | 2 +-
 configure.ac          | 3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/RepositoryExternal.mk b/RepositoryExternal.mk
--- a/RepositoryExternal.mk
+++ b/RepositoryExternal.mk
@@ -2157,7 +2157,7 @@ ifneq ($(ENABLE_LPSOLVE),)
 ifneq ($(SYSTEM_LPSOLVE),)
 
 define gb_LinkTarget__use_lpsolve
-$(call gb_LinkTarget_add_libs,$(1),-llpsolve55)
+$(call gb_LinkTarget_add_ldflags,$(1),-Wl$(COMMA)--no-as-needed /usr/lib/lp_solve/liblpsolve55.so -Wl$(COMMA)-rpath=/usr/lib/lp_solve)
 $(call gb_LinkTarget_add_defs,$(1),\
 	-DSYSTEM_LPSOLVE \
 )
diff --git a/configure.ac b/configure.ac
--- a/configure.ac
+++ b/configure.ac
@@ -9640,8 +9640,9 @@ if test "$ENABLE_LPSOLVE" = TRUE; then
         # some systems need this. Like Ubuntu....
         AC_CHECK_LIB(m, floor)
         AC_CHECK_LIB(dl, dlopen)
+        AC_CHECK_LIB(colamd, colamd)
         AC_CHECK_LIB([lpsolve55], [make_lp], [:],
-            [ AC_MSG_ERROR(lpsolve library not found or too old.)], [])
+            [ AC_MSG_ERROR(lpsolve library not found or too old.)], [-L/usr/lib/lpsolve])
         LIBS=$save_LIBS
         libo_MINGW_CHECK_DLL([lpsolve55])
     else
-- 
1.9.1

