From: Debian LibreOffice Maintainers <debian-openoffice@lists.debian.org>
Date: Sat, 9 Nov 2013 02:00:25 +0100
Subject: [PATCH] gcj-safe-jni-h-include.diff

Change-Id: Iccce595463659ce0979694b8e27865b8dd68fec1
---
 config_host.mk.in | 2 +-
 configure.ac      | 4 +++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/config_host.mk.in b/config_host.mk.in
--- a/config_host.mk.in
+++ b/config_host.mk.in
@@ -470,7 +470,7 @@ export SCPDEFS=@SCPDEFS@
 export SDKDIRNAME=@SDKDIRNAME@
 export SDKDIRNAME_FOR_BUILD=@SDKDIRNAME_FOR_BUILD@
 export SHOWINCLUDES_PREFIX=@SHOWINCLUDES_PREFIX@
-export SOLARINC=@SOLARINC@
+export SOLARINC=@SOLARINC@ @GCJ_JNI_INCLUDE@
 export SOLARLIB=@SOLARLIB@
 export SPLIT_APP_MODULES=@SPLIT_APP_MODULES@
 export SPLIT_OPT_FEATURES=@SPLIT_OPT_FEATURES@
diff --git a/configure.ac b/configure.ac
index 053fc51..84b323c 100644
--- a/configure.ac
+++ b/configure.ac
@@ -7212,12 +7240,18 @@ if test -n "$ENABLE_JAVA" -a -z "$JAVAINC"; then
     k*bsd*-gnu*)
         JAVAINC="-I$JAVA_HOME/include"
         test -d "$JAVA_HOME/include/native_thread" && JAVAINC="$JAVAINC -I$JAVA_HOME/include/native_thread"
+	if test "$JDK" = "gcj"; then
+		JAVAINC="$JAVAINC -I`$JAVA_HOME/bin/gcj --print-file-name include/jni.h | $SED -e s,\/jni.h,,g`"
+	fi
         ;;
 
     linux-gnu*)
         JAVAINC="-I$JAVA_HOME/include"
         JAVAINC="$JAVAINC -I$JAVA_HOME/include/linux"
         test -d "$JAVA_HOME/include/native_thread" && JAVAINC="$JAVAINC -I$JAVA_HOME/include/native_thread"
+	if test "$JDK" = "gcj"; then
+		JAVAINC="$JAVAINC -I`$JAVA_HOME/bin/gcj --print-file-name include/jni.h | $SED -e s,\/jni.h,,g`"
+	fi
         ;;
 
     mingw*)
