From: Debian LibreOffice Maintainers <debian-openoffice@lists.debian.org>
Date: Sat, 9 Nov 2013 02:00:39 +0100
Subject: [PATCH] javadoc-optional.diff

Change-Id: Ia839387250d13d67098c60dab8a6575990883164
---

Index: libreoffice-4.3.0~beta1/odk/Module_odk.mk
===================================================================
--- libreoffice-4.3.0~beta1.orig/odk/Module_odk.mk	2014-05-27 09:41:05.057841099 +0200
+++ libreoffice-4.3.0~beta1/odk/Module_odk.mk	2014-05-27 09:41:05.041841100 +0200
@@ -43,11 +43,13 @@
 $(eval $(call gb_Module_add_targets,odk,\
 	$(if $(and $(BUILD_UNOWINREG),$(filter GCC,$(COM))),CustomTarget_unowinreg)\
 	CustomTarget_classes \
-	CustomTarget_javadoc \
-	GeneratedPackage_odk_javadoc \
 	GeneratedPackage_uno_loader_classes \
 	$(if $(filter WNT,$(OS)),Library_unowinreg) \
 	Package_unowinreg \
+	$(if $(JAVADOC),\
+		CustomTarget_javadoc \
+		GeneratedPackage_odk_javadoc \
+	) \
 ))
 endif
 
Index: libreoffice-4.3.0~beta1/configure.ac
===================================================================
--- libreoffice-4.3.0~beta1.orig/configure.ac	2014-05-27 09:41:05.057841099 +0200
+++ libreoffice-4.3.0~beta1/configure.ac	2014-05-27 09:41:05.049841100 +0200
@@ -1933,6 +1933,18 @@
     ],,
     [with_doxygen=yes])
 
+AC_ARG_WITH(
+    [javadoc],
+    AS_HELP_STRING(
+        [--with-javadoc],
+        [Specifies the javadoc executable to use when generating ODK Java
+         documentation. --without-javadoc disables generation of ODK Java
+         documentation. Not relevant in the --disable-odk case.])
+    [
+                          Usage:     --with-javadoc=<absolute path to doxygen executable>
+    ],,
+    [with_javadoc=yes])
+
 AC_ARG_WITH(visual-studio,
     AS_HELP_STRING([--with-visual-studio=<2012/2010/2013>],
         [Specify which Visual Studio version to use in case several are
@@ -7020,35 +7032,45 @@
 dnl ===================================================================
 dnl Checks for javadoc
 dnl ===================================================================
-if test "$ENABLE_JAVA" != ""; then
+if test "$ENABLE_JAVA" != "" -a "$enable_odk" != no; then
     if test -z "$with_jdk_home"; then
         AC_PATH_PROG(JAVADOC, javadoc)
     else
-        _javadoc_path="$with_jdk_home/bin/javadoc"
-        dnl Check if there is a javadoc at all.
-        if test -x "$_javadoc_path"; then
-            JAVADOC=$_javadoc_path
-        else
-            AC_PATH_PROG(JAVADOC, javadoc)
-        fi
-    fi
-    if test -z "$JAVADOC"; then
-        AC_MSG_ERROR([$_javadoc_path not found set with_jdk_home])
-    fi
-    if test "$build_os" = "cygwin"; then
-        if test x`echo "$JAVADOC" | $GREP -i '\.exe$'` = x; then
-            JAVADOC="${JAVADOC}.exe"
-        fi
-        JAVADOC=`cygpath -d "$JAVADOC"`
-        JAVADOC=`cygpath -u "$JAVADOC"`
-    fi
+        if test "$with_javadoc" = "yes"; then
+            _javadoc_path="$with_jdk_home/bin/javadoc"
+            dnl Check if there is a javadoc at all.
+            if test -x "$_javadoc_path"; then
+                JAVADOC=$_javadoc_path
+            else
+                AC_PATH_PROG(JAVADOC, javadoc)
+            fi
+            if test -z "$JAVADOC"; then
+                AC_MSG_ERROR([$_javadoc_path not found set with_jdk_home])
+            fi
+            if test "$build_os" = "cygwin"; then
+                if test x`echo "$JAVADOC" | $GREP -i '\.exe$'` = x; then
+                    JAVADOC="${JAVADOC}.exe"
+                fi
+                JAVADOC=`cygpath -d "$JAVADOC"`
+                JAVADOC=`cygpath -u "$JAVADOC"`
+            fi
 
-    if test `$JAVADOC --version 2>&1 | $GREP -c "gjdoc"` -gt 0; then
-    JAVADOCISGJDOC="yes"
+            if test `$JAVADOC --version 2>&1 | $GREP -c "gjdoc"` -gt 0; then
+            JAVADOCISGJDOC="yes"
+            fi
+        else
+	    unset JAVADOC
+	fi
     fi
+else
+    unset JAVADOC
 fi
 AC_SUBST(JAVADOCISGJDOC)
 
+if test "$JAVADOCISGJDOC" = "yes"; then
+	unset JAVADOC
+fi
+
 if test "$ENABLE_JAVA" != ""; then
     # check if JAVA_HOME was (maybe incorrectly?) set automatically to /usr
     if test "$JAVA_HOME" = "/usr" -a "x$with_jdk_home" = "x"; then
Index: libreoffice-4.3.0~beta1/scp2/InstallModule_sdkoo.mk
===================================================================
--- libreoffice-4.3.0~beta1.orig/scp2/InstallModule_sdkoo.mk	2014-05-27 09:41:05.057841099 +0200
+++ libreoffice-4.3.0~beta1/scp2/InstallModule_sdkoo.mk	2014-05-27 09:41:05.049841100 +0200
@@ -17,6 +17,12 @@
 ))
 endif
 
+ifneq ($(JAVADOC),)
+$(eval $(call gb_InstallModule_add_defs,scp2/sdkoo,\
+	-DJAVADOC \
+))
+endif
+
 $(eval $(call gb_InstallModule_add_scpfiles,scp2/sdkoo,\
     scp2/source/sdkoo/sdkoo \
 ))
Index: libreoffice-4.3.0~beta1/scp2/source/sdkoo/sdkoo.scp
===================================================================
--- libreoffice-4.3.0~beta1.orig/scp2/source/sdkoo/sdkoo.scp	2014-05-27 09:41:05.057841099 +0200
+++ libreoffice-4.3.0~beta1/scp2/source/sdkoo/sdkoo.scp	2014-05-27 09:41:05.049841100 +0200
@@ -126,6 +126,7 @@
 End
 
 #if defined(ENABLE_JAVA)
+#if defined(JAVADOC)
 File gid_File_Package_odk_javadoc
     TXT_FILE_BODY;
     Dir = FILELIST_SDK_DIR;
@@ -133,6 +134,7 @@
     Styles = (FILELIST,USE_INTERNAL_RIGHTS);
 End
 #endif
+#endif
 
 File gid_File_Package_odk_lib
     TXT_FILE_BODY;
