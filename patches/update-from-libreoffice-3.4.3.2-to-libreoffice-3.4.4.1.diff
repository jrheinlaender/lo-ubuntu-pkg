--- /dev/null	2011-10-26 22:10:13.700940099 +0200
+++ libreoffice/libreoffice-build/patches/hotfixes/update-from-libreoffice-3.4.3.2-to-libreoffice-3.4.4.1.diff	2011-10-27 13:30:51.307478172 +0200
@@ -0,0 +1,6680 @@
+reverting on repository artwork from libreoffice-3.4.3.2 to merge-base b22f33f85962d8a55e0adf46912bd5290b359295
+commits on repository artwork merge-base b22f33f85962d8a55e0adf46912bd5290b359295 to libreoffice-3.4.4.1
+reverting on repository base from libreoffice-3.4.3.2 to merge-base 9a78d6c3fc8febc2e53e3d9e73e6a5cdf1461574
+commits on repository base merge-base 9a78d6c3fc8febc2e53e3d9e73e6a5cdf1461574 to libreoffice-3.4.4.1
+From 3c7a0b5d5455805210262529fbd9815aed6fe267 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Thu, 29 Sep 2011 23:02:56 +0100
+Subject: [base 1/3] tweak ambiguities for F-15 gcc 4.6.1-9
+
+---
+ .../source/core/dataaccess/databasedocument.cxx    |   19 ++++++++++++++-----
+ dbaccess/source/ui/browser/unodatbr.cxx            |    6 +++---
+ .../source/ui/querydesign/TableWindowAccess.cxx    |    6 +++++-
+ reportdesign/source/filter/xml/xmlExport.cxx       |   16 ++++++++--------
+ reportdesign/source/ui/report/ReportController.cxx |    3 ++-
+ reportdesign/source/ui/report/ReportSection.cxx    |    6 +++++-
+ 6 files changed, 37 insertions(+), 19 deletions(-)
+
+diff --git a/dbaccess/source/core/dataaccess/databasedocument.cxx b/dbaccess/source/core/dataaccess/databasedocument.cxx
+index c72d7f7..e1c7347 100644
+--- dbaccess/source/core/dataaccess/databasedocument.cxx
++++ dbaccess/source/core/dataaccess/databasedocument.cxx
+@@ -1696,10 +1696,13 @@ void ODatabaseDocument::disposing()
+     ::osl::ClearableMutexGuard aGuard( m_aMutex );
+ 
+     OSL_ENSURE( m_aControllers.empty(), "ODatabaseDocument::disposing: there still are controllers!" );
+-        // normally, nobody should explicitly dispose, but only XCloseable::close the document. And upon
+-        // closing, our controllers are closed, too
++    // normally, nobody should explicitly dispose, but only XCloseable::close
++    // the document. And upon closing, our controllers are closed, too
+ 
+-    aKeepAlive.push_back( m_xUIConfigurationManager );
++    {
++        uno::Reference<uno::XInterface> xUIInterface = m_xUIConfigurationManager;
++        aKeepAlive.push_back( xUIInterface );
++    }
+     m_xUIConfigurationManager = NULL;
+ 
+     clearObjectContainer( m_xForms );
+@@ -1721,10 +1724,16 @@ void ODatabaseDocument::disposing()
+     OSL_ENSURE( m_aControllers.empty(), "ODatabaseDocument::disposing: there still are controllers!" );
+     impl_disposeControllerFrames_nothrow();
+ 
+-    aKeepAlive.push_back( m_xModuleManager );
++    {
++        uno::Reference<uno::XInterface> xModuleInterface = m_xModuleManager;
++        aKeepAlive.push_back( xModuleInterface );
++    }
+     m_xModuleManager.clear();
+ 
+-    aKeepAlive.push_back( m_xTitleHelper );
++    {
++        uno::Reference<uno::XInterface> xTitleInterface = m_xTitleHelper;
++        aKeepAlive.push_back( xTitleInterface );
++    }
+     m_xTitleHelper.clear();
+ 
+     m_pImpl.clear();
+diff --git a/dbaccess/source/ui/browser/unodatbr.cxx b/dbaccess/source/ui/browser/unodatbr.cxx
+index 017794d..37f0880 100644
+--- dbaccess/source/ui/browser/unodatbr.cxx
++++ dbaccess/source/ui/browser/unodatbr.cxx
+@@ -781,7 +781,7 @@ sal_Bool SbaTableQueryBrowser::InitializeGridModel(const Reference< ::com::sun::
+                         if ( xSupplier.is() )
+                             aInitialValues.push_back( NamedValue( ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("FormatsSupplier")), makeAny( xSupplier ) ) );
+                         aInitialValues.push_back( NamedValue( ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("TreatAsNumber")), makeAny( (sal_Bool)bFormattedIsNumeric ) ) );
+-                        aCopyProperties.push_back( PROPERTY_FORMATKEY );
++                        aCopyProperties.push_back( static_cast<const rtl::OUString&>(PROPERTY_FORMATKEY) );
+                         break;
+                 }
+ 
+@@ -814,8 +814,8 @@ sal_Bool SbaTableQueryBrowser::InitializeGridModel(const Reference< ::com::sun::
+                     aInitialValues.push_back( NamedValue( sDefaultProperty, aDefault ) );
+ 
+                 // transfer properties from the definition to the UNO-model :
+-                aCopyProperties.push_back( PROPERTY_HIDDEN );
+-                aCopyProperties.push_back( PROPERTY_WIDTH );
++                aCopyProperties.push_back( static_cast<const rtl::OUString&>(PROPERTY_HIDDEN) );
++                aCopyProperties.push_back( static_cast<const rtl::OUString&>(PROPERTY_WIDTH) );
+ 
+                 // help text to display for the column
+                 Any aDescription;
+diff --git a/dbaccess/source/ui/querydesign/TableWindowAccess.cxx b/dbaccess/source/ui/querydesign/TableWindowAccess.cxx
+index 9ffe63e..eac0c75 100644
+--- dbaccess/source/ui/querydesign/TableWindowAccess.cxx
++++ dbaccess/source/ui/querydesign/TableWindowAccess.cxx
+@@ -254,7 +254,11 @@ namespace dbaui
+             ::std::vector< Reference<XInterface> > aRelations;
+             aRelations.reserve(5); // just guessing
+             for (; aIter != aEnd ; ++aIter )
+-                aRelations.push_back(getParentChild(aIter - pConnectionList->begin()));
++            {
++                uno::Reference<uno::XInterface> xInterface =
++                    getParentChild(aIter - pConnectionList->begin());
++                aRelations.push_back(xInterface);
++            }
+             
+             Reference<XInterface> *pRelations = aRelations.empty() ? 0 : &aRelations[0];
+             Sequence< Reference<XInterface> > aSeq(pRelations, aRelations.size());
+diff --git a/reportdesign/source/filter/xml/xmlExport.cxx b/reportdesign/source/filter/xml/xmlExport.cxx
+index b0f6db2..1f37f3a 100644
+--- reportdesign/source/filter/xml/xmlExport.cxx
++++ reportdesign/source/filter/xml/xmlExport.cxx
+@@ -1201,15 +1201,15 @@ void ORptExport::exportAutoStyle(XPropertySet* _xProp,const Reference<XFormatted
+             if ( !aPos.X )
+             {
+                 sBorderProp = PROPERTY_BORDERLEFT;
+-                aProps.push_back(PROPERTY_BORDERRIGHT);
++                aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERRIGHT));
+             }
+             else
+             {
+                 sBorderProp = PROPERTY_BORDERRIGHT;
+-                aProps.push_back(PROPERTY_BORDERLEFT);
++                aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERLEFT));
+             }
+-            aProps.push_back(PROPERTY_BORDERTOP);
+-            aProps.push_back(PROPERTY_BORDERBOTTOM);
++            aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERTOP));
++            aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERBOTTOM));
+         }
+         else // horizontal
+         {
+@@ -1217,15 +1217,15 @@ void ORptExport::exportAutoStyle(XPropertySet* _xProp,const Reference<XFormatted
+             if ( (aPos.Y + aSize.Height) == nSectionHeight )
+             {
+                 sBorderProp = PROPERTY_BORDERBOTTOM;
+-                aProps.push_back(PROPERTY_BORDERTOP);
++                aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERTOP));
+             }
+             else
+             {
+                 sBorderProp = PROPERTY_BORDERTOP;
+-                aProps.push_back(PROPERTY_BORDERBOTTOM);
++                aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERBOTTOM));
+             }
+-            aProps.push_back(PROPERTY_BORDERRIGHT);
+-            aProps.push_back(PROPERTY_BORDERLEFT);
++            aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERRIGHT));
++            aProps.push_back(static_cast<const rtl::OUString&>(PROPERTY_BORDERLEFT));
+         }
+ 
+         xBorderProp->setPropertyValue(sBorderProp,uno::makeAny(aValue));
+diff --git a/reportdesign/source/ui/report/ReportController.cxx b/reportdesign/source/ui/report/ReportController.cxx
+index 2ff973f..38407f1 100644
+--- reportdesign/source/ui/report/ReportController.cxx
++++ reportdesign/source/ui/report/ReportController.cxx
+@@ -257,7 +257,8 @@ void lcl_getReportControlFormat(const Sequence< PropertyValue >& aArgs,
+     }
+     else
+     {
+-        _rControlsFormats.push_back(xReportControlFormat);
++        uno::Reference<uno::XInterface> xInterface = xReportControlFormat;
++        _rControlsFormats.push_back(xInterface);
+     }
+ 
+     if ( !_xWindow.is() )
+diff --git a/reportdesign/source/ui/report/ReportSection.cxx b/reportdesign/source/ui/report/ReportSection.cxx
+index 66b5658..af6947f 100644
+--- reportdesign/source/ui/report/ReportSection.cxx
++++ reportdesign/source/ui/report/ReportSection.cxx
+@@ -726,7 +726,11 @@ void OReportSection::fillControlModelSelection(::std::vector< uno::Reference< un
+             const SdrObject* pDlgEdObj = rMarkList.GetMark(i)->GetMarkedSdrObj();
+             const OObjectBase* pObj = dynamic_cast<const OObjectBase*>(pDlgEdObj);
+             if ( pObj )
+-                _rSelection.push_back(pObj->getReportComponent());
++            {
++                uno::Reference<uno::XInterface> xInterface =
++                    pObj->getReportComponent();
++                _rSelection.push_back(xInterface);
++            }
+         }
+     }
+ }
+-- 
+1.7.5.4
+
+
+From 718e2912d031280a52991157ffc024c5516eec32 Mon Sep 17 00:00:00 2001
+From: Julien Nabet <serval2412@yahoo.fr>
+Date: Sat, 22 Oct 2011 11:26:20 +0200
+Subject: [base 2/3] Fix fdo#38286. Perhaps it could be simplified
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ dbaccess/source/ui/querydesign/QueryDesignView.cxx |   13 ++++++++++++-
+ 1 files changed, 12 insertions(+), 1 deletions(-)
+
+diff --git a/dbaccess/source/ui/querydesign/QueryDesignView.cxx b/dbaccess/source/ui/querydesign/QueryDesignView.cxx
+index be56580..a94ead0 100644
+--- dbaccess/source/ui/querydesign/QueryDesignView.cxx
++++ dbaccess/source/ui/querydesign/QueryDesignView.cxx
+@@ -3193,7 +3193,18 @@ void OQueryDesignView::fillFunctionInfo(  const ::connectivity::OSQLParseNode* p
+     OQueryController& rController = static_cast<OQueryController&>(getController());
+     sal_Int32 nDataType = DataType::DOUBLE;
+     ::rtl::OUString sFieldName = sFunctionTerm;
+-    OSQLParseNode* pFunctionName = pNode->getChild(0);
++    const OSQLParseNode* pFunctionName;
++    // Fix fdo#38286 : crash when constant in the query
++    // TODO : is it possible to have a child or children in the pNode ?
++    // if not this part could be simplified
++    if (pNode->count()) 
++    {
++        pFunctionName = pNode->getChild(0);
++    }
++    else
++    {
++        pFunctionName = pNode;
++    }
+     if ( !SQL_ISPUNCTUATION(pFunctionName,"{") )
+     {
+         if ( SQL_ISRULEOR2(pNode,length_exp,char_value_fct) )
+-- 
+1.7.5.4
+
+reverting on repository binfilter from libreoffice-3.4.3.2 to merge-base 
+commits on repository binfilter merge-base  to libreoffice-3.4.4.1
+reverting on repository bootstrap from libreoffice-3.4.3.2 to merge-base def034082faa8411092ab4b8f0e20fdd2b5f1e46
+diff --git a/bin/distro-install-clean-up b/bin/distro-install-clean-up
+index 4d134fe..7283bb9 100755
+--- bin/distro-install-clean-up
++++ bin/distro-install-clean-up
+@@ -59,7 +59,7 @@ if test -f $DESTDIR$INSTALLDIR/help/en/sbasic.cfg -a \
+ fi
+ 
+ echo "Fixing permissions..."
+-for dir in $DESTDIR$DOCDIR $DESTDIR$INSTALLDIR/basis$PRODUCTVERSION/sdk/examples ; do
++for dir in $DOCDIR $DESTDIR$INSTALLDIR/basis$PRODUCTVERSION/sdk/examples ; do
+     if test -d $dir -a -w $dir ; then
+ 	find "$dir" -type f \( -name "*.txt" -o -name "*.java" -o -name "*.xml"    -o \
+ 			       -name "*.xcu" -o -name "*.xcs"  -o -name "*.html"   -o \
+diff --git a/instsetoo_native/util/openoffice.lst b/instsetoo_native/util/openoffice.lst
+index 58e8b24..c561eaf 100644
+--- instsetoo_native/util/openoffice.lst
++++ instsetoo_native/util/openoffice.lst
+@@ -57,7 +57,7 @@ LibreOffice
+ 			PRODUCTVERSION 3.4
+ 			PRODUCTEXTENSION 
+ 			LONG_PRODUCTEXTENSION 
+-			SHORT_PRODUCTEXTENSION rc2
++			SHORT_PRODUCTEXTENSION rc1
+             POSTVERSIONEXTENSION
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+@@ -125,7 +125,7 @@ LibreOffice_wJRE
+ 			PRODUCTVERSION 3.4
+ 			PRODUCTEXTENSION 
+ 			LONG_PRODUCTEXTENSION 
+-			SHORT_PRODUCTEXTENSION rc2
++			SHORT_PRODUCTEXTENSION rc1
+             POSTVERSIONEXTENSION
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+@@ -189,7 +189,7 @@ LibreOffice_Dev
+ 			PRODUCTVERSION 3.4
+ 			PRODUCTEXTENSION 
+ 			LONG_PRODUCTEXTENSION 
+-			SHORT_PRODUCTEXTENSION rc2
++			SHORT_PRODUCTEXTENSION rc1
+ 			BASISROOTNAME LibO-dev
+ 			UNIXBASISROOTNAME lo-dev
+             POSTVERSIONEXTENSION
+@@ -266,7 +266,7 @@ URE
+             PRODUCTEXTENSION
+             BRANDPACKAGEVERSION 3.4
+             LONG_PRODUCTEXTENSION
+-            SHORT_PRODUCTEXTENSION rc2
++            SHORT_PRODUCTEXTENSION rc1
+             LICENSENAME LGPL
+             SETSTATICPATH 1
+             NOVERSIONINDIRNAME 1
+@@ -305,7 +305,7 @@ LibreOffice_SDK
+             PRODUCTVERSION 3.4
+             PRODUCTEXTENSION
+             LONG_PRODUCTEXTENSION
+-            SHORT_PRODUCTEXTENSION rc2
++            SHORT_PRODUCTEXTENSION rc1
+             POSTVERSIONEXTENSION SDK
+             POSTVERSIONEXTENSIONUNIX sdk
+             BRANDPACKAGEVERSION 3.4
+@@ -351,7 +351,7 @@ LibreOffice_Dev_SDK
+             PRODUCTVERSION 3.4
+             PRODUCTEXTENSION
+             LONG_PRODUCTEXTENSION
+-            SHORT_PRODUCTEXTENSION rc2
++            SHORT_PRODUCTEXTENSION rc1
+             BASISROOTNAME LibO-dev
+             UNIXBASISROOTNAME lo-dev
+             POSTVERSIONEXTENSION SDK
+@@ -403,7 +403,7 @@ OxygenOffice
+ 			PRODUCTVERSION 3.4
+ 			PRODUCTEXTENSION
+ 			LONG_PRODUCTEXTENSION
+-			SHORT_PRODUCTEXTENSION  rc2
++			SHORT_PRODUCTEXTENSION  rc1
+             POSTVERSIONEXTENSION
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+@@ -473,7 +473,7 @@ OxygenOffice_wJRE
+ 			PRODUCTVERSION 3.4
+ 			PRODUCTEXTENSION
+ 			LONG_PRODUCTEXTENSION
+-			SHORT_PRODUCTEXTENSION rc2
++			SHORT_PRODUCTEXTENSION rc1
+             POSTVERSIONEXTENSION
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+diff --git a/solenv/inc/minor.mk b/solenv/inc/minor.mk
+index baf7096..f8749b1 100644
+--- solenv/inc/minor.mk
++++ solenv/inc/minor.mk
+@@ -1,5 +1,5 @@
+ RSCVERSION=340
+-RSCREVISION=340m1(Build:302)
+-BUILD=302
++RSCREVISION=340m1(Build:301)
++BUILD=301
+ LAST_MINOR=m1
+ SOURCEVERSION=OOO340
+commits on repository bootstrap merge-base def034082faa8411092ab4b8f0e20fdd2b5f1e46 to libreoffice-3.4.4.1
+From aabeb64cc0be9fe0eb840323b835ace956bdb65f Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Tom=C3=A1=C5=A1=20Chv=C3=A1tal?= <tchvatal@suse.cz>
+Date: Wed, 17 Aug 2011 11:33:55 +0200
+Subject: [bootstrap 01/18] Fixup non-respecting DESTDIR for DOCDIR chmod.
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ bin/distro-install-clean-up |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/bin/distro-install-clean-up b/bin/distro-install-clean-up
+index 7283bb9..4d134fe 100755
+--- bin/distro-install-clean-up
++++ bin/distro-install-clean-up
+@@ -59,7 +59,7 @@ if test -f $DESTDIR$INSTALLDIR/help/en/sbasic.cfg -a \
+ fi
+ 
+ echo "Fixing permissions..."
+-for dir in $DOCDIR $DESTDIR$INSTALLDIR/basis$PRODUCTVERSION/sdk/examples ; do
++for dir in $DESTDIR$DOCDIR $DESTDIR$INSTALLDIR/basis$PRODUCTVERSION/sdk/examples ; do
+     if test -d $dir -a -w $dir ; then
+ 	find "$dir" -type f \( -name "*.txt" -o -name "*.java" -o -name "*.xml"    -o \
+ 			       -name "*.xcu" -o -name "*.xcs"  -o -name "*.html"   -o \
+-- 
+1.7.5.4
+
+
+From d28849246ede712e15f6961ff38c85be868d2a8c Mon Sep 17 00:00:00 2001
+From: Martin Hosken <martin_hosken@sil.org>
+Date: Tue, 23 Aug 2011 11:43:18 +0100
+Subject: [bootstrap 02/18] Upgrade graphite to 1.0.2 and simplify patches
+
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>
+---
+ ooo.lst.in |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/ooo.lst.in b/ooo.lst.in
+index 3652a39..cbf1fb6 100644
+--- ooo.lst.in
++++ ooo.lst.in
+@@ -79,7 +79,7 @@ debc62758716a169df9f62e6ab2bc634-zlib-1.2.3.tar.gz
+ 0ff7d225d087793c8c2c680d77aac3e7-mdds_0.5.3.tar.bz2
+ f02578f5218f217a9f20e9c30e119c6a-boost_1_44_0.tar.bz2
+ 9ed97fce60a9a65852402248a6659492-hunspell-1.3.1.tar.gz
+-0625a7d661f899a8ce263fc8a9879108-graphite2-0.9.2.tgz
++3115c721f5cb7c464f01c2dddccfaba6-graphite2-1.0.2.tgz
+ http://download.go-oo.org/extern
+ 185d60944ea767075d27247c3162b3bc-unowinreg.dll
+ b4cae0700aa1c2aef7eb7f345365e6f1-translate-toolkit-1.8.1.tar.bz2
+-- 
+1.7.5.4
+
+
+From 4d8c9ee2da4020871d037b1bcc7bfbdd7b149046 Mon Sep 17 00:00:00 2001
+From: Rene Engelhard <rene@debian.org>
+Date: Tue, 23 Aug 2011 18:04:10 +0200
+Subject: [bootstrap 03/18] export WORDS_BIGENDIAN in set_soenv and make
+ graphite2 use it
+
+---
+ set_soenv.in |    1 +
+ 1 files changed, 1 insertions(+), 0 deletions(-)
+
+diff --git a/set_soenv.in b/set_soenv.in
+index 4c047b6..124ae91 100755
+--- set_soenv.in
++++ set_soenv.in
+@@ -1839,6 +1839,7 @@ ToFile( "SOLARINC",          $SOLARINC,          "e" );
+ ToFile( "COMP_ENV",          $COMP_ENV,          "e" );
+ ToFile( "JAVAHOME",          $JAVAHOME,          "e" );
+ ToFile( "CC",                $CC,                "e" );
++ToFile( "WORDS_BIGENDIAN",      "@WORDS_BIGENDIAN@", "e" ); 
+ ToFile( "HAVE_GCC_VISIBILITY_FEATURE",
+ 		"@HAVE_GCC_VISIBILITY_FEATURE@", "e" );
+ ToFile( "HAVE_GCC_VISIBILITY_BROKEN",
+-- 
+1.7.5.4
+
+
+From 59372c82d6ede44c2e3f502611c7dbde909b090f Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sat, 27 Aug 2011 19:02:47 +0200
+Subject: [bootstrap 04/18] Use jdk1.6.0_27 for OxygenOffice
+
+---
+ distro-configs/OxygenOfficeLinux.conf |    2 +-
+ distro-configs/OxygenOfficeWin32.conf |    2 +-
+ 2 files changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/distro-configs/OxygenOfficeLinux.conf b/distro-configs/OxygenOfficeLinux.conf
+index a1a4327..0fc70fa 100644
+--- distro-configs/OxygenOfficeLinux.conf
++++ distro-configs/OxygenOfficeLinux.conf
+@@ -51,7 +51,7 @@
+ --without-system-poppler
+ --enable-neon
+ --without-system-stdlibs
+---with-jdk-home=/usr/local/jdk1.6.0_23/
++--with-jdk-home=/usr/local/jdk1.6.0_27/
+ --without-system-dicts
+ --without-system-xrender-headers
+ --without-system-zlib
+diff --git a/distro-configs/OxygenOfficeWin32.conf b/distro-configs/OxygenOfficeWin32.conf
+index ba6f999..98be7ff 100644
+--- distro-configs/OxygenOfficeWin32.conf
++++ distro-configs/OxygenOfficeWin32.conf
+@@ -35,7 +35,7 @@
+ --disable-ext-oooblogger
+ --with-sun-templates
+ --disable-cairo
+---with-jdk-home=/usr/local/jdk1.6.0_23/
++--with-jdk-home=/usr/local/jdk1.6.0_27/
+ --without-junit
+ --with-helppack-integration
+ --enable-cairo
+-- 
+1.7.5.4
+
+
+From 1c1c427a53c3e210a396ed45af18d2fff721a25a Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 7 Aug 2011 18:04:15 +0000
+Subject: [bootstrap 05/18] Update Diagram extension to SmART Gallery
+
+* SmART Gallery is the new version of Diagram extension (aka. Diagram 2)
+
+Signed-off-by: Kalman Szalai - KAMI <kami911@gmail.com>
+---
+ configure.in |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 0d3a1cb..958f8f1 100755
+--- configure.in
++++ configure.in
+@@ -18,7 +18,7 @@ AC_ARG_ENABLE(ext-barcode,
+ 
+ AC_ARG_ENABLE(ext-diagram,
+     AS_HELP_STRING([--enable-ext-diagram],
+-        [Enables the Diagram extension.]),
++        [Enables the SmART Gallery (Diagram) extension.]),
+ ,)
+ 
+ AC_ARG_ENABLE(ext-google-docs,
+-- 
+1.7.5.4
+
+
+From 35f952ebfa678dd07a5636b9826a0992c59b5dee Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 28 Aug 2011 00:06:37 +0200
+Subject: [bootstrap 06/18] Update Diagram extension to SmART Gallery
+
+* SmART Gallery is the new version of Diagram extension (aka. Diagram 2)
+---
+ configure.in |    6 +++---
+ 1 files changed, 3 insertions(+), 3 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 958f8f1..32ff3f8 100755
+--- configure.in
++++ configure.in
+@@ -7197,16 +7197,16 @@ fi
+ AC_SUBST(WATCH_WINDOW_EXTENSION_PACK)
+ 
+ dnl ===================================================================
+-dnl Test whether to include Diagram extension
++dnl Test whether to include SmART Gallery (Diagram) extension
+ dnl ===================================================================
+-AC_MSG_CHECKING([for Diagram extension integration])
++AC_MSG_CHECKING([for SmART Gallery (Diagram) extension integration])
+ if test "z$enable_ext_diagram" = "z" -o "z$enable_ext_diagram" = "zno" ; then
+   AC_MSG_RESULT([no])
+   DIAGRAM_EXTENSION_PACK=""
+ else
+   AC_MSG_RESULT([yes])
+   SCPDEFS="$SCPDEFS -DWITH_EXTENSION_DIAGRAM"
+-  DIAGRAM_EXTENSION_PACK="41c9b65ad60af4b3255bbecdfef11736-Diagram_1.1.0.0.oxt"
++  DIAGRAM_EXTENSION_PACK="DIAGRAM_EXTENSION_PACK="4a433efb6d385264ebc1d5513782d51c-SmART_0.9.4.oxt"
+ fi
+ AC_SUBST(DIAGRAM_EXTENSION_PACK)
+ 
+-- 
+1.7.5.4
+
+
+From 74b02d845439b53ac0eb68eb63fe80aa4b19a6b0 Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 7 Aug 2011 19:35:10 +0000
+Subject: [bootstrap 07/18] Update supported Lightproof versions to the latest
+ available
+
+---
+ configure.in |    4 ++--
+ 1 files changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 32ff3f8..840509f 100755
+--- configure.in
++++ configure.in
+@@ -7171,8 +7171,8 @@ else
+     if test "$with_lang" = "ALL" -o -n "`echo $with_lang | grep "$lang"`" ; then
+         LIGHTPROOF_LANG="$LIGHTPROOF_LANG $lang"
+         case $lang in
+-        "hu") LIGHTPROOF_HU_PACK="324ddcb9ef45c3bc055fcc002bc4e556-lightproof-hu_1.2.oxt";;
+-        "en-US") LIGHTPROOF_EN_US_PACK="942541da5f5498214518c8b459ae4524-lightproof-en-US_0.1.oxt";;
++            "hu") LIGHTPROOF_HU_PACK="76345f925e34fef2d29bade4f29108e9-lightproof-hu_1.3.oxt";;
++            "en-US") LIGHTPROOF_EN_US_PACK="0ab55ac8e88f04258f1d3e79e984382f-lightproof-en-US_0.1.oxt";;
+     esac
+     fi
+     done
+-- 
+1.7.5.4
+
+
+From 5d3c664b148ddb72f64b45717088dc2b25933bc9 Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 7 Aug 2011 19:39:46 +0000
+Subject: [bootstrap 08/18] Update Google Docs extension to version 3.0.0
+
+Signed-off-by: Kalman Szalai - KAMI <kami911@gmail.com>
+---
+ configure.in |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 840509f..6734290 100755
+--- configure.in
++++ configure.in
+@@ -7305,7 +7305,7 @@ if test "z$enable_ext_google_docs" = "z" -o "z$enable_ext_google_docs" = "zno" ;
+ else
+   AC_MSG_RESULT([yes])
+   SCPDEFS="$SCPDEFS -DWITH_EXTENSION_GOOGLE_DOCS"
+-  GOOGLE_DOCS_EXTENSION_PACK="dbaafd21de055e582d92d7d32fe9da13-gdocs_2.3.1.oxt"
++  GOOGLE_DOCS_EXTENSION_PACK="31d7e111b1135f14717f21255d933f6e-ooo2gd_3.0.0.oxt"
+ fi
+ AC_SUBST(GOOGLE_DOCS_EXTENSION_PACK)
+ 
+-- 
+1.7.5.4
+
+
+From 6bf0be067e8da2597013296dae3f4e02866a5064 Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 7 Aug 2011 19:54:04 +0000
+Subject: [bootstrap 09/18] Added Russian language Lightproof module
+
+* Added module
+* Remove versioned directories in scp2 module for Lightproof
+
+Signed-off-by: Kalman Szalai - KAMI <kami911@gmail.com>
+---
+ configure.in                                    |    5 ++++-
+ download                                        |    2 +-
+ ooo.lst.in                                      |    1 +
+ scp2/source/extensions/directory_extensions.scp |    5 +++--
+ scp2/source/extensions/file_extensions.scp      |    1 +
+ set_soenv.in                                    |    1 +
+ 6 files changed, 11 insertions(+), 4 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 6734290..06505c4 100755
+--- configure.in
++++ configure.in
+@@ -7151,7 +7151,7 @@ if test "z$enable_ext_lightproof" = "z" -o "z$enable_ext_lightproof" = "zno" ; t
+     AC_MSG_RESULT([no integration])
+ else
+     SCPDEFS="$SCPDEFS -DWITH_EXTENSION_LIGHTPROOF"
+-    lightproof_supported_langs="en-US hu"
++    lightproof_supported_langs="en-US hu ru"
+     if test "z$enable_ext_lightproof" = "zyes" ; then
+         wanted_lightproof="$lightproof_supported_langs"
+     else
+@@ -7165,6 +7165,7 @@ else
+     fi
+     LIGHTPROOF_LANG=
+     LIGHTPROOF_HU_PACK=
++    LIGHTPROOF_RU_PACK=
+     LIGHTPROOF_EN_US_PACK=
+     # check whether the langs are requested at all
+     for lang in $wanted_lightproof ; do
+@@ -7172,6 +7173,7 @@ else
+         LIGHTPROOF_LANG="$LIGHTPROOF_LANG $lang"
+         case $lang in
+             "hu") LIGHTPROOF_HU_PACK="76345f925e34fef2d29bade4f29108e9-lightproof-hu_1.3.oxt";;
++            "ru") LIGHTPROOF_RU_PACK="673860e8649cff2ebdc68bd46f2f7f1a-lightproof-ru_0.1.oxt";;
+             "en-US") LIGHTPROOF_EN_US_PACK="0ab55ac8e88f04258f1d3e79e984382f-lightproof-en-US_0.1.oxt";;
+     esac
+     fi
+@@ -7180,6 +7182,7 @@ else
+ fi
+ AC_SUBST(LIGHTPROOF_LANG)
+ AC_SUBST(LIGHTPROOF_HU_PACK)
++AC_SUBST(LIGHTPROOF_RU_PACK)
+ AC_SUBST(LIGHTPROOF_EN_US_PACK)
+ 
+ dnl ===================================================================
+diff --git a/download b/download
+index a322936..8dcf940 100755
+--- download
++++ download
+@@ -291,7 +291,7 @@ done
+ 
+ # Extensions copy
+ echo "Copy extensions to their location ..."
+-for pack in $BARCODE_EXTENSION_PACK $DIAGRAM_EXTENSION_PACK $VALIDATOR_EXTENSION_PACK $WATCH_WINDOW_EXTENSION_PACK $NUMBERTEXT_EXTENSION_PACK $HUNART_EXTENSION_PACK $TYPO_EXTENSION_PACK $GOOGLE_DOCS_EXTENSION_PACK $OOOBLOGGER_EXTENSION_PACK $LIGHTPROOF_HU_PACK $LIGHTPROOF_EN_US_PACK $SUNTEMPLATES_DE_PACK $SUNTEMPLATES_EN_US_PACK $SUNTEMPLATES_ES_PACK $SUNTEMPLATES_FR_PACK $SUNTEMPLATES_HU_PACK $SUNTEMPLATES_IT_PACK; do
++for pack in $BARCODE_EXTENSION_PACK $DIAGRAM_EXTENSION_PACK $VALIDATOR_EXTENSION_PACK $WATCH_WINDOW_EXTENSION_PACK $NUMBERTEXT_EXTENSION_PACK $HUNART_EXTENSION_PACK $TYPO_EXTENSION_PACK $GOOGLE_DOCS_EXTENSION_PACK $OOOBLOGGER_EXTENSION_PACK $LIGHTPROOF_HU_PACK $LIGHTPROOF_RU_PACK $LIGHTPROOF_EN_US_PACK $SUNTEMPLATES_DE_PACK $SUNTEMPLATES_EN_US_PACK $SUNTEMPLATES_ES_PACK $SUNTEMPLATES_FR_PACK $SUNTEMPLATES_HU_PACK $SUNTEMPLATES_IT_PACK; do
+     check_file $TARFILE_LOCATION/$pack
+     packfilename=`echo "$pack" | cut -f 2- -s -d - | cut -f 1 -d _`
+     echo "Copy extension: '$pack' as '$packfilename.oxt' ..."
+diff --git a/ooo.lst.in b/ooo.lst.in
+index cbf1fb6..3f87bee 100644
+--- ooo.lst.in
++++ ooo.lst.in
+@@ -102,6 +102,7 @@ http://ooo.itc.hu/oxygenoffice/download/libreoffice/
+ @OOOBLOGGER_EXTENSION_PACK@
+ @LIGHTPROOF_EN_US_PACK@
+ @LIGHTPROOF_HU_PACK@
++@LIGHTPROOF_RU_PACK@
+ @SUNTEMPLATES_DE_PACK@
+ @SUNTEMPLATES_EN_US_PACK@
+ @SUNTEMPLATES_ES_PACK@
+diff --git a/scp2/source/extensions/directory_extensions.scp b/scp2/source/extensions/directory_extensions.scp
+index a36885d..755bcc6 100644
+--- scp2/source/extensions/directory_extensions.scp
++++ scp2/source/extensions/directory_extensions.scp
+@@ -100,8 +100,9 @@ End
+ 
+ Directory gid_Brand_Dir_Share_Extensions_LightProof
+     ParentID = gid_Brand_Dir_Share_Extensions;
+-    DosName (en-US) = "lightproof-en-US-0.1";
+-    DosName (hu) = "lightproof-hu-1.2";
++    DosName (en-US) = "lightproof-en-US";
++    DosName (hu) = "lightproof-hu";
++    DosName (ru) = "lightproof-ru";
+     DosName = "lightproof";
+ End
+ 
+diff --git a/scp2/source/extensions/file_extensions.scp b/scp2/source/extensions/file_extensions.scp
+index a2b48ec..d8989d7 100644
+--- scp2/source/extensions/file_extensions.scp
++++ scp2/source/extensions/file_extensions.scp
+@@ -114,6 +114,7 @@ File gid_File_Oxt_LightProof
+     Dir = gid_Brand_Dir_Share_Extensions_LightProof;
+     Name (en-US) = "lightproof-en-US.oxt";
+     Name (hu) = "lightproof-hu.oxt";
++    Name (ru) = "lightproof-ru.oxt";
+ End
+ 
+ #endif
+diff --git a/set_soenv.in b/set_soenv.in
+index 124ae91..e1ac522 100755
+--- set_soenv.in
++++ set_soenv.in
+@@ -1913,6 +1913,7 @@ ToFile( "SUNTEMPLATES_HU_PACK", "@SUNTEMPLATES_HU_PACK@","e" );
+ ToFile( "SUNTEMPLATES_IT_PACK", "@SUNTEMPLATES_IT_PACK@","e" );
+ ToFile( "LIGHTPROOF_EN_US_PACK", "@LIGHTPROOF_EN_US_PACK@","e" );
+ ToFile( "LIGHTPROOF_HU_PACK", "@LIGHTPROOF_HU_PACK@","e" );
++ToFile( "LIGHTPROOF_RU_PACK", "@LIGHTPROOF_RU_PACK@","e" );
+ ToFile( "LIGHTPROOF_LANG",   "@LIGHTPROOF_LANG@",  "e" );
+ ToFile( "WITH_FONTS",        "@WITH_FONTS@",       "e" );
+ ToFile( "WITH_AGFA_MONOTYPE_FONTS",  "@WITH_AGFA_MONOTYPE_FONTS@", "e" );
+-- 
+1.7.5.4
+
+
+From e4e6b143fa87a89c37ed1490eac0bc090876a954 Mon Sep 17 00:00:00 2001
+From: Kalman Szalai - KAMI <kami911@gmail.com>
+Date: Sun, 28 Aug 2011 00:35:55 +0200
+Subject: [bootstrap 10/18] Fix for my latest patches
+
+---
+ configure.in |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 06505c4..c5ea30e 100755
+--- configure.in
++++ configure.in
+@@ -7209,7 +7209,7 @@ if test "z$enable_ext_diagram" = "z" -o "z$enable_ext_diagram" = "zno" ; then
+ else
+   AC_MSG_RESULT([yes])
+   SCPDEFS="$SCPDEFS -DWITH_EXTENSION_DIAGRAM"
+-  DIAGRAM_EXTENSION_PACK="DIAGRAM_EXTENSION_PACK="4a433efb6d385264ebc1d5513782d51c-SmART_0.9.4.oxt"
++  DIAGRAM_EXTENSION_PACK="4a433efb6d385264ebc1d5513782d51c-SmART_0.9.4.oxt"
+ fi
+ AC_SUBST(DIAGRAM_EXTENSION_PACK)
+ 
+-- 
+1.7.5.4
+
+
+From a87a8ee5a1919f6f6b4b35668456c03bdd499c85 Mon Sep 17 00:00:00 2001
+From: Stephan Bergmann <sbergman@redhat.com>
+Date: Mon, 19 Sep 2011 21:39:46 +0200
+Subject: [bootstrap 11/18] Call macosx-change-install-names on executables in
+ gbuild, too.
+
+Signed-off-by: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+---
+ solenv/gbuild/platform/macosx.mk |    2 ++
+ 1 files changed, 2 insertions(+), 0 deletions(-)
+
+diff --git a/solenv/gbuild/platform/macosx.mk b/solenv/gbuild/platform/macosx.mk
+index 2def0c9..ff73333 100755
+--- solenv/gbuild/platform/macosx.mk
++++ solenv/gbuild/platform/macosx.mk
+@@ -274,6 +274,8 @@ $(call gb_Helper_abbreviate_dirs,\
+ 		$(foreach lib,$(LINKED_STATIC_LIBS),$(call gb_StaticLibrary_get_target,$(lib))) \
+ 		-o $(1) \
+ 		`cat $${DYLIB_FILE}` && \
++	$(if $(filter Executable,$(TARGETTYPE)),\
++		$(PERL) $(SOLARENV)/bin/macosx-change-install-names.pl Executable $(LAYER) $(1) &&) \
+ 	$(if $(filter Library CppunitTest,$(TARGETTYPE)),\
+ 		$(PERL) $(SOLARENV)/bin/macosx-change-install-names.pl Library $(LAYER) $(1) && \
+ 		ln -sf $(1) $(patsubst %.dylib,%.jnilib,$(1)) &&) \
+-- 
+1.7.5.4
+
+
+From b6b7eb97b48937132638aeeef18270624201a930 Mon Sep 17 00:00:00 2001
+From: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+Date: Tue, 20 Sep 2011 20:53:50 +0200
+Subject: [bootstrap 12/18] Revert "Call macosx-change-install-names on
+ executables in gbuild, too."
+
+This reverts commit a87a8ee5a1919f6f6b4b35668456c03bdd499c85.
+The cherry-pick was premature, it would have required an unfortunate number of
+follow-up commits to be picked too.
+
+Signed-off-by: Norbert Thiebaud <nthiebaud@gmail.com>
+Signed-off-by: Stephan Bergmann <sbergman@redhat.com>
+---
+ solenv/gbuild/platform/macosx.mk |    2 --
+ 1 files changed, 0 insertions(+), 2 deletions(-)
+
+diff --git a/solenv/gbuild/platform/macosx.mk b/solenv/gbuild/platform/macosx.mk
+index ff73333..2def0c9 100755
+--- solenv/gbuild/platform/macosx.mk
++++ solenv/gbuild/platform/macosx.mk
+@@ -274,8 +274,6 @@ $(call gb_Helper_abbreviate_dirs,\
+ 		$(foreach lib,$(LINKED_STATIC_LIBS),$(call gb_StaticLibrary_get_target,$(lib))) \
+ 		-o $(1) \
+ 		`cat $${DYLIB_FILE}` && \
+-	$(if $(filter Executable,$(TARGETTYPE)),\
+-		$(PERL) $(SOLARENV)/bin/macosx-change-install-names.pl Executable $(LAYER) $(1) &&) \
+ 	$(if $(filter Library CppunitTest,$(TARGETTYPE)),\
+ 		$(PERL) $(SOLARENV)/bin/macosx-change-install-names.pl Library $(LAYER) $(1) && \
+ 		ln -sf $(1) $(patsubst %.dylib,%.jnilib,$(1)) &&) \
+-- 
+1.7.5.4
+
+
+From 72a5f87cb3f0a367f1cd6a5cc15101acc83396fe Mon Sep 17 00:00:00 2001
+From: Rene Engelhard <rene@debian.org>
+Date: Wed, 28 Sep 2011 20:40:07 +0000
+Subject: [bootstrap 13/18] make configure check for cpp/poppler-version.h
+
+---
+ configure.in |   10 ++++++++++
+ 1 files changed, 10 insertions(+), 0 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index c5ea30e..3402424 100755
+--- configure.in
++++ configure.in
+@@ -6371,6 +6371,16 @@ AS_IF([test "x$enable_ext_pdfimport" = "xyes"], [
+       AC_MSG_RESULT([external])
+       SYSTEM_POPPLER=YES
+       PKG_CHECK_MODULES( POPPLER, poppler >= 0.8.0 )
++      AC_LANG_PUSH([C++])
++      save_CXXFLAGS=$CXXFLAGS
++      save_CPPFLAGS=$CPPFLAGS
++      CXXFLAGS="$CXXFLAGS $POPPLER_CFLAGS"
++      CPPFLAGS="$CPPFLAGS $POPPLER_CFLAGS"
++      AC_CHECK_HEADER([cpp/poppler-version.h], [],
++                   [AC_MSG_ERROR([cpp/poppler-version.h not found. Install poppler])], [])
++      CXXFLAGS=$save_CXXFLAGS
++      CPPFLAGS=$save_CPPFLAGS
++      AC_LANG_POP([C++])
+   else
+       AC_MSG_RESULT([internal])
+       SYSTEM_POPPLER=NO
+-- 
+1.7.5.4
+
+
+From 499b16d59445aacdf767fd42bde2197f014d7ea1 Mon Sep 17 00:00:00 2001
+From: Andras Timar <atimar@suse.com>
+Date: Fri, 7 Oct 2011 08:10:49 +0200
+Subject: [bootstrap 14/18] add Scottish Gaelic (gd) UI support
+
+Signed-off-by Michael Meeks <michael.meeks@suse.com>
+---
+ solenv/inc/langlist.mk |    1 +
+ 1 files changed, 1 insertions(+), 0 deletions(-)
+
+diff --git a/solenv/inc/langlist.mk b/solenv/inc/langlist.mk
+index 31b5ba2..e8f6812 100644
+--- solenv/inc/langlist.mk
++++ solenv/inc/langlist.mk
+@@ -57,6 +57,7 @@ fa \
+ fi \
+ fr \
+ ga \
++gd \
+ gl \
+ gu \
+ he \
+-- 
+1.7.5.4
+
+
+From 522f633cb6a986c7ec01eb0b6bc6e84d70b5413a Mon Sep 17 00:00:00 2001
+From: Martin Hosken <martin_hosken@sil.org>
+Date: Thu, 20 Oct 2011 14:25:34 +0100
+Subject: [bootstrap 15/18] Upgrade graphite to 1.0.3 fix surrogate support
+
+Signed-off-by: Michael Meeks <michael.meeks@suse.com>
+---
+ ooo.lst.in |    3 ++-
+ 1 files changed, 2 insertions(+), 1 deletions(-)
+
+diff --git a/ooo.lst.in b/ooo.lst.in
+index 3f87bee..afdd4b0 100644
+--- ooo.lst.in
++++ ooo.lst.in
+@@ -79,7 +79,8 @@ debc62758716a169df9f62e6ab2bc634-zlib-1.2.3.tar.gz
+ 0ff7d225d087793c8c2c680d77aac3e7-mdds_0.5.3.tar.bz2
+ f02578f5218f217a9f20e9c30e119c6a-boost_1_44_0.tar.bz2
+ 9ed97fce60a9a65852402248a6659492-hunspell-1.3.1.tar.gz
+-3115c721f5cb7c464f01c2dddccfaba6-graphite2-1.0.2.tgz
++http://dev-www.libreoffice.org/src
++3bf481ca95109b14435125c0dd1f2217-graphite2-1.0.3.tgz
+ http://download.go-oo.org/extern
+ 185d60944ea767075d27247c3162b3bc-unowinreg.dll
+ b4cae0700aa1c2aef7eb7f345365e6f1-translate-toolkit-1.8.1.tar.bz2
+-- 
+1.7.5.4
+
+
+From a11c44b86e4459b6366b347e0406a860c80e0379 Mon Sep 17 00:00:00 2001
+From: Tor Lillqvist <tlillqvist@novell.com>
+Date: Tue, 25 Oct 2011 11:20:32 +0200
+Subject: [bootstrap 16/18] Fix building of the 64-bit Windows Explorer
+ extension (fdo#36950)
+
+Don't confuse the 64-bit Explorer extension with a 64-bit LibreOffice,
+which is unfinished and highly experimental work. OOo has been
+building and distributing a 64-bit Explorer extension since long, and
+we should too. They used some secret Hamburg sauce when building it,
+though, but hopefully now it works here, too.
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ configure.in             |   52 ++++++++++++++++++++++++++++++++++++++++++---
+ set_soenv.in             |   11 +++++++++
+ solenv/inc/set_wntx64.mk |    4 +-
+ 3 files changed, 61 insertions(+), 6 deletions(-)
+
+diff --git a/configure.in b/configure.in
+index 3402424..1c88874 100755
+--- configure.in
++++ configure.in
+@@ -459,7 +459,7 @@ AC_ARG_ENABLE(zenity,
+ 
+ AC_ARG_ENABLE(cl-x64,
+     AS_HELP_STRING([--enable-cl-x64],
+-        [Use the Microsoft C/C++ x64 compiler instead of the default x86 one.]),
++        [Build a 64-bit LibreOffice using the Microsoft C/C++ x64 compiler.]),
+ ,)
+ 
+ AC_ARG_ENABLE(extra-gallery,
+@@ -1595,8 +1595,8 @@ if test "$_os" = "WINNT"; then
+    dnl Include twain scanners
+    BUILD_TYPE="$BUILD_TYPE TWAIN"
+ 
+-   dnl Set the CL_X64 variable.
+-   AC_MSG_CHECKING([whether to use the Microsoft C/C++ x64 compiler])
++   dnl Set the CL_X64 variable if we are building a 64-bit LibreOffice.
++   AC_MSG_CHECKING([whether to build a 64-bit LibreOffice])
+    if test "z$enable_cl_x64" = "z" -o "$enable_cl_x64" = "no"; then
+       CL_X64=""
+       AC_MSG_RESULT([no])
+@@ -2236,7 +2236,7 @@ if test "$_os" = "WINNT"; then
+             export INCLUDE=`cygpath -d "$COMPATH/Include"`
+             dnl  Check which Microsoft C/C++ compiler is found
+             AC_MSG_CHECKING([the Version of Microsoft C/C++ Compiler])
+-dnl      The following find microsoft, matches nn.nn.nnnn then pulls numbers out.
+++           # The following finds Microsoft, matches nn.nn.nnnn then pulls numbers out.
+             CCNUMVER=`$CC 2>&1 | $AWK "/Microsoft/ && /..\\...\\...../ {
+                             x = match( \\\$0, /..\\...\\...../ )
+                             CCversion = substr( \\\$0, RSTART, RLENGTH)
+@@ -2271,6 +2271,50 @@ dnl      The following find microsoft, matches nn.nn.nnnn then pulls numbers out
+         else
+             AC_MSG_RESULT(["$SHOWINCLUDES_PREFIX"])
+         fi
++
++        # Check for 64-bit (cross-)compiler to use to build the 64-bit
++        # version of the Explorer extension (and maybe other small
++        # bits, too) needed when installing a 32-bit LibreOffice on a
++        # 64-bit OS. The 64-bit Explorer extension is a feature that
++        # has been present since long in OOo. Don't confuse it with
++        # building LibreOffice itself as 64-bit code, which is
++        # unfished work and highly experimental.
++
++        AC_MSG_CHECKING([for a x64 compiler])
++        BUILD_X64=
++        CC_X64_BINARY=
++        LINK_X64_BINARY=
++        LIBMGR_X64_BINARY=
++
++        # Prefer native x64 compiler to cross-compiler, in case we are running
++        # the build on a 64-bit OS.
++        if "$with_cl_home/bin/amd64/cl.exe" -? </dev/null >/dev/null 2>&1; then
++            BUILD_X64=TRUE
++            CC_X64_BINARY="$with_cl_home/bin/amd64/cl.exe"
++            CXX_X64_BINARY="$with_cl_home/bin/amd64/cl.exe"
++            LINK_X64_BINARY="$with_cl_home/bin/amd64/link.exe"
++            LIBMGR_X64_BINARY="$with_cl_home/bin/amd64/lib.exe"
++        elif "$with_cl_home/bin/x86_amd64/cl.exe" -? </dev/null >/dev/null 2>&1; then
++            BUILD_X64=TRUE
++            CC_X64_BINARY="$with_cl_home/bin/x86_amd64/cl.exe"
++            CXX_X64_BINARY="$with_cl_home/bin/x86_amd64/cl.exe"
++            LINK_X64_BINARY="$with_cl_home/bin/x86_amd64/link.exe"
++            LIBMGR_X64_BINARY="$with_cl_home/bin/x86_amd64/lib.exe"
++        fi
++        if test "$BUILD_X64" = TRUE; then
++            AC_MSG_RESULT([found])
++        else
++            AC_MSG_RESULT([not found])
++            AC_MSG_WARN([Installation set will not contain the 64-bit Explorer extension])
++        fi
++        AC_SUBST(BUILD_X64)
++
++        # These are passed to the environment through set_soenv.in as usual, and then 
++        # used in set_wntx64.mk
++        AC_SUBST(CC_X64_BINARY)
++        AC_SUBST(CXX_X64_BINARY)
++        AC_SUBST(LINK_X64_BINARY)
++        AC_SUBST(LIBMGR_X64_BINARY)
+     else
+         AC_MSG_CHECKING([the MinGW C++ Compiler])
+         if test `$CC -dumpmachine | $SED -e 's/^.*-//'` = "mingw32"; then
+diff --git a/set_soenv.in b/set_soenv.in
+index e1ac522..7e0542f 100755
+--- set_soenv.in
++++ set_soenv.in
+@@ -1770,6 +1770,17 @@ if ( $platform =~ m/cygwin/ )
+    ToFile( "DISABLE_ACTIVEX",   "@DISABLE_ACTIVEX@","e" );
+    ToFile( "DISABLE_ATL",   "@DISABLE_ATL@","e" );
+    ToFile( "USE_NEW_SDK",       $USE_NEW_SDK,       "e" );
++   # Variables used when building the parts that needs to be available
++   # also as 64-bit versions in a 32-bit LibreOffice build, like
++   # the Explorer extension. If the configure script hasn't
++   # found the 64-bit (cross-)compiler, then @BUILD_X64@ will be empty.
++   ToFile( "BUILD_X64",         "@BUILD_X64@",      "e" );
++   if ( "@BUILD_X64@" eq "TRUE" ) {
++       ToFile( "CC_X64_BINARY", "@CC_X64_BINARY@",  "e" );
++       ToFile( "CXX_X64_BINARY","@CXX_X64_BINARY@", "e" );
++       ToFile( "LINK_X64_BINARY","@LINK_X64_BINARY@","e" );
++       ToFile( "LIBMGR_X64_BINARY","@LIBMGR_X64_BINARY@","e" );
++   }
+ 
+    # Hack around dmake's mktmp not generating DOS paths.
+    my $tmpdir = qx{cygpath -m "/tmp"};
+diff --git a/solenv/inc/set_wntx64.mk b/solenv/inc/set_wntx64.mk
+index e14c94d..3aececd 100755
+--- solenv/inc/set_wntx64.mk
++++ solenv/inc/set_wntx64.mk
+@@ -46,7 +46,7 @@ USE_CFLAGS_X64=-c -nologo -Gs $(NOLOGO) -Zm500 -Zc:forScope,wchar_t- -GR
+ # Stack buffer overrun detection.
+ CFLAGS+=-GS
+ 
+-USE_CDEFS_X64+= -DWIN32 -D_AMD64_=1 -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_NON_CONFORMING_SWPRINTFS
++USE_CDEFS_X64+= -D$(OS) -D$(GUI) -D$(GVER) -D$(COM) -DX86_64 -DWIN32 -D_AMD64_=1 -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_NON_CONFORMING_SWPRINTFS
+ .IF "$(debug)"!=""
+ USE_CFLAGS_X64+=-Zi -Fd$(MISC_X64)/$(@:b).pdb
+ USE_CDEFS_X64+=-DDEBUG
+@@ -114,7 +114,7 @@ STDSLOCUI_X64=
+ 
+ IMPLIBFLAGS_X64=-machine:X64
+ 
+-LIBPATH_X64=$(PSDK)/lib/x64
++LIBPATH_X64=$(PSDK_HOME)/lib/x64
+ LIBPATH_VC_X64=$(COMPATH)/lib/amd64
+ 
+ ADVAPI32LIB_X64=$(LIBPATH_X64)/advapi32.lib
+-- 
+1.7.5.4
+
+
+From ae69437e119f4e1d8eca657694c0e719a4da6f83 Mon Sep 17 00:00:00 2001
+From: Petr Mladek <pmladek@suse.cz>
+Date: Tue, 25 Oct 2011 18:08:33 +0200
+Subject: [bootstrap 17/18] bump product version to 3.4.4-rc1, release number
+ to 401
+
+---
+ instsetoo_native/util/openoffice.lst |   28 ++++++++++++++--------------
+ solenv/inc/minor.mk                  |    4 ++--
+ 2 files changed, 16 insertions(+), 16 deletions(-)
+
+diff --git a/instsetoo_native/util/openoffice.lst b/instsetoo_native/util/openoffice.lst
+index c561eaf..c981a32 100644
+--- instsetoo_native/util/openoffice.lst
++++ instsetoo_native/util/openoffice.lst
+@@ -5,8 +5,8 @@ Globals
+ 		variables
+ 		{
+ 			OOOBASEVERSION 3.4
+-  			OOOPACKAGEVERSION 3.4.3
+-			UREPACKAGEVERSION 3.4.3
++  			OOOPACKAGEVERSION 3.4.4
++			UREPACKAGEVERSION 3.4.4
+ 			URELAYERVERSION 1
+ 			BASISROOTNAME LibreOffice
+ 			UNIXBASISROOTNAME libreoffice3.4
+@@ -62,7 +62,7 @@ LibreOffice
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+ 			USERDIRPRODUCTVERSION 3
+-			ABOUTBOXPRODUCTVERSION 3.4.3
++			ABOUTBOXPRODUCTVERSION 3.4.4
+ 			BASEPRODUCTVERSION 3.4
+             PCPFILENAME openoffice.pcp
+ 			UPDATEURL http://update.libreoffice.org/ProductUpdateService/check.Update
+@@ -74,7 +74,7 @@ LibreOffice
+ 			FILEFORMATNAME OpenOffice.org
+ 			FILEFORMATVERSION 1.0
+ 			WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+-			PACKAGEVERSION 3.4.3
++			PACKAGEVERSION 3.4.4
+ 			PACKAGEREVISION {buildid}
+ 			LICENSENAME LGPL
+ 			GLOBALFILEGID gid_File_Lib_Vcl
+@@ -130,7 +130,7 @@ LibreOffice_wJRE
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+ 			USERDIRPRODUCTVERSION 3
+-			ABOUTBOXPRODUCTVERSION 3.4.3
++			ABOUTBOXPRODUCTVERSION 3.4.4
+ 			BASEPRODUCTVERSION 3.4
+ 			UPDATEURL http://update.libreoffice.org/ProductUpdateService/check.Update
+             ODFNOTIFYURL http://odfnotify.libreoffice.org/OOo3.0/notification.jsp?version=ODF
+@@ -141,7 +141,7 @@ LibreOffice_wJRE
+ 			FILEFORMATNAME OpenOffice.org
+ 			FILEFORMATVERSION 1.0
+ 			WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+-			PACKAGEVERSION 3.4.3
++			PACKAGEVERSION 3.4.4
+ 			PACKAGEREVISION {buildid}
+ 			LICENSENAME LGPL
+ 			WITHJREPRODUCT 1
+@@ -196,7 +196,7 @@ LibreOffice_Dev
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+ 			USERDIRPRODUCTVERSION 3
+-			ABOUTBOXPRODUCTVERSION 3.4.3
++			ABOUTBOXPRODUCTVERSION 3.4.4
+ 			BASEPRODUCTVERSION 3.4
+ 			DEVELOPMENTPRODUCT 1
+ 			BASISPACKAGEPREFIX libobasis-dev
+@@ -211,7 +211,7 @@ LibreOffice_Dev
+ 			FILEFORMATNAME OpenOffice.org
+ 			FILEFORMATVERSION 1.0
+ 			WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+-			PACKAGEVERSION 3.4.3
++			PACKAGEVERSION 3.4.4
+ 			PACKAGEREVISION {buildid}
+ 			LICENSENAME LGPL
+ 			GLOBALFILEGID gid_File_Lib_Vcl
+@@ -309,7 +309,7 @@ LibreOffice_SDK
+             POSTVERSIONEXTENSION SDK
+             POSTVERSIONEXTENSIONUNIX sdk
+             BRANDPACKAGEVERSION 3.4
+-            PACKAGEVERSION 3.4.3
++            PACKAGEVERSION 3.4.4
+             PACKAGEREVISION {buildid}
+             PACK_INSTALLED 1
+             POOLPRODUCT 0
+@@ -357,7 +357,7 @@ LibreOffice_Dev_SDK
+             POSTVERSIONEXTENSION SDK
+             POSTVERSIONEXTENSIONUNIX sdk
+             BRANDPACKAGEVERSION 3.4
+-            PACKAGEVERSION 3.4.3
++            PACKAGEVERSION 3.4.4
+             PACKAGEREVISION {buildid}
+             BASISPACKAGEPREFIX libobasis-dev
+             UREPACKAGEPREFIX lodev
+@@ -408,7 +408,7 @@ OxygenOffice
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+ 			USERDIRPRODUCTVERSION 3
+-			ABOUTBOXPRODUCTVERSION 3.4.3
++			ABOUTBOXPRODUCTVERSION 3.4.4
+ 			BASEPRODUCTVERSION 3.4
+             PCPFILENAME openoffice.pcp
+ 			UPDATEURL http://update.libreoffice.org/ProductUpdateService/check.Update
+@@ -420,7 +420,7 @@ OxygenOffice
+ 			FILEFORMATNAME OpenOffice.org
+ 			FILEFORMATVERSION 1.0
+ 			WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+-			PACKAGEVERSION 3.4.3
++			PACKAGEVERSION 3.4.4
+ 			PACKAGEREVISION {buildid}
+ 			LICENSENAME LGPL
+ 			SERVICESPROJEKT 1
+@@ -478,7 +478,7 @@ OxygenOffice_wJRE
+             POSTVERSIONEXTENSIONUNIX
+ 			BRANDPACKAGEVERSION 3.4
+ 			USERDIRPRODUCTVERSION 3
+-			ABOUTBOXPRODUCTVERSION 3.4.3
++			ABOUTBOXPRODUCTVERSION 3.4.4
+ 			BASEPRODUCTVERSION 3.4
+ 			UPDATEURL http://update.libreoffice.org/ProductUpdateService/check.Update
+             ODFNOTIFYURL http://odfnotify.libreoffice.org/OOo3.0/notification.jsp?version=ODF
+@@ -489,7 +489,7 @@ OxygenOffice_wJRE
+ 			FILEFORMATNAME OpenOffice.org
+ 			FILEFORMATVERSION 1.0
+ 			WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+-			PACKAGEVERSION 3.4.3
++			PACKAGEVERSION 3.4.4
+ 			PACKAGEREVISION {buildid}
+ 			LICENSENAME LGPL
+ 			SERVICESPROJEKT 1
+diff --git a/solenv/inc/minor.mk b/solenv/inc/minor.mk
+index f8749b1..75772f2 100644
+--- solenv/inc/minor.mk
++++ solenv/inc/minor.mk
+@@ -1,5 +1,5 @@
+ RSCVERSION=340
+-RSCREVISION=340m1(Build:301)
+-BUILD=301
++RSCREVISION=340m1(Build:401)
++BUILD=401
+ LAST_MINOR=m1
+ SOURCEVERSION=OOO340
+-- 
+1.7.5.4
+
+reverting on repository calc from libreoffice-3.4.3.2 to merge-base 83e32fa902b2908970185a2f5b388d0b179aa75a
+commits on repository calc merge-base 83e32fa902b2908970185a2f5b388d0b179aa75a to libreoffice-3.4.4.1
+From 3031674a1bd4a3a2c4f5131ad847c61c9dcbcc55 Mon Sep 17 00:00:00 2001
+From: Laurent Godard <oooconv@free.fr>
+Date: Wed, 24 Aug 2011 19:09:19 +0200
+Subject: [calc 01/11] avoid maTables.back() calls by store and reuse when
+ needed
+
+better performance on loadin calc files (esp. big ones)
+---
+ sc/source/filter/xml/xmlsubti.cxx |   99 ++++++++++++++++++++-----------------
+ sc/source/filter/xml/xmlsubti.hxx |    3 +-
+ 2 files changed, 55 insertions(+), 47 deletions(-)
+
+diff --git a/sc/source/filter/xml/xmlsubti.cxx b/sc/source/filter/xml/xmlsubti.cxx
+index 4b1316e..e769fa5 100644
+--- sc/source/filter/xml/xmlsubti.cxx
++++ sc/source/filter/xml/xmlsubti.cxx
+@@ -68,7 +68,7 @@ using ::std::auto_ptr;
+ using namespace com::sun::star;
+ 
+ ScMyTableData::ScMyTableData(sal_Int32 nSheet, sal_Int32 nCol, sal_Int32 nRow)
+-    : 	nColsPerCol(nDefaultColCount, 1),
++    :   nColsPerCol(nDefaultColCount, 1),
+         nRealCols(nDefaultColCount + 1, 0),
+         nRowsPerRow(nDefaultRowCount, 1),
+         nRealRows(nDefaultRowCount + 1, 0),
+@@ -163,7 +163,8 @@ ScMyTables::ScMyTables(ScXMLImport& rTempImport)
+     nCurrentColStylePos(0),
+     nCurrentDrawPage( -1 ),
+     nCurrentXShapes( -1 ),
+-    nCurrentSheet( -1 )
++    nCurrentSheet( -1 ),
++    pLastTable(NULL)
+ {
+ }
+ 
+@@ -179,6 +180,7 @@ void ScMyTables::NewSheet(const rtl::OUString& sTableName, const rtl::OUString&
+         nCurrentColStylePos = 0;
+         sCurrentSheetName = sTableName;
+         maTables.clear();
++        pLastTable = NULL;
+         ++nCurrentSheet;
+ 
+         maProtectionData = rProtectData;
+@@ -336,12 +338,11 @@ void ScMyTables::DoMerge(sal_Int32 nCount)
+         uno::Reference <table::XCellRange> xMergeCellRange;
+         if (nCount == -1)
+         {
+-            const ScMyTableData& r = maTables.back();
+             xMergeCellRange.set(
+                 xCurrentCellRange->getCellRangeByPosition(
+                     aCellAddress.StartColumn, aCellAddress.StartRow,
+-                    aCellAddress.EndColumn + r.GetColsPerCol(r.GetColumn()) - 1,
+-                    aCellAddress.EndRow + r.GetRowsPerRow(r.GetRow()) - 1));
++                    aCellAddress.EndColumn + pLastTable->GetColsPerCol(pLastTable->GetColumn()) - 1,
++                    aCellAddress.EndRow + pLastTable->GetRowsPerRow(pLastTable->GetRow()) - 1));
+         }
+         else
+             xMergeCellRange.set(
+@@ -362,8 +363,8 @@ void ScMyTables::InsertRow()
+     {
+         table::CellRangeAddress aCellAddress;
+         sal_Int32 nRow(GetRealCellPos().Row);
+-        const ScMyTableData& rTab = maTables.back();
+-        for (sal_Int32 j = 0; j < GetRealCellPos().Column - rTab.GetColumn() - 1; ++j)
++
++        for (sal_Int32 j = 0; j < GetRealCellPos().Column - pLastTable->GetColumn() - 1; ++j)
+         {
+             if (IsMerged(xCurrentCellRange, j, nRow - 1, aCellAddress))
+             {
+@@ -391,7 +392,7 @@ void ScMyTables::NewRow()
+     if (n <= 1)
+         return;
+ 
+-    if (maTables[n-1].GetRealRows(maTables[n-1].GetRow()) >
++    if (pLastTable->GetRealRows(pLastTable->GetRow()) >
+         maTables[n-2].GetRowsPerRow(maTables[n-2].GetRow()) - 1)
+     {
+         if (GetRealCellPos().Column > 0)
+@@ -413,15 +414,14 @@ void ScMyTables::NewRow()
+ 
+ void ScMyTables::AddRow()
+ {
+-    ScMyTableData& rTab = maTables.back();
+-    rTab.AddRow();
+-    rTab.SetFirstColumn();
+-    sal_Int32 nRow = rTab.GetRow();
++    pLastTable->AddRow();
++    pLastTable->SetFirstColumn();
++    sal_Int32 nRow = pLastTable->GetRow();
+     if (nRow > 0)
+         NewRow();
+ 
+-    rTab.SetRealRows(
+-        nRow + 1, rTab.GetRealRows(nRow) + rTab.GetRowsPerRow(nRow));
++    pLastTable->SetRealRows(
++        nRow + 1, pLastTable->GetRealRows(nRow) + pLastTable->GetRowsPerRow(nRow));
+ }
+ 
+ void ScMyTables::SetRowStyle(const rtl::OUString& rCellStyleName)
+@@ -435,7 +435,8 @@ void ScMyTables::InsertColumn()
+     {
+         table::CellRangeAddress aCellAddress;
+         sal_Int32 nCol(GetRealCellPos().Column);
+-        sal_Int32 n = GetRealCellPos().Row - maTables.back().GetRow() - 1;
++        sal_Int32 n = GetRealCellPos().Row - pLastTable->GetRow() - 1;
++
+         for (sal_Int32 j = 0; j <= n; ++j)
+         {
+             table::CellRangeAddress aTempCellAddress;
+@@ -459,7 +460,7 @@ void ScMyTables::InsertColumn()
+ 
+             //insert Cell
+             sheet::CellInsertMode aCellInsertMode(sheet::CellInsertMode_RIGHT);
+-            uno::Reference <sheet::XCellRangeMovement>	xCellRangeMovement (xCurrentSheet, uno::UNO_QUERY);
++            uno::Reference <sheet::XCellRangeMovement> xCellRangeMovement (xCurrentSheet, uno::UNO_QUERY);
+             xCellRangeMovement->insertCells(aTempCellAddress, aCellInsertMode);
+ 
+             //merge
+@@ -478,31 +479,33 @@ void ScMyTables::NewColumn(sal_Bool bIsCovered)
+     if (bIsCovered)
+         return;
+ 
+-    ScMyTableData& rLastTab = maTables.back();
+-    sal_Int32 nColCount = rLastTab.GetColCount();
+-    sal_Int32 nSpannedCols = rLastTab.GetSpannedCols();
++    sal_Int32 nColCount = pLastTable->GetColCount();
++    sal_Int32 nSpannedCols = pLastTable->GetSpannedCols();
++
++
+     if ( (nSpannedCols > nColCount) &&
+-        (rLastTab.GetRow() == 0) &&
+-        (rLastTab.GetColumn() == 0) )
++        (pLastTable->GetRow() == 0) &&
++        (pLastTable->GetColumn() == 0) )
++
+     {
+         if (nColCount > 0)
+         {
+             sal_Int32 FirstColsSpanned(nSpannedCols / nColCount);
+             sal_Int32 LastColSpanned(FirstColsSpanned
+-                + (nSpannedCols	% nColCount));
++                + (nSpannedCols % nColCount));
+             for (sal_Int32 i = 0; i < nColCount - 1; ++i)
+             {
+-                rLastTab.SetColsPerCol(i, FirstColsSpanned);
+-                rLastTab.SetRealCols(i + 1, rLastTab.GetRealCols(i) + FirstColsSpanned);
++                pLastTable->SetColsPerCol(i, FirstColsSpanned);
++                pLastTable->SetRealCols(i + 1, pLastTable->GetRealCols(i) + FirstColsSpanned);
+             }
+-            rLastTab.SetColsPerCol(nColCount - 1, LastColSpanned);
+-            rLastTab.SetRealCols(
+-                nColCount, rLastTab.GetRealCols(nColCount - 1) + LastColSpanned);
++            pLastTable->SetColsPerCol(nColCount - 1, LastColSpanned);
++            pLastTable->SetRealCols(
++                nColCount, pLastTable->GetRealCols(nColCount - 1) + LastColSpanned);
+         }
+     }
+-    if (rLastTab.GetRealCols(rLastTab.GetColumn()) > nSpannedCols - 1)
++    if (pLastTable->GetRealCols(pLastTable->GetColumn()) > nSpannedCols - 1)
+     {
+-        if (rLastTab.GetRow() == 0)
++        if (pLastTable->GetRow() == 0)
+         {
+             InsertColumn();
+             size_t n = maTables.size();
+@@ -513,7 +516,7 @@ void ScMyTables::NewColumn(sal_Bool bIsCovered)
+ 
+                 maTables[i-1].SetColsPerCol(nColPos,
+                     maTables[i-1].GetColsPerCol(nColPos) +
+-                    rLastTab.GetColsPerCol(rLastTab.GetColumn()));
++                    pLastTable->GetColsPerCol(pLastTable->GetColumn()));
+ 
+                 maTables[i-1].SetRealCols(
+                     nColPos + 1,
+@@ -527,21 +530,20 @@ void ScMyTables::NewColumn(sal_Bool bIsCovered)
+ 
+ void ScMyTables::AddColumn(sal_Bool bIsCovered)
+ {
+-    ScMyTableData& rLastTab = maTables.back();
+-    rLastTab.AddColumn();
+-    if (rLastTab.GetSubTableSpanned() > 1)
+-        rLastTab.SetSubTableSpanned(rLastTab.GetSubTableSpanned() - 1);
++    pLastTable->AddColumn();
++    if (pLastTable->GetSubTableSpanned() > 1)
++        pLastTable->SetSubTableSpanned(pLastTable->GetSubTableSpanned() - 1);
+     else
+     {
+         NewColumn(bIsCovered);
+-        sal_Int32 nCol = rLastTab.GetColumn();
+-        sal_Int32 nRow = rLastTab.GetRow();
+-        rLastTab.SetRealCols(
+-            nCol + 1, rLastTab.GetRealCols(nCol) + rLastTab.GetColsPerCol(nCol));
++        sal_Int32 nCol = pLastTable->GetColumn();
++        sal_Int32 nRow = pLastTable->GetRow();
++        pLastTable->SetRealCols(
++            nCol + 1, pLastTable->GetRealCols(nCol) + pLastTable->GetColsPerCol(nCol));
+ 
+-        if ((!bIsCovered) || (bIsCovered && (rLastTab.GetColsPerCol(nCol) > 1)))
++        if ((!bIsCovered) || (bIsCovered && (pLastTable->GetColsPerCol(nCol) > 1)))
+         {
+-            if ((rLastTab.GetRowsPerRow(nRow) > 1) || (rLastTab.GetColsPerCol(nCol) > 1))
++            if ((pLastTable->GetRowsPerRow(nRow) > 1) || (pLastTable->GetColsPerCol(nCol) > 1))
+                 DoMerge();
+         }
+     }
+@@ -550,6 +552,7 @@ void ScMyTables::AddColumn(sal_Bool bIsCovered)
+ void ScMyTables::NewTable(sal_Int32 nTempSpannedCols)
+ {
+     maTables.push_back(new ScMyTableData(nCurrentSheet));
++    pLastTable = &maTables.back();
+ 
+     if (maTables.size() > 1)
+     {
+@@ -577,13 +580,12 @@ void ScMyTables::NewTable(sal_Int32 nTempSpannedCols)
+             nTempSpannedCols += nToMerge;
+     }
+ 
+-    ScMyTableData& rNewTab = maTables.back();
+-    rNewTab.SetSpannedCols(nTempSpannedCols);
++    pLastTable->SetSpannedCols(nTempSpannedCols);
+ 
+     size_t n = maTables.size();
+     if (n > 1)
+     {
+-        maTables[n-2].SetSubTableSpanned(rNewTab.GetSpannedCols());
++        maTables[n-2].SetSubTableSpanned(pLastTable->GetSpannedCols());
+         UnMerge();
+     }
+ }
+@@ -636,7 +638,13 @@ void ScMyTables::DeleteTable()
+ 
+     nCurrentColStylePos = 0;
+     if (!maTables.empty())
+-        maTables.pop_back();
++    {
++          maTables.pop_back();
++          if (maTables.empty())
++               pLastTable = NULL;
++          else
++               pLastTable = &maTables.back();
++    }
+ 
+     if (maTables.empty()) // only set the styles if all subtables are importet and the table is finished
+     {
+@@ -705,8 +713,7 @@ table::CellAddress ScMyTables::GetRealCellPos()
+ 
+ void ScMyTables::AddColCount(sal_Int32 nTempColCount)
+ {
+-    ScMyTableData& rLastTab = maTables.back();
+-    rLastTab.SetColCount(rLastTab.GetColCount() + nTempColCount);
++    pLastTable->SetColCount(pLastTable->GetColCount() + nTempColCount);
+ }
+ 
+ void ScMyTables::AddColStyle(const sal_Int32 nRepeat, const rtl::OUString& rCellStyleName)
+diff --git a/sc/source/filter/xml/xmlsubti.hxx b/sc/source/filter/xml/xmlsubti.hxx
+index e0a8d9a..0d817fb 100644
+--- sc/source/filter/xml/xmlsubti.hxx
++++ sc/source/filter/xml/xmlsubti.hxx
+@@ -143,7 +143,8 @@ private:
+     sal_Int16							nCurrentDrawPage;
+     sal_Int16							nCurrentXShapes;
+     sal_Int32							nCurrentSheet;
+-
++    ScMyTableData*                      pLastTable;
++    
+     sal_Bool 							IsMerged (const com::sun::star::uno::Reference <com::sun::star::table::XCellRange>& xCellRange,
+                                                 const sal_Int32 nCol, const sal_Int32 nRow,
+                                                 com::sun::star::table::CellRangeAddress& aCellAddress) const;
+-- 
+1.7.5.4
+
+
+From ac8ad054276a607b429a3fab5265dab552c1ed7b Mon Sep 17 00:00:00 2001
+From: Eike Rathke <erack@erack.de>
+Date: Thu, 25 Aug 2011 04:03:12 +0200
+Subject: [calc 02/11] use boost::intrusive_ptr::get() instead of operator->()
+
+Old intrusive pointer in operator->() simply returned a NULL pointer if
+so, boost::intrusive_ptr asserts on that. If explicitly used to obtain
+the pointer use get() instead.
+
+Signed-off-by: Kohei Yoshida <kohei.yoshida@suse.com>
+---
+ sc/inc/formularesult.hxx         |    2 +-
+ sc/source/core/tool/interpr4.cxx |    2 +-
+ sc/source/core/tool/token.cxx    |    2 +-
+ 3 files changed, 3 insertions(+), 3 deletions(-)
+
+diff --git a/sc/inc/formularesult.hxx b/sc/inc/formularesult.hxx
+index 706f3aa..bd68e52 100644
+--- sc/inc/formularesult.hxx
++++ sc/inc/formularesult.hxx
+@@ -407,7 +407,7 @@ inline bool ScFormulaResult::IsEmptyDisplayedAsString() const
+         // don't need to test for mpToken here, GetType() already did it
+         const ScEmptyCellToken* p = dynamic_cast<const ScEmptyCellToken*>(
+                 static_cast<const ScMatrixCellResultToken*>(
+-                    mpToken)->GetUpperLeftToken().operator->());
++                    mpToken)->GetUpperLeftToken().get());
+         if (p)
+             return p->IsDisplayedAsString();
+     }
+diff --git a/sc/source/core/tool/interpr4.cxx b/sc/source/core/tool/interpr4.cxx
+index 8de2e38..07ff54b 100644
+--- sc/source/core/tool/interpr4.cxx
++++ sc/source/core/tool/interpr4.cxx
+@@ -4307,7 +4307,7 @@ StackVar ScInterpreter::Interpret()
+     if (eType == svMatrix)
+         // Results are immutable in case they would be reused as input for new
+         // interpreters.
+-        static_cast<ScToken*>(xResult.operator->())->GetMatrix()->SetImmutable( true);
++        static_cast<ScToken*>(xResult.get())->GetMatrix()->SetImmutable( true);
+     return eType;
+ }
+ 
+diff --git a/sc/source/core/tool/token.cxx b/sc/source/core/tool/token.cxx
+index 1cf448e..5c4ece5 100644
+--- sc/source/core/tool/token.cxx
++++ sc/source/core/tool/token.cxx
+@@ -1062,7 +1062,7 @@ const ScMatrix* ScMatrixCellResultToken::GetMatrix() const  { return xMatrix.get
+ // satisfy vtable linkage.
+ ScMatrix* ScMatrixCellResultToken::GetMatrix()
+ {
+-    return const_cast<ScMatrix*>(xMatrix.operator->());
++    return const_cast<ScMatrix*>(xMatrix.get());
+ }
+ bool ScMatrixCellResultToken::operator==( const FormulaToken& r ) const
+ {
+-- 
+1.7.5.4
+
+
+From 2db0bea297ed0393fbf2b896e2f1b258d88dacdc Mon Sep 17 00:00:00 2001
+From: Lior Kaplan <kaplanlior@gmail.com>
+Date: Mon, 5 Sep 2011 16:41:20 +0100
+Subject: [calc 03/11] "thereof" should be translated to modern English
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+Signed-off-by: Caolán McNamara <caolanm@redhat.com>
+---
+ sc/source/ui/src/scstring.src |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/sc/source/ui/src/scstring.src b/sc/source/ui/src/scstring.src
+index e7ca0f5..00cce13 100644
+--- sc/source/ui/src/scstring.src
++++ sc/source/ui/src/scstring.src
+@@ -843,7 +843,7 @@ StringArray SCSTR_PRINT_OPTIONS
+         < "~All sheets"; >;
+         < "~Selected sheets"; >;
+         < "Selected cells"; >;
+-        < "Thereof print"; >;
++        < "From which print"; >;
+         < "All ~pages"; >;
+         < "Pa~ges"; >;
+         < "%PRODUCTNAME %s"; >;
+-- 
+1.7.5.4
+
+
+From 65799e2c71ad5d8c4eda4feeda33ceb774726260 Mon Sep 17 00:00:00 2001
+From: Kohei Yoshida <kohei.yoshida@suse.com>
+Date: Fri, 2 Sep 2011 14:45:27 -0400
+Subject: [calc 04/11] Speed up range name lookup by index.
+
+This should speed up formula calculations considerably during xls
+import since shared formulas are also stored in ScRangeName and
+they are looked up by index. (bnc#715104)
+
+Signed-off-by: Eike Rathke <erack@erack.de>
+---
+ sc/inc/rangenam.hxx              |    9 +++++++
+ sc/source/core/tool/rangenam.cxx |   45 +++++++++++++++++++++++++++-----------
+ 2 files changed, 41 insertions(+), 13 deletions(-)
+
+diff --git a/sc/inc/rangenam.hxx b/sc/inc/rangenam.hxx
+index 21cf333..86d33c6 100644
+--- sc/inc/rangenam.hxx
++++ sc/inc/rangenam.hxx
+@@ -36,6 +36,7 @@
+ #include "scdllapi.h"
+ 
+ #include <map>
++#include <vector>
+ #include <boost/ptr_container/ptr_set.hpp>
+ #include <boost/ptr_container/ptr_map.hpp>
+ 
+@@ -179,8 +180,10 @@ bool operator< (const ScRangeData& left, const ScRangeData& right);
+ class ScRangeName
+ {
+ private:
++    typedef std::vector<ScRangeData*> IndexDataType;
+     typedef ::boost::ptr_set<ScRangeData> DataType;
+     DataType maData;
++    IndexDataType maIndexToData;
+ 
+ public:
+     /// Map that manages stored ScRangeName instances.
+@@ -216,6 +219,12 @@ public:
+     bool empty() const;
+     SC_DLLPUBLIC bool insert(ScRangeData* p);
+     void erase(const ScRangeData& r);
++
++    /**
++     * Erase by iterator position.  Note that this method doesn't check for
++     * iterator's validity.  The caller must make sure that the iterator is
++     * valid.
++     */
+     void erase(const iterator& itr);
+     void clear();
+     bool operator== (const ScRangeName& r) const;
+diff --git a/sc/source/core/tool/rangenam.cxx b/sc/source/core/tool/rangenam.cxx
+index efad9fe..599590a 100644
+--- sc/source/core/tool/rangenam.cxx
++++ sc/source/core/tool/rangenam.cxx
+@@ -735,7 +735,7 @@ void ScRangeName::copyLocalNames(const TabNameMap& rNames, TabNameCopyMap& rCopy
+ ScRangeName::ScRangeName() {}
+ 
+ ScRangeName::ScRangeName(const ScRangeName& r) :
+-    maData(r.maData) {}
++    maData(r.maData), maIndexToData(r.maIndexToData) {}
+ 
+ const ScRangeData* ScRangeName::findByRange(const ScRange& rRange) const
+ {
+@@ -774,9 +774,12 @@ const ScRangeData* ScRangeName::findByUpperName(const OUString& rName) const
+ 
+ ScRangeData* ScRangeName::findByIndex(sal_uInt16 i)
+ {
+-    DataType::iterator itr = std::find_if(
+-        maData.begin(), maData.end(), MatchByIndex(i));
+-    return itr == maData.end() ? NULL : &(*itr);
++    if (!i)
++        // index should never be zero.
++        return NULL;
++
++    size_t nPos = i - 1;
++    return nPos < maIndexToData.size() ? maIndexToData[nPos] : NULL;
+ }
+ 
+ void ScRangeName::UpdateReference(
+@@ -845,35 +848,51 @@ bool ScRangeName::insert(ScRangeData* p)
+ 
+     if (!p->GetIndex())
+     {
+-        // Assign a new index.  An index must be unique.
+-        sal_uInt16 nHigh = 0;
+-        DataType::const_iterator itr = maData.begin(), itrEnd = maData.end();
+-        for (; itr != itrEnd; ++itr)
++        // Assign a new index.  An index must be unique and is never 0.
++        IndexDataType::iterator itr = std::find(
++            maIndexToData.begin(), maIndexToData.end(), static_cast<ScRangeData*>(NULL));
++        if (itr != maIndexToData.end())
+         {
+-            sal_uInt16 n = itr->GetIndex();
+-            if (n > nHigh)
+-                nHigh = n;
++            // Empty slot exists.  Re-use it.
++            size_t nPos = std::distance(maIndexToData.begin(), itr);
++            p->SetIndex(nPos + 1);
+         }
+-        p->SetIndex(nHigh + 1);
++        else
++            // No empty slot.  Append it to the end.
++            p->SetIndex(maIndexToData.size() + 1);
+     }
+ 
+     pair<DataType::iterator, bool> r = maData.insert(p);
++    if (r.second)
++    {
++        // Data inserted.  Store its index for mapping.
++        size_t nPos = p->GetIndex() - 1;
++        if (nPos >= maIndexToData.size())
++            maIndexToData.resize(nPos+1, NULL);
++        maIndexToData[nPos] = p;
++    }
+     return r.second;
+ }
+ 
+ void ScRangeName::erase(const ScRangeData& r)
+ {
+-    maData.erase(r);
++    DataType::iterator itr = maData.find(r);
++    if (itr != maData.end())
++        erase(itr);
+ }
+ 
+ void ScRangeName::erase(const iterator& itr)
+ {
++    sal_uInt16 nIndex = itr->GetIndex();
+     maData.erase(itr);
++    if (nIndex < maIndexToData.size())
++        maIndexToData[nIndex] = NULL;
+ }
+ 
+ void ScRangeName::clear()
+ {
+     maData.clear();
++    maIndexToData.clear();
+ }
+ 
+ bool ScRangeName::operator== (const ScRangeName& r) const
+-- 
+1.7.5.4
+
+
+From a961f15ce8dbf5bfbeb2b853cd82624f3a4c0692 Mon Sep 17 00:00:00 2001
+From: Eike Rathke <erack@erack.de>
+Date: Sun, 4 Sep 2011 23:48:23 +0200
+Subject: [calc 05/11] fixed various crashes due to newly introduced
+ ScRangeName::maIndexToData
+
+* The newly introduced ScRangeName::maIndexToData needs to take into
+  account that boost::ptr_set clones and deletes elements, hence each
+  collection needs its own maIndexToData setup in copy-ctor.
+* Also fixed ScRangeName::erase() where a wrong index element was set to NULL.
+
+Signed-off-by: Eike Rathke <erack@erack.de>
+---
+ sc/source/core/tool/rangenam.cxx |   23 ++++++++++++++++++++---
+ 1 files changed, 20 insertions(+), 3 deletions(-)
+
+diff --git a/sc/source/core/tool/rangenam.cxx b/sc/source/core/tool/rangenam.cxx
+index 599590a..35c00dc 100644
+--- sc/source/core/tool/rangenam.cxx
++++ sc/source/core/tool/rangenam.cxx
+@@ -735,7 +735,23 @@ void ScRangeName::copyLocalNames(const TabNameMap& rNames, TabNameCopyMap& rCopy
+ ScRangeName::ScRangeName() {}
+ 
+ ScRangeName::ScRangeName(const ScRangeName& r) :
+-    maData(r.maData), maIndexToData(r.maIndexToData) {}
++    maData(r.maData)
++{
++    // boost::ptr_set clones and deletes, so each collection needs its own
++    // index to data.
++    maIndexToData.resize( r.maIndexToData.size(), NULL);
++    DataType::const_iterator itr = maData.begin(), itrEnd = maData.end();
++    for (; itr != itrEnd; ++itr)
++    {
++        size_t nPos = itr->GetIndex() - 1;
++        if (nPos >= maIndexToData.size())
++        {
++            OSL_FAIL( "ScRangeName copy-ctor: maIndexToData size doesn't fit");
++            maIndexToData.resize(nPos+1, NULL);
++        }
++        maIndexToData[nPos] = const_cast<ScRangeData*>(&(*itr));
++    }
++}
+ 
+ const ScRangeData* ScRangeName::findByRange(const ScRange& rRange) const
+ {
+@@ -885,8 +901,9 @@ void ScRangeName::erase(const iterator& itr)
+ {
+     sal_uInt16 nIndex = itr->GetIndex();
+     maData.erase(itr);
+-    if (nIndex < maIndexToData.size())
+-        maIndexToData[nIndex] = NULL;
++    OSL_ENSURE( 0 < nIndex && nIndex <= maIndexToData.size(), "ScRangeName::erase: bad index");
++    if (0 < nIndex && nIndex <= maIndexToData.size())
++        maIndexToData[nIndex-1] = NULL;
+ }
+ 
+ void ScRangeName::clear()
+-- 
+1.7.5.4
+
+
+From 3eea3945e2457667a4e16d93bd2dec4ffaa88011 Mon Sep 17 00:00:00 2001
+From: Eike Rathke <erack@erack.de>
+Date: Tue, 6 Sep 2011 02:10:41 +0200
+Subject: [calc 06/11] crash when modifing a named range
+
+Signed-off-by: Markus Mohrhard <markus.mohrhard@googlemail.com>
+---
+ sc/inc/rangenam.hxx               |    7 +++++++
+ sc/source/core/data/documen2.cxx  |    2 +-
+ sc/source/core/data/document.cxx  |   10 +++-------
+ sc/source/filter/excel/xiname.cxx |   15 +++++++++++----
+ sc/source/filter/html/htmlimp.cxx |    3 +--
+ sc/source/ui/app/inputwin.cxx     |    2 --
+ sc/source/ui/docshell/docfunc.cxx |    1 -
+ sc/source/ui/namedlg/namedlg.cxx  |    5 ++---
+ sc/source/ui/unoobj/nameuno.cxx   |    4 ++--
+ sc/source/ui/view/viewfunc.cxx    |    4 +---
+ 10 files changed, 28 insertions(+), 25 deletions(-)
+
+diff --git a/sc/inc/rangenam.hxx b/sc/inc/rangenam.hxx
+index 86d33c6..fdff278 100644
+--- sc/inc/rangenam.hxx
++++ sc/inc/rangenam.hxx
+@@ -217,7 +217,14 @@ public:
+     SC_DLLPUBLIC iterator end();
+     SC_DLLPUBLIC size_t size() const;
+     bool empty() const;
++
++    /** Insert object into set if not a duplicate.
++        @ATTENTION: The underlying ::boost::ptr_set_adapter::insert(p) takes
++        ownership of p and if it can't insert it deletes the object! So, if
++        this insert here returns false the object where p pointed to is gone!
++     */
+     SC_DLLPUBLIC bool insert(ScRangeData* p);
++
+     void erase(const ScRangeData& r);
+ 
+     /**
+diff --git a/sc/source/core/data/documen2.cxx b/sc/source/core/data/documen2.cxx
+index 80b0c12..97292ca 100644
+--- sc/source/core/data/documen2.cxx
++++ sc/source/core/data/documen2.cxx
+@@ -1015,7 +1015,7 @@ sal_uLong ScDocument::TransferTab( ScDocument* pSrcDoc, SCTAB nSrcPos,
+                             if (!pRangeName->insert(pData))
+                             {
+                                 OSL_FAIL("can't insert name");     // shouldn't happen
+-                                delete pData;
++                                pData = NULL;
+                             }
+                             else
+                             {
+diff --git a/sc/source/core/data/document.cxx b/sc/source/core/data/document.cxx
+index 3e86a75..6668b74 100644
+--- sc/source/core/data/document.cxx
++++ sc/source/core/data/document.cxx
+@@ -1719,9 +1719,7 @@ void ScDocument::TransposeClip( ScDocument* pTransClip, sal_uInt16 nFlags, sal_B
+         {
+             sal_uInt16 nIndex = itr->GetIndex();
+             ScRangeData* pData = new ScRangeData(*itr);
+-            if (!pTransClip->pRangeName->insert(pData))
+-                delete pData;
+-            else
++            if (pTransClip->pRangeName->insert(pData))
+                 pData->SetIndex(nIndex);
+         }
+     }
+@@ -1784,9 +1782,7 @@ void copyUsedNamesToClip(ScRangeName* pClipRangeName, ScRangeName* pRangeName, c
+             continue;
+ 
+         ScRangeData* pData = new ScRangeData(*itr);
+-        if (!pClipRangeName->insert(pData))
+-            delete pData;
+-        else
++        if (pClipRangeName->insert(pData))
+             pData->SetIndex(nIndex);
+     }
+ }
+@@ -1894,7 +1890,7 @@ void ScDocument::CopyRangeNamesFromClip(ScDocument* pClipDoc, ScClipRangeNameDat
+             }
+             else
+             {   // must be an overflow
+-                delete pData;
++                pData = NULL;
+                 aClipRangeNames.insert(itr->GetIndex(), 0);
+                 aClipRangeNames.mbReplace = true;
+             }
+diff --git a/sc/source/filter/excel/xiname.cxx b/sc/source/filter/excel/xiname.cxx
+index 8a80f52..938fb69 100644
+--- sc/source/filter/excel/xiname.cxx
++++ sc/source/filter/excel/xiname.cxx
+@@ -216,14 +216,20 @@ XclImpName::XclImpName( XclImpStream& rStrm, sal_uInt16 nXclNameIdx ) :
+         pData->GuessPosition();             // calculate base position for relative refs
+         pData->SetIndex( nXclNameIdx );     // used as unique identifier in formulas
+         if (nXclTab == EXC_NAME_GLOBAL)
+-            GetDoc().GetRangeName()->insert(pData);
++        {
++            if (!GetDoc().GetRangeName()->insert(pData))
++                pData = NULL;
++        }
+         else
+         {
+             ScRangeName* pLocalNames = GetDoc().GetRangeName(mnScTab);
+             if (pLocalNames)
+-                pLocalNames->insert(pData);
++            {
++                if (!pLocalNames->insert(pData))
++                    pData = NULL;
++            }
+ 
+-            if (GetBiff() == EXC_BIFF8)
++            if (GetBiff() == EXC_BIFF8 && pData)
+             {
+                 ScRange aRange;
+                 // discard deleted ranges ( for the moment at least )
+@@ -233,7 +239,8 @@ XclImpName::XclImpName( XclImpStream& rStrm, sal_uInt16 nXclNameIdx ) :
+                 }
+             }
+         }
+-        mpScData = pData;                   // cache for later use
++        if (pData)
++            mpScData = pData;               // cache for later use
+     }
+ }
+ 
+diff --git a/sc/source/filter/html/htmlimp.cxx b/sc/source/filter/html/htmlimp.cxx
+index b8a5575..7ebe5e1 100644
+--- sc/source/filter/html/htmlimp.cxx
++++ sc/source/filter/html/htmlimp.cxx
+@@ -132,8 +132,7 @@ void ScHTMLImport::InsertRangeName( ScDocument* pDoc, const String& rName, const
+     ScTokenArray aTokArray;
+     aTokArray.AddDoubleReference( aRefData );
+     ScRangeData* pRangeData = new ScRangeData( pDoc, rName, aTokArray );
+-    if( !pDoc->GetRangeName()->insert( pRangeData ) )
+-        delete pRangeData;
++    pDoc->GetRangeName()->insert( pRangeData );
+ }
+ 
+ void ScHTMLImport::WriteToDocument(
+diff --git a/sc/source/ui/app/inputwin.cxx b/sc/source/ui/app/inputwin.cxx
+index 49c35a4..4f377ef 100644
+--- sc/source/ui/app/inputwin.cxx
++++ sc/source/ui/app/inputwin.cxx
+@@ -1690,8 +1690,6 @@ void ScPosWnd::DoEnter()
+                             aFunc.ModifyRangeNames( aNewRanges );
+                             pViewSh->UpdateInputHandler(true);
+                         }
+-                        else
+-                            delete pNew;        // shouldn't happen
+                     }
+                 }
+                 else
+diff --git a/sc/source/ui/docshell/docfunc.cxx b/sc/source/ui/docshell/docfunc.cxx
+index b752383..89d99b9 100644
+--- sc/source/ui/docshell/docfunc.cxx
++++ sc/source/ui/docshell/docfunc.cxx
+@@ -4610,7 +4610,6 @@ void ScDocFunc::CreateOneName( ScRangeName& rList,
+                 if (!rList.insert(pData))
+                 {
+                     OSL_FAIL("nanu?");
+-                    delete pData;
+                 }
+             }
+         }
+diff --git a/sc/source/ui/namedlg/namedlg.cxx b/sc/source/ui/namedlg/namedlg.cxx
+index 2452d83..157c316 100644
+--- sc/source/ui/namedlg/namedlg.cxx
++++ sc/source/ui/namedlg/namedlg.cxx
+@@ -388,8 +388,7 @@ bool ScNameDlg::AddPushed()
+                 //	  in ein Token-Array uebersetzt werden?)
+                 if ( 0 == pNewEntry->GetErrCode() )
+                 {
+-                    rtl::OUString aUpper = aNewEntry;
+-                    aUpper.toAsciiUpperCase();
++                    rtl::OUString aUpper( ScGlobal::pCharClass->upper( aNewEntry ) );
+                     ScRangeData* pData = mpCurRangeName->findByUpperName(aUpper);
+                     if (pData)
+                     {
+@@ -400,7 +399,7 @@ bool ScNameDlg::AddPushed()
+                         mpImpl->Clear();
+ 
+                     if ( !mpCurRangeName->insert( pNewEntry ) )
+-                        delete pNewEntry;
++                        pNewEntry = NULL;
+ 
+                     UpdateNames();
+                     bSaved=false;
+diff --git a/sc/source/ui/unoobj/nameuno.cxx b/sc/source/ui/unoobj/nameuno.cxx
+index 52d9006..baae085 100644
+--- sc/source/ui/unoobj/nameuno.cxx
++++ sc/source/ui/unoobj/nameuno.cxx
+@@ -192,7 +192,7 @@ void ScNamedRangeObj::Modify_Impl( const String* pNewName, const ScTokenArray* p
+     }
+     else
+     {
+-        delete pNew;		//! uno::Exception/Fehler oder so
++        pNew = NULL;
+         delete pNewRanges;
+     }
+ }
+@@ -577,7 +577,7 @@ void SAL_CALL ScNamedRangesObj::addNewByName( const rtl::OUString& aName,
+             }
+             else
+             {
+-                delete pNew;
++                pNew = NULL;
+                 delete pNewRanges;
+             }
+         }
+diff --git a/sc/source/ui/view/viewfunc.cxx b/sc/source/ui/view/viewfunc.cxx
+index 85f7b06..9a8587c 100644
+--- sc/source/ui/view/viewfunc.cxx
++++ sc/source/ui/view/viewfunc.cxx
+@@ -2945,10 +2945,8 @@ sal_Bool ScViewFunc::InsertName( const String& rName, const String& rSymbol,
+         }
+ 
+         if ( pList->insert( pNewEntry ) )
+-        {
+-            pNewEntry = NULL;	// nicht loeschen
+             bOk = sal_True;
+-        }
++        pNewEntry = NULL; // never delete, insert took ownership
+ 
+         pDoc->CompileNameFormula( false );	// CompileFormulaString
+         aModificator.SetDocumentModified();
+-- 
+1.7.5.4
+
+
+From 577bf305f26f70cb3ef9dee9f0063f8bbbb3e51b Mon Sep 17 00:00:00 2001
+From: Markus Mohrhard <markus.mohrhard@googlemail.com>
+Date: Tue, 6 Sep 2011 21:31:00 +0200
+Subject: [calc 07/11] don't extend the merged area by one for shadows
+
+Signed-off-by: Eike Rathke <erack@erack.de>
+---
+ sc/inc/attarray.hxx               |    2 +-
+ sc/inc/column.hxx                 |    2 +-
+ sc/inc/document.hxx               |    6 +++---
+ sc/inc/table.hxx                  |    2 +-
+ sc/source/core/data/attarray.cxx  |   15 +--------------
+ sc/source/core/data/column.cxx    |    4 ++--
+ sc/source/core/data/documen9.cxx  |    2 +-
+ sc/source/core/data/document.cxx  |   12 ++++++------
+ sc/source/core/data/table2.cxx    |    4 ++--
+ sc/source/ui/docshell/docfunc.cxx |   10 +++++-----
+ sc/source/ui/undo/undoblk.cxx     |    2 +-
+ sc/source/ui/view/printfun.cxx    |    2 +-
+ sc/source/ui/view/viewdata.cxx    |    2 +-
+ sc/source/ui/view/viewfun3.cxx    |    2 +-
+ 14 files changed, 27 insertions(+), 40 deletions(-)
+
+diff --git a/sc/inc/attarray.hxx b/sc/inc/attarray.hxx
+index dcf58aa..678fb70 100644
+--- sc/inc/attarray.hxx
++++ sc/inc/attarray.hxx
+@@ -161,7 +161,7 @@ public:
+     bool    HasAttrib( SCROW nRow1, SCROW nRow2, sal_uInt16 nMask ) const;
+     sal_Bool	ExtendMerge( SCCOL nThisCol, SCROW nStartRow, SCROW nEndRow,
+                                 SCCOL& rPaintCol, SCROW& rPaintRow,
+-                                sal_Bool bRefresh, sal_Bool bAttrs );
++                                sal_Bool bRefresh );
+     sal_Bool	RemoveAreaMerge( SCROW nStartRow, SCROW nEndRow );
+ 
+     void	FindStyleSheet( const SfxStyleSheetBase* pStyleSheet, ScFlatBoolRowSegments& rUsedRows, bool bReset );
+diff --git a/sc/inc/column.hxx b/sc/inc/column.hxx
+index dcd7b64..d4a60af 100644
+--- sc/inc/column.hxx
++++ sc/inc/column.hxx
+@@ -156,7 +156,7 @@ public:
+     bool    HasAttribSelection( const ScMarkData& rMark, sal_uInt16 nMask ) const;
+     bool    ExtendMerge( SCCOL nThisCol, SCROW nStartRow, SCROW nEndRow,
+                                 SCCOL& rPaintCol, SCROW& rPaintRow,
+-                                bool bRefresh, bool bAttrs );
++                                bool bRefresh );
+ 
+     bool               IsEmptyVisData(bool bNotes) const;              // without Broadcaster
+     bool               IsEmptyData() const;
+diff --git a/sc/inc/document.hxx b/sc/inc/document.hxx
+index 4c7202b..1f17f4f 100644
+--- sc/inc/document.hxx
++++ sc/inc/document.hxx
+@@ -811,11 +811,11 @@ public:
+ 
+     sal_Bool            ExtendMergeSel( SCCOL nStartCol, SCROW nStartRow,
+                                 SCCOL& rEndCol, SCROW& rEndRow, const ScMarkData& rMark,
+-                                sal_Bool bRefresh = false, sal_Bool bAttrs = false );
++                                sal_Bool bRefresh = false );
+     sal_Bool			ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+                                 SCCOL& rEndCol, SCROW& rEndRow, SCTAB nTab,
+-                                sal_Bool bRefresh = false, sal_Bool bAttrs = false );
+-    sal_Bool			ExtendMerge( ScRange& rRange, sal_Bool bRefresh = false, sal_Bool bAttrs = false );
++                                sal_Bool bRefresh = false );
++    sal_Bool			ExtendMerge( ScRange& rRange, sal_Bool bRefresh = false );
+     sal_Bool			ExtendTotalMerge( ScRange& rRange );
+     SC_DLLPUBLIC sal_Bool			ExtendOverlapped( SCCOL& rStartCol, SCROW& rStartRow,
+                                 SCCOL nEndCol, SCROW nEndRow, SCTAB nTab );
+diff --git a/sc/inc/table.hxx b/sc/inc/table.hxx
+index 36bd138..7b47cd0 100644
+--- sc/inc/table.hxx
++++ sc/inc/table.hxx
+@@ -516,7 +516,7 @@ public:
+     bool        HasAttribSelection( const ScMarkData& rMark, sal_uInt16 nMask ) const;
+     bool        ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+                                 SCCOL& rEndCol, SCROW& rEndRow,
+-                                sal_Bool bRefresh, sal_Bool bAttrs );
++                                sal_Bool bRefresh );
+     const SfxPoolItem*		GetAttr( SCCOL nCol, SCROW nRow, sal_uInt16 nWhich ) const;
+     const ScPatternAttr*	GetPattern( SCCOL nCol, SCROW nRow ) const;
+     const ScPatternAttr*    GetMostUsedPattern( SCCOL nCol, SCROW nStartRow, SCROW nEndRow ) const;
+diff --git a/sc/source/core/data/attarray.cxx b/sc/source/core/data/attarray.cxx
+index 6741093..5366845 100644
+--- sc/source/core/data/attarray.cxx
++++ sc/source/core/data/attarray.cxx
+@@ -1349,7 +1349,7 @@ bool ScAttrArray::HasAttrib( SCROW nRow1, SCROW nRow2, sal_uInt16 nMask ) const
+ // Area around any given summaries expand and adapt any MergeFlag (bRefresh)
+ sal_Bool ScAttrArray::ExtendMerge( SCCOL nThisCol, SCROW nStartRow, SCROW nEndRow,
+                                 SCCOL& rPaintCol, SCROW& rPaintRow,
+-                                sal_Bool bRefresh, sal_Bool bAttrs )
++                                sal_Bool bRefresh )
+ {
+     const ScPatternAttr* pPattern;
+     const ScMergeAttr* pItem;
+@@ -1376,19 +1376,6 @@ sal_Bool ScAttrArray::ExtendMerge( SCCOL nThisCol, SCROW nStartRow, SCROW nEndRo
+                 rPaintRow = nMergeEndRow;
+             bFound = sal_True;
+ 
+-            if (bAttrs)
+-            {
+-                const SvxShadowItem* pShadow =
+-                        (const SvxShadowItem*) &pPattern->GetItem( ATTR_SHADOW );
+-                SvxShadowLocation eLoc = pShadow->GetLocation();
+-                if ( eLoc == SVX_SHADOW_TOPRIGHT || eLoc == SVX_SHADOW_BOTTOMRIGHT )
+-                    if ( nMergeEndCol+1 > rPaintCol && nMergeEndCol < MAXCOL )
+-                        rPaintCol = nMergeEndCol+1;
+-                if ( eLoc == SVX_SHADOW_BOTTOMLEFT || eLoc == SVX_SHADOW_BOTTOMRIGHT )
+-                    if ( nMergeEndRow+1 > rPaintRow && nMergeEndRow < MAXROW )
+-                        rPaintRow = nMergeEndRow+1;
+-            }
+-
+             if (bRefresh)
+             {
+                 if ( nMergeEndCol > nThisCol )
+diff --git a/sc/source/core/data/column.cxx b/sc/source/core/data/column.cxx
+index 471c0dc..5fecb2d 100644
+--- sc/source/core/data/column.cxx
++++ sc/source/core/data/column.cxx
+@@ -280,9 +280,9 @@ bool ScColumn::HasAttribSelection( const ScMarkData& rMark, sal_uInt16 nMask ) c
+ 
+ bool ScColumn::ExtendMerge( SCCOL nThisCol, SCROW nStartRow, SCROW nEndRow,
+                             SCCOL& rPaintCol, SCROW& rPaintRow,
+-                            bool bRefresh, bool bAttrs )
++                            bool bRefresh )
+ {
+-    return pAttrArray->ExtendMerge( nThisCol, nStartRow, nEndRow, rPaintCol, rPaintRow, bRefresh, bAttrs );
++    return pAttrArray->ExtendMerge( nThisCol, nStartRow, nEndRow, rPaintCol, rPaintRow, bRefresh );
+ }
+ 
+ 
+diff --git a/sc/source/core/data/documen9.cxx b/sc/source/core/data/documen9.cxx
+index 3d58b87..2dc90d6 100644
+--- sc/source/core/data/documen9.cxx
++++ sc/source/core/data/documen9.cxx
+@@ -512,7 +512,7 @@ sal_Bool ScDocument::IsPrintEmpty( SCTAB nTab, SCCOL nStartCol, SCROW nStartRow,
+         SCROW nTmpRow = nEndRow;
+ 
+         pThis->ExtendMerge( 0,nStartRow, nExtendCol,nTmpRow, nTab,
+-                            false, sal_True );		// kein Refresh, incl. Attrs
++                            false );		// kein Refresh, incl. Attrs
+ 
+         OutputDevice* pDev = pThis->GetPrinter();
+         pDev->SetMapMode( MAP_PIXEL );				// wichtig fuer GetNeededSize
+diff --git a/sc/source/core/data/document.cxx b/sc/source/core/data/document.cxx
+index 6668b74..fa80311 100644
+--- sc/source/core/data/document.cxx
++++ sc/source/core/data/document.cxx
+@@ -4677,7 +4677,7 @@ sal_Bool ScDocument::ExtendOverlapped( SCCOL& rStartCol, SCROW& rStartRow,
+ 
+ sal_Bool ScDocument::ExtendMergeSel( SCCOL nStartCol, SCROW nStartRow,
+                               SCCOL& rEndCol, SCROW& rEndRow,
+-                              const ScMarkData& rMark, sal_Bool bRefresh, sal_Bool bAttrs )
++                              const ScMarkData& rMark, sal_Bool bRefresh )
+ {
+     // use all selected sheets from rMark
+ 
+@@ -4690,7 +4690,7 @@ sal_Bool ScDocument::ExtendMergeSel( SCCOL nStartCol, SCROW nStartRow,
+         {
+             SCCOL nThisEndCol = nOldEndCol;
+             SCROW nThisEndRow = nOldEndRow;
+-            if ( ExtendMerge( nStartCol, nStartRow, nThisEndCol, nThisEndRow, nTab, bRefresh, bAttrs ) )
++            if ( ExtendMerge( nStartCol, nStartRow, nThisEndCol, nThisEndRow, nTab, bRefresh ) )
+                 bFound = sal_True;
+             if ( nThisEndCol > rEndCol )
+                 rEndCol = nThisEndCol;
+@@ -4704,13 +4704,13 @@ sal_Bool ScDocument::ExtendMergeSel( SCCOL nStartCol, SCROW nStartRow,
+ 
+ sal_Bool ScDocument::ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+                               SCCOL& rEndCol,  SCROW& rEndRow,
+-                              SCTAB nTab, sal_Bool bRefresh, sal_Bool bAttrs )
++                              SCTAB nTab, sal_Bool bRefresh )
+ {
+     sal_Bool bFound = false;
+     if ( ValidColRow(nStartCol,nStartRow) && ValidColRow(rEndCol,rEndRow) && ValidTab(nTab) )
+     {
+         if (pTab[nTab])
+-            bFound = pTab[nTab]->ExtendMerge( nStartCol, nStartRow, rEndCol, rEndRow, bRefresh, bAttrs );
++            bFound = pTab[nTab]->ExtendMerge( nStartCol, nStartRow, rEndCol, rEndRow, bRefresh );
+ 
+         if (bRefresh)
+             RefreshAutoFilter( nStartCol, nStartRow, rEndCol, rEndRow, nTab );
+@@ -4724,7 +4724,7 @@ sal_Bool ScDocument::ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+ }
+ 
+ 
+-sal_Bool ScDocument::ExtendMerge( ScRange& rRange, sal_Bool bRefresh, sal_Bool bAttrs )
++sal_Bool ScDocument::ExtendMerge( ScRange& rRange, sal_Bool bRefresh )
+ {
+     sal_Bool bFound = false;
+     SCTAB nStartTab = rRange.aStart.Tab();
+@@ -4739,7 +4739,7 @@ sal_Bool ScDocument::ExtendMerge( ScRange& rRange, sal_Bool bRefresh, sal_Bool b
+         SCROW nExtendRow = rRange.aEnd.Row();
+         if (ExtendMerge( rRange.aStart.Col(), rRange.aStart.Row(),
+                          nExtendCol,          nExtendRow,
+-                         nTab, bRefresh, bAttrs ) )
++                         nTab, bRefresh ) )
+         {
+             bFound = sal_True;
+             if (nExtendCol > nEndCol) nEndCol = nExtendCol;
+diff --git a/sc/source/core/data/table2.cxx b/sc/source/core/data/table2.cxx
+index 37b9e75..7d7d554 100644
+--- sc/source/core/data/table2.cxx
++++ sc/source/core/data/table2.cxx
+@@ -1389,7 +1389,7 @@ bool ScTable::HasAttribSelection( const ScMarkData& rMark, sal_uInt16 nMask ) co
+ 
+ bool ScTable::ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+                            SCCOL& rEndCol, SCROW& rEndRow,
+-                           sal_Bool bRefresh, sal_Bool bAttrs )
++                           sal_Bool bRefresh )
+ {
+     if (!(ValidCol(nStartCol) && ValidCol(rEndCol)))
+     {
+@@ -1400,7 +1400,7 @@ bool ScTable::ExtendMerge( SCCOL nStartCol, SCROW nStartRow,
+     SCCOL nOldEndX = rEndCol;
+     SCROW nOldEndY = rEndRow;
+     for (SCCOL i=nStartCol; i<=nOldEndX; i++)
+-        bFound |= aCol[i].ExtendMerge( i, nStartRow, nOldEndY, rEndCol, rEndRow, bRefresh, bAttrs );
++        bFound |= aCol[i].ExtendMerge( i, nStartRow, nOldEndY, rEndCol, rEndRow, bRefresh );
+     return bFound;
+ }
+ 
+diff --git a/sc/source/ui/docshell/docfunc.cxx b/sc/source/ui/docshell/docfunc.cxx
+index 89d99b9..24e4517 100644
+--- sc/source/ui/docshell/docfunc.cxx
++++ sc/source/ui/docshell/docfunc.cxx
+@@ -1536,7 +1536,7 @@ sal_Bool ScDocFunc::InsertCells( const ScRange& rRange, const ScMarkData* pTabMa
+                     {
+                         ScRange aRange( nTestCol, nTestRow1, i );
+                         pDoc->ExtendOverlapped(aRange);
+-                        pDoc->ExtendMerge(aRange, sal_True, sal_True);
++                        pDoc->ExtendMerge(aRange, sal_True);
+ 
+                         if( nTestRow1 < nTestRow2 && nNewFlags == SC_MF_HOR )
+                         {
+@@ -1544,7 +1544,7 @@ sal_Bool ScDocFunc::InsertCells( const ScRange& rRange, const ScMarkData* pTabMa
+                             {
+                                 ScRange aTestRange( nTestCol, nTestRow, i );
+                                 pDoc->ExtendOverlapped( aTestRange );
+-                                pDoc->ExtendMerge( aTestRange, sal_True, sal_True);
++                                pDoc->ExtendMerge( aTestRange, sal_True);
+                                 ScRange aMergeRange( aTestRange.aStart.Col(),aTestRange.aStart.Row(), i );
+                                 if( !aExtendRange.In( aMergeRange ) )
+                                 {
+@@ -1946,7 +1946,7 @@ sal_Bool ScDocFunc::DeleteCells( const ScRange& rRange, const ScMarkData* pTabMa
+                     {
+                         ScRange aRange( nTestCol, nTestRow1, i );
+                         pDoc->ExtendOverlapped( aRange );
+-                        pDoc->ExtendMerge( aRange, sal_True, sal_True );
++                        pDoc->ExtendMerge( aRange, sal_True );
+ 
+                         if( nTestRow1 < nTestRow2 && nNewFlags == SC_MF_HOR )
+                         {
+@@ -1954,7 +1954,7 @@ sal_Bool ScDocFunc::DeleteCells( const ScRange& rRange, const ScMarkData* pTabMa
+                             {
+                                 ScRange aTestRange( nTestCol, nTestRow, i );
+                                 pDoc->ExtendOverlapped( aTestRange );
+-                                pDoc->ExtendMerge( aTestRange, sal_True, sal_True);
++                                pDoc->ExtendMerge( aTestRange, sal_True );
+                                 ScRange aMergeRange( aTestRange.aStart.Col(),aTestRange.aStart.Row(), i );
+                                 if( !aExtendRange.In( aMergeRange ) )
+                                 {
+@@ -4458,7 +4458,7 @@ bool ScDocFunc::UnmergeCells( const ScCellMergeOption& rOption, sal_Bool bRecord
+                               aExtended.aEnd.Col(), aExtended.aEnd.Row(), nTab,
+                               SC_MF_HOR | SC_MF_VER );
+ 
+-        pDoc->ExtendMerge( aRefresh, sal_True, false );
++        pDoc->ExtendMerge( aRefresh, sal_True );
+ 
+         if ( !AdjustRowHeight( aExtended ) )
+             rDocShell.PostPaint( aExtended, PAINT_GRID );
+diff --git a/sc/source/ui/undo/undoblk.cxx b/sc/source/ui/undo/undoblk.cxx
+index 71dded2..17588d5 100644
+--- sc/source/ui/undo/undoblk.cxx
++++ sc/source/ui/undo/undoblk.cxx
+@@ -2131,7 +2131,7 @@ void ScUndoRemoveMerge::Redo()
+                               maOption.mnEndCol, maOption.mnEndRow, nTab,
+                               SC_MF_HOR | SC_MF_VER );
+ 
+-        pDoc->ExtendMerge(aRange, true, false);
++        pDoc->ExtendMerge(aRange, true);
+ 
+         //	Paint
+ 
+diff --git a/sc/source/ui/view/printfun.cxx b/sc/source/ui/view/printfun.cxx
+index 7fd44dc..0943ff1 100644
+--- sc/source/ui/view/printfun.cxx
++++ sc/source/ui/view/printfun.cxx
+@@ -779,7 +779,7 @@ sal_Bool ScPrintFunc::AdjustPrintArea( sal_Bool bNew )
+     }
+ 
+     pDoc->ExtendMerge( nStartCol,nStartRow, nEndCol,nEndRow, nPrintTab,
+-                        false, sal_True );		// kein Refresh, incl. Attrs
++                        false );		// kein Refresh, incl. Attrs
+ 
+     if ( bChangeCol )
+     {
+diff --git a/sc/source/ui/view/viewdata.cxx b/sc/source/ui/view/viewdata.cxx
+index c3e4d0c..96ccccb 100644
+--- sc/source/ui/view/viewdata.cxx
++++ sc/source/ui/view/viewdata.cxx
+@@ -1820,7 +1820,7 @@ sal_Bool ScViewData::GetPosFromPixel( long nClickX, long nClickY, ScSplitPos eWh
+                 pDoc->RemoveFlagsTab( 0,0, MAXCOL,MAXROW, nTabNo, SC_MF_HOR | SC_MF_VER );
+                 SCCOL nEndCol = MAXCOL;
+                 SCROW nEndRow = MAXROW;
+-                pDoc->ExtendMerge( 0,0, nEndCol,nEndRow, nTabNo, sal_True, false );
++                pDoc->ExtendMerge( 0,0, nEndCol,nEndRow, nTabNo, sal_True );
+                 if (pDocShell)
+                     pDocShell->PostPaint( ScRange(0,0,nTabNo,MAXCOL,MAXROW,nTabNo), PAINT_GRID );
+             }
+diff --git a/sc/source/ui/view/viewfun3.cxx b/sc/source/ui/view/viewfun3.cxx
+index 222571a..f0aa3b5 100644
+--- sc/source/ui/view/viewfun3.cxx
++++ sc/source/ui/view/viewfun3.cxx
+@@ -1424,7 +1424,7 @@ sal_Bool ScViewFunc::PasteFromClip( sal_uInt16 nFlags, ScDocument* pClipDoc,
+                 {
+                     ScRange aRange(nCol, nRow1, nStartTab);
+                     pDoc->ExtendOverlapped(aRange);
+-                    pDoc->ExtendMerge(aRange, sal_True, sal_True);
++                    pDoc->ExtendMerge(aRange, sal_True);
+                     rDocFunc.UnmergeCells(aRange, bRecord, sal_True);
+                 }
+             }
+-- 
+1.7.5.4
+
+
+From 8ceb17039c1bbfcb8d64eef9265b99238addcf6a Mon Sep 17 00:00:00 2001
+From: Kohei Yoshida <kohei.yoshida@suse.com>
+Date: Tue, 30 Aug 2011 13:11:47 -0400
+Subject: [calc 08/11] Adjust the dialog size to make sure the bottom text is
+ visible.
+
+This ensures that the bottom text "Drag the fields from ..." is
+visible on all platforms.  Previously this text overlapped with
+the data and row field windows on Windows XP.
+
+Signed-off-by: Tor Lillqvist <tlillqvist@suse.com>
+---
+ sc/source/ui/dbgui/dpuiglobal.hxx |    1 +
+ sc/source/ui/dbgui/pvlaydlg.cxx   |   67 +++++++++++++++++++++++++++++++++++++
+ sc/source/ui/inc/pvlaydlg.hxx     |    1 +
+ 3 files changed, 69 insertions(+), 0 deletions(-)
+
+diff --git a/sc/source/ui/dbgui/dpuiglobal.hxx b/sc/source/ui/dbgui/dpuiglobal.hxx
+index d27d827..d112580 100644
+--- sc/source/ui/dbgui/dpuiglobal.hxx
++++ sc/source/ui/dbgui/dpuiglobal.hxx
+@@ -36,6 +36,7 @@
+ #define FIELD_BTN_HEIGHT    23
+ #define SELECT_FIELD_BTN_SPACE   2
+ #define FIELD_AREA_GAP       3   // gap between row/column/data/page areas
++#define TEXT_INFO_GAP        5 // gap between the row/data areas and the text notice below.
+ 
+ #endif
+ 
+diff --git a/sc/source/ui/dbgui/pvlaydlg.cxx b/sc/source/ui/dbgui/pvlaydlg.cxx
+index 6616595..475c0ce 100644
+--- sc/source/ui/dbgui/pvlaydlg.cxx
++++ sc/source/ui/dbgui/pvlaydlg.cxx
+@@ -1345,6 +1345,73 @@ void ScDPLayoutDlg::CalcWndSizes()
+     aWndCol.CalcSize();
+     aWndData.CalcSize();
+     aWndSelect.CalcSize();
++
++    AdjustDlgSize();
++}
++
++namespace {
++
++class MoveWndDown : public std::unary_function<Window*, void>
++{
++    long mnDelta;
++public:
++    MoveWndDown(long nDelta) : mnDelta(nDelta) {}
++    void operator() (Window* p) const
++    {
++        Point aPos = p->GetPosPixel();
++        aPos.Y() += mnDelta;
++        p->SetPosPixel(aPos);
++    }
++};
++
++}
++
++void ScDPLayoutDlg::AdjustDlgSize()
++{
++    // On some platforms such as Windows XP, the dialog is not large enough to
++    // show the 'Drag the fields from the right...' text at the bottom. Check
++    // if it overlaps, and if it does, make the dialog size larger.
++    Size aWndSize = GetSizePixel();
++
++    Point aPosText = aFtInfo.GetPosPixel();
++    Size aSizeText = aFtInfo.GetSizePixel();
++    long nYRef = aWndData.GetPosPixel().Y() + aWndData.GetSizePixel().Height();
++    if (aPosText.Y() > nYRef)
++        // This text is visible. No need to adjust.
++        return;
++
++    // Calculate the extra height necessary.
++    long nBottomMargin = aWndSize.Height() - (aPosText.Y() + aSizeText.Height());
++    long nHeightNeeded = nYRef + TEXT_INFO_GAP + aSizeText.Height() + nBottomMargin;
++    long nDelta = nHeightNeeded - aWndSize.Height();
++    if (nDelta <= 0)
++        // This should never happen but just in case....
++        return;
++
++    // Make the main dialog taller.
++    aWndSize.Height() += nDelta;
++    SetSizePixel(aWndSize);
++
++    // Move the relevant controls downward.
++    std::vector<Window*> aWndToMove;
++    aWndToMove.reserve(16);
++    aWndToMove.push_back(&aFtInfo);
++    aWndToMove.push_back(&aBtnMore);
++    aWndToMove.push_back(&aFlAreas);
++    aWndToMove.push_back(&aFtInArea);
++    aWndToMove.push_back(&aEdInPos);
++    aWndToMove.push_back(&aRbInPos);
++    aWndToMove.push_back(&aFtOutArea);
++    aWndToMove.push_back(&aLbOutPos);
++    aWndToMove.push_back(&aEdOutPos);
++    aWndToMove.push_back(&aRbOutPos);
++    aWndToMove.push_back(&aBtnIgnEmptyRows);
++    aWndToMove.push_back(&aBtnDetectCat);
++    aWndToMove.push_back(&aBtnTotalCol);
++    aWndToMove.push_back(&aBtnTotalRow);
++    aWndToMove.push_back(&aBtnFilter);
++    aWndToMove.push_back(&aBtnDrillDown);
++    std::for_each(aWndToMove.begin(), aWndToMove.end(), MoveWndDown(nDelta));
+ }
+ 
+ namespace {
+diff --git a/sc/source/ui/inc/pvlaydlg.hxx b/sc/source/ui/inc/pvlaydlg.hxx
+index 875f25d..3ffcd64 100644
+--- sc/source/ui/inc/pvlaydlg.hxx
++++ sc/source/ui/inc/pvlaydlg.hxx
+@@ -196,6 +196,7 @@ private:
+     void                    InitFocus       ();
+     void                    InitFields      ();
+     void                    CalcWndSizes    ();
++    void                    AdjustDlgSize();
+     Point                   DlgPos2WndPos   ( const Point& rPt, Window& rWnd );
+     ScDPLabelData*          GetLabelData    ( SCsCOL nCol, size_t* pPos = NULL );
+     String                  GetLabelString  ( SCsCOL nCol );
+-- 
+1.7.5.4
+
+
+From 6dcc0967b83b77ab289abcb1a3531469c6444a93 Mon Sep 17 00:00:00 2001
+From: Eike Rathke <erack@erack.de>
+Date: Tue, 13 Sep 2011 12:23:21 -0400
+Subject: [calc 09/11] fix fdo#39485 recalculate matrix formula dimension
+ correctly
+
+ScFormulaCell::GetMatrixEdge() when recalculating its dimension obtained
+the matrix origin of itself instead of a neighboring matrix formula if
+encountered such, effectively adding that other matrix to its own cells
+occupying dimension.
+
+Signed-off-by: Kohei Yoshida <kohei.yoshida@suse.com>
+---
+ sc/source/core/data/cell.cxx  |    5 +++++
+ sc/source/core/data/cell2.cxx |    9 ++++++---
+ 2 files changed, 11 insertions(+), 3 deletions(-)
+
+diff --git a/sc/source/core/data/cell.cxx b/sc/source/core/data/cell.cxx
+index 4651a2c..862cb4d 100644
+--- sc/source/core/data/cell.cxx
++++ sc/source/core/data/cell.cxx
+@@ -1681,7 +1681,12 @@ void ScFormulaCell::SetMatColsRows( SCCOL nCols, SCROW nRows )
+     if (pMat)
+         pMat->SetMatColsRows( nCols, nRows);
+     else if (nCols || nRows)
++    {
+         aResult.SetToken( new ScMatrixFormulaCellToken( nCols, nRows));
++        // Setting the new token actually forces an empty result at this top
++        // left cell, so have that recalculated.
++        SetDirty();
++    }
+ }
+ 
+ 
+diff --git a/sc/source/core/data/cell2.cxx b/sc/source/core/data/cell2.cxx
+index 5bac8e3..1023099 100644
+--- sc/source/core/data/cell2.cxx
++++ sc/source/core/data/cell2.cxx
+@@ -609,7 +609,8 @@ sal_uInt16 ScFormulaCell::GetMatrixEdge( ScAddress& rOrgPos )
+                 {
+                     pFCell->GetMatColsRows( nC, nR );
+                     if ( nC == 0 || nR == 0 )
+-                    {   // aus altem Dokument geladen, neu erzeugen
++                    {
++                        // No ScMatrixFormulaCellToken available yet, calculate new.
+                         nC = 1;
+                         nR = 1;
+                         ScAddress aTmpOrg;
+@@ -622,7 +623,8 @@ sal_uInt16 ScFormulaCell::GetMatrixEdge( ScAddress& rOrgPos )
+                             pCell = pDocument->GetCell( aAdr );
+                             if ( pCell && pCell->GetCellType() == CELLTYPE_FORMULA
+                               && ((ScFormulaCell*)pCell)->cMatrixFlag == MM_REFERENCE
+-                              && GetMatrixOrigin( aTmpOrg ) && aTmpOrg == aOrg )
++                              && ((ScFormulaCell*)pCell)->GetMatrixOrigin( aTmpOrg )
++                              && aTmpOrg == aOrg )
+                             {
+                                 nC++;
+                                 aAdr.IncCol();
+@@ -638,7 +640,8 @@ sal_uInt16 ScFormulaCell::GetMatrixEdge( ScAddress& rOrgPos )
+                             pCell = pDocument->GetCell( aAdr );
+                             if ( pCell && pCell->GetCellType() == CELLTYPE_FORMULA
+                               && ((ScFormulaCell*)pCell)->cMatrixFlag == MM_REFERENCE
+-                              && GetMatrixOrigin( aTmpOrg ) && aTmpOrg == aOrg )
++                              && ((ScFormulaCell*)pCell)->GetMatrixOrigin( aTmpOrg )
++                              && aTmpOrg == aOrg )
+                             {
+                                 nR++;
+                                 aAdr.IncRow();
+-- 
+1.7.5.4
+
+
+From 98daddfd67823a97c6e820357a2e2e8b111cf1ad Mon Sep 17 00:00:00 2001
+From: Kohei Yoshida <kohei.yoshida@suse.com>
+Date: Wed, 14 Sep 2011 17:55:53 +0200
+Subject: [calc 10/11] fda#35965: Mark all formula cells dirty when appending
+ a new sheet
+
+Signed-off-by: Markus Mohrhard <markus.mohrhard@googlemail.com>
+---
+ sc/source/core/data/document.cxx |    5 ++++-
+ 1 files changed, 4 insertions(+), 1 deletions(-)
+
+diff --git a/sc/source/core/data/document.cxx b/sc/source/core/data/document.cxx
+index fa80311..48cf99b 100644
+--- sc/source/core/data/document.cxx
++++ sc/source/core/data/document.cxx
+@@ -406,13 +406,16 @@ sal_Bool ScDocument::InsertTab( SCTAB nPos, const String& rName,
+                 if ( pChartListenerCollection )
+                     pChartListenerCollection->UpdateScheduledSeriesRanges();
+ 
+-                SetDirty();
+                 bValid = sal_True;
+             }
+             else
+                 bValid = false;
+         }
+     }
++
++    if (bValid)
++        SetDirty();
++
+     return bValid;
+ }
+ 
+-- 
+1.7.5.4
+
+reverting on repository components from libreoffice-3.4.3.2 to merge-base cf27f1ca55f9165983bc4cc6328f00d54eca1f54
+commits on repository components merge-base cf27f1ca55f9165983bc4cc6328f00d54eca1f54 to libreoffice-3.4.4.1
+From 87bfbda761a9ac7101310b591964c385e936f702 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Mon, 22 Aug 2011 11:33:42 +0100
+Subject: [components 1/5] Resolves: fdo#39348 toggling grammar checkbox
+ deletes sentence
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ cui/source/dialogs/SpellDialog.cxx |    3 ++-
+ 1 files changed, 2 insertions(+), 1 deletions(-)
+
+diff --git a/cui/source/dialogs/SpellDialog.cxx b/cui/source/dialogs/SpellDialog.cxx
+index e8b2dcb..86a3529 100644
+--- cui/source/dialogs/SpellDialog.cxx
++++ cui/source/dialogs/SpellDialog.cxx
+@@ -769,7 +769,8 @@ void SpellDialog::Impl_Restore()
+     //get a new sentence
+     aSentenceED.SetText(rtl::OUString());
+     aSentenceED.ResetModified();
+-    SpellContinue_Impl();
++    //Resolves: fdo#39348 refill the dialog with the currently spelled sentence
++    SpellContinue_Impl(true);
+     aIgnorePB.SetText(aIgnoreOnceST);
+ }
+ 
+-- 
+1.7.5.4
+
+
+From f36134b489f64ff79b1a9db34f611211cddb9844 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Thu, 25 Aug 2011 21:13:52 +0000
+Subject: [components 2/5] Resolves: fdo#36678 move init that depends on
+ parent to post-parent avail
+
+Signed-off-by: Jan Holesovsky <kendy@suse.cz>
+---
+ cui/source/dialogs/SpellDialog.cxx |   16 ++++++++++------
+ 1 files changed, 10 insertions(+), 6 deletions(-)
+
+diff --git a/cui/source/dialogs/SpellDialog.cxx b/cui/source/dialogs/SpellDialog.cxx
+index 86a3529..908d460 100644
+--- cui/source/dialogs/SpellDialog.cxx
++++ cui/source/dialogs/SpellDialog.cxx
+@@ -303,12 +303,6 @@ void SpellDialog::Init_Impl()
+     // initialize language ListBox
+     aLanguageLB.SetLanguageList( LANG_LIST_SPELL_USED, sal_False, sal_False, sal_True );
+ 
+-    // get current language
+-    UpdateBoxes_Impl();
+-
+-    // fill dictionary PopupMenu
+-    InitUserDicts();
+-
+     aSentenceED.ClearModifyFlag();
+     SvxGetChangeAllList()->clear();
+ }
+@@ -429,6 +423,12 @@ IMPL_STATIC_LINK( SpellDialog, InitHdl, SpellDialog *, EMPTYARG )
+     pThis->aSentenceED.ResetUndo();
+     pThis->aUndoPB.Enable(sal_False);
+ 
++    // get current language
++    pThis->UpdateBoxes_Impl();
++
++    // fill dictionary PopupMenu
++    pThis->InitUserDicts();
++
+     pThis->LockFocusChanges(true);
+     if( pThis->aChangePB.IsEnabled() )
+         pThis->aChangePB.GrabFocus();
+@@ -819,6 +819,10 @@ LanguageType SpellDialog::GetSelectedLang_Impl() const
+ //-------------------------------------------------
+ IMPL_LINK(SpellDialog, LanguageSelectHdl, SvxLanguageBox*, pBox)
+ {
++    //If selected language changes, then add->list should be regenerated to
++    //match
++    InitUserDicts();
++
+     //if currently an error is selected then search for alternatives for
+     //this word and fill the alternatives ListBox accordingly
+     String sError = aSentenceED.GetErrorText();
+-- 
+1.7.5.4
+
+
+From 0b3a80adb4df072be76445aff3d065d489f11db9 Mon Sep 17 00:00:00 2001
+From: Noel Power <nopower@suse.com>
+Date: Wed, 21 Sep 2011 14:40:55 +0100
+Subject: [components 3/5] fdo#37164 get testtool working
+
+---
+ automation/source/server/cmdbasestream.cxx |   20 +---
+ automation/source/server/statemnt.cxx      |    6 +-
+ automation/source/testtool/cmdstrm.cxx     |    3 +-
+ automation/source/testtool/objtest.cxx     |  183 ++++++++--------------------
+ 4 files changed, 58 insertions(+), 154 deletions(-)
+
+diff --git a/automation/source/server/cmdbasestream.cxx b/automation/source/server/cmdbasestream.cxx
+index d86e662..b236700 100644
+--- automation/source/server/cmdbasestream.cxx
++++ automation/source/server/cmdbasestream.cxx
+@@ -70,10 +70,7 @@ void CmdBaseStream::GenReturn (comm_USHORT nRet, rtl::OString *pUId, comm_ULONG
+ {
+     Write(comm_USHORT(SIReturn));
+     Write(nRet);
+-    if ( pUId->equals( rtl::OString( "UID_ACTIVE" ) ) )
+-        Write(comm_ULONG(0));
+-    else
+-        Write(pUId);
++    Write(pUId);
+     Write(comm_USHORT(PARAM_ULONG_1));			// Typ der folgenden Parameter
+     Write(nNr);
+ }
+@@ -82,10 +79,7 @@ void CmdBaseStream::GenReturn (comm_USHORT nRet, rtl::OString *pUId, comm_String
+ {
+     Write(comm_USHORT(SIReturn));
+     Write(nRet);
+-    if ( pUId->equals( rtl::OString( "UID_ACTIVE" ) ) )
+-        Write(comm_ULONG(0));
+-    else
+-        Write(pUId);
++    Write(pUId);
+     Write(comm_USHORT(PARAM_STR_1));				// Typ der folgenden Parameter
+     Write(pString);
+ }
+@@ -94,10 +88,7 @@ void CmdBaseStream::GenReturn (comm_USHORT nRet, rtl::OString *pUId, comm_BOOL b
+ {
+     Write(comm_USHORT(SIReturn));
+     Write(nRet);
+-    if ( pUId->equals( rtl::OString( "UID_ACTIVE" ) ) )
+-        Write(comm_ULONG(0));
+-    else
+-        Write(pUId);
++    Write(pUId);
+     Write(comm_USHORT(PARAM_BOOL_1));			// Typ der folgenden Parameter
+     Write(bBool);
+ }
+@@ -106,10 +97,7 @@ void CmdBaseStream::GenReturn (comm_USHORT nRet, rtl::OString *pUId, comm_ULONG
+ {
+     Write(comm_USHORT(SIReturn));
+     Write(nRet);
+-    if ( pUId->equals( rtl::OString( "UID_ACTIVE" ) ) )
+-        Write(comm_ULONG(0));
+-    else
+-        Write(pUId);
++    Write(pUId);
+     Write(comm_USHORT(PARAM_ULONG_1|PARAM_STR_1|PARAM_BOOL_1));		// Typ der folgenden Parameter
+     Write(nNr);
+     Write(pString);
+diff --git a/automation/source/server/statemnt.cxx b/automation/source/server/statemnt.cxx
+index 738e4a2..e805076 100644
+--- automation/source/server/statemnt.cxx
++++ automation/source/server/statemnt.cxx
+@@ -3373,7 +3373,7 @@ StatementControl::StatementControl( SCmdStream *pCmdIn, sal_uInt16 nControlIdTyp
+     {
+         comm_ULONG nId;
+         pCmdIn->Read( nId );
+-        aUId = rtl::OString( nId );
++        aUId = rtl::OString::valueOf( static_cast< sal_Int32 >( nId  ) );
+         if ( nId == 0 )
+             aUId = UID_ACTIVE;
+         else
+@@ -3490,7 +3490,7 @@ sal_Bool StatementControl::ControlOK( Window *pControl, const sal_Char* cBezeich
+ {
+     if ( pControl && ( ( ( IsAccessable(pControl) || (nMethodId & M_WITH_RETURN) ) &&
+                          pControl->IsVisible() ) ||
+-                         aUId.equals( UID_ACTIVE ) ) )
++                         aUId.equals( rtl::OString( UID_ACTIVE ) ) ) )
+         return sal_True;
+     else
+     {
+@@ -4356,7 +4356,7 @@ sal_Bool StatementControl::Execute()
+ #endif
+ 
+ 
+-    if ( aUId.equals( UID_ACTIVE ) )
++    if ( aUId.equals( rtl::OString( UID_ACTIVE ) ) )
+         pControl = GetAnyActive();
+     else
+     {
+diff --git a/automation/source/testtool/cmdstrm.cxx b/automation/source/testtool/cmdstrm.cxx
+index efb8c3e..a268a88 100644
+--- automation/source/testtool/cmdstrm.cxx
++++ automation/source/testtool/cmdstrm.cxx
+@@ -101,8 +101,7 @@ String CmdStream::WandleKeyEventString( String aKeys )
+                 sal_uInt16 nElement;
+                 if (pKeyCodes->Seek_Entry(&WhatName,&nElement))
+                 {
+-                    // FIXME: HELPID
+-                    sal_uInt16 nCode = 0;//(sal_uInt16) pKeyCodes->GetObject(nElement)->pData->aUId.GetNum();
++                    sal_uInt16 nCode = (sal_uInt16) pKeyCodes->GetObject(nElement)->pData->aUId.toInt64();
+                     if ( nCode >= KEY_SHIFT )
+                         nModify ^= nCode;
+                     else
+diff --git a/automation/source/testtool/objtest.cxx b/automation/source/testtool/objtest.cxx
+index 8b41527..492ee57 100644
+--- automation/source/testtool/objtest.cxx
++++ automation/source/testtool/objtest.cxx
+@@ -255,15 +255,11 @@ String CRevNames::GetName( rtl::OString aUId )
+         return GetObject(nPos)->pData->Kurzname;
+     else
+     {
+-        // FIXME: HELPID
+-        #if 0
+-        if ( aUId.Matches( UID_ACTIVE ) )
++        if ( aUId.match( UID_ACTIVE ) )
+             return CUniString("Active");
+         else
+-            return GEN_RES_STR1( S_NAME_NOT_THERE, aUId.GetText() );
+-        #else
++            return GEN_RES_STR1( S_NAME_NOT_THERE, String::CreateFromAscii( aUId.getStr() ) );
+         return String();
+-        #endif
+     }
+ }
+ 
+@@ -693,12 +689,7 @@ void TestToolObj::InitTestToolObj()
+         SbxTransportMethod *pMeth = new SbxTransportMethod( SbxVARIANT );
+         pMeth->SetName( pRCommands->GetObject( i )->pData->Kurzname );
+         pMeth->SetUserData( ID_RemoteCommand );
+-        // FIXME: HELPID
+-        #if 0
+-        pMeth->nValue = pRCommands->GetObject( i )->pData->aUId.GetNum();
+-        #else
+-        pMeth->nValue = 0;
+-        #endif
++        pMeth->nValue = static_cast< sal_uLong >( pRCommands->GetObject( i )->pData->aUId.toInt64() );
+         Insert( pMeth );
+         StartListening( pMeth->GetBroadcaster(), sal_True );
+     }
+@@ -852,7 +843,7 @@ void TestToolObj::ReadNames( String Filename, CNames *&pNames, CNames *&pUIds, s
+         ReadFlat( aFileName ,pUIds, sal_True );
+         if ( !pUIds )
+             return;
+-        pNewDef = new ControlDef("Active",rtl::OString());
++        pNewDef = new ControlDef("Active",rtl::OString( UID_ACTIVE ));
+         const ControlItem *pItem = pNewDef;
+         if (! pUIds->Insert(pItem))
+         {
+@@ -983,12 +974,9 @@ void TestToolObj::ReadNames( String Filename, CNames *&pNames, CNames *&pUIds, s
+         else
+         {
+ 
+-            // FIXME: HELPID
+-            #if 0
+             if (aShortname.CompareIgnoreCaseToAscii("*Active") == COMPARE_EQUAL)
+-                aUId = rtl::OString( UID_ACTIVE );
++                aUId = UID_ACTIVE;
+             else
+-            #endif
+                 if ( !bUnoName && !bMozillaName )
+             {	// Bestimmen der ID aus der Hid.Lst
+                 ControlDef WhatName(aLongname,rtl::OString());
+@@ -1002,17 +990,14 @@ void TestToolObj::ReadNames( String Filename, CNames *&pNames, CNames *&pUIds, s
+             }
+             else
+             {
+-                // FIXME: HELPID
+-                #if 0
+                 if ( bUnoName )
+-                    aUId = rtl::OString( aLongname );
++                    aUId = rtl::OUStringToOString( aLongname, RTL_TEXTENCODING_UTF8 );
+                 else if ( bMozillaName )
+-                    aUId = rtl::OString( aLongname );
++                    aUId = rtl::OUStringToOString( aLongname , RTL_TEXTENCODING_UTF8);
+                 else
+                 {
+                     OSL_FAIL("Unknown URL schema");
+                 }
+-                #endif
+             }
+ 
+ 
+@@ -1137,7 +1122,6 @@ void TestToolObj::ReadFlat( String Filename, CNames *&pNames, sal_Bool bSortByNa
+         }
+ 
+         aLongname = aLine.GetToken(0,cMyDelim);
+-        // FIXME: HELPID
+         aUId = rtl::OUStringToOString( aLine.GetToken(1,cMyDelim), RTL_TEXTENCODING_UTF8 );
+ 
+         if ( bSortByName )
+@@ -1180,8 +1164,7 @@ void ReadFlatArray( const ControlDefLoad arWas [], CNames *&pNames )
+ 
+     while ( String::CreateFromAscii(arWas[nIndex].Kurzname).Len() > 0 )
+     {
+-        // FIXME: HELPID
+-        rtl::OString aUId;// (arWas[nIndex].nUId);
++        rtl::OString aUId ( rtl::OString::valueOf( static_cast< sal_Int64  >( arWas[nIndex].nUId ) ) );
+         const ControlItem *pX = new ControlDef( arWas[nIndex].Kurzname, aUId);
+         pNames->C40_PTR_INSERT(ControlItem, pX);
+         nIndex++;
+@@ -1469,16 +1452,13 @@ sal_Bool TestToolObj::ReadNamesBin( String Filename, CNames *&pSIds, CNames *&pC
+         {
+             String aStrId;
+             aStream.ReadByteString( aStrId, RTL_TEXTENCODING_UTF8 );
+-            // FIXME: HELPID
+-            #if 0
+-            aUId = rtl::OString( aStrId );
+-            #endif
++            aUId = rtl::OUStringToOString( aStrId, RTL_TEXTENCODING_UTF8 );
+         }
+         else
+         {
+             comm_ULONG nUId;
+             aStream >> nUId;
+-            aUId = rtl::OString();// nUId;
++            aUId = rtl::OString::valueOf( static_cast< sal_Int64 >( nUId ) );
+         }
+ 
+         if (aName.GetChar(0) == '*' || bIsFlat )     // Globaler Kurzname (Dialogname oder SId)
+@@ -2095,8 +2075,7 @@ void TestToolObj::SFX_NOTIFY( SfxBroadcaster&, const TypeId&,
+                         if ( !IsError() && ((SbxTransportMethod*)pVar)->nValue & M_WITH_RETURN )
+                         {
+                             pImpl->pNextReturn = ((SbxTransportMethod*)pVar);
+-                                                        // FIXME: HELPID
+-                            aNextReturnId = rtl::OString();// ((SbxTransportMethod*)pVar)->nValue );
++                            aNextReturnId = rtl::OString::valueOf( static_cast< sal_Int64 >( ((SbxTransportMethod*)pVar)->nValue )  );
+                         }
+                         if ( SingleCommandBlock )
+                             EndBlock();
+@@ -2168,17 +2147,13 @@ void TestToolObj::SFX_NOTIFY( SfxBroadcaster&, const TypeId&,
+                                 {
+                                     In->GenCmdControl (pMember->GetULong(),
+                                         (sal_uInt16)((SbxTransportMethod*)pVar)->nValue, rPar);
+-                                                                // FIXME: HELPID
+-                                    aNextReturnId = rtl::OString();// pMember->GetULong() );
++                                    aNextReturnId = rtl::OUStringToOString( pMember->GetString(), RTL_TEXTENCODING_UTF8 );
+                                 }
+                                 else
+                                 {
+                                     In->GenCmdControl (pMember->GetString(),
+                                         (sal_uInt16)((SbxTransportMethod*)pVar)->nValue, rPar);
+-                                    // FIXME: HELPID
+-                                    #if 0
+-                                    aNextReturnId = rtl::OString( pMember->GetString() );
+-                                    #endif
++                                    aNextReturnId = rtl::OUStringToOString( pMember->GetString(), RTL_TEXTENCODING_UTF8 );
+                                 }
+                             }
+ 
+@@ -2728,12 +2703,9 @@ SbxVariable* TestToolObj::Find( const String& aStr, SbxClassType aType)
+ 
+ 
+             // Will be set on method-child further down
+-            // FIXME: HELPID
+-            #if 0
+-            if ( pWhatName->pData->aUId.HasNumeric() )
++            if ( pWhatName->pData->aUId.equals( UID_ACTIVE ) )
+                 pImpl->pControlsObj->SetUserData( ID_Control );
+             else
+-            #endif
+                 pImpl->pControlsObj->SetUserData( ID_StringControl );
+ 
+             pShortNames->Insert(pWhatName->pData->Kurzname,pWhatName->pData->aUId,nSequence);
+@@ -2746,13 +2718,13 @@ SbxVariable* TestToolObj::Find( const String& aStr, SbxClassType aType)
+                 pImpl->pControlsObj->SetDfltProperty(pID);
+                 pMember = pID;
+             }
+-            // FIXME: HELPID
+-            #if 0
+-            if ( pWhatName->pData->aUId.HasNumeric() )
+-                pMember->PutULong(pWhatName->pData->aUId.GetNum());
++            sal_uLong nId = static_cast< sal_uLong >( pWhatName->pData->aUId.toInt64() );
++            if ( nId )
++                pMember->PutULong(nId);
+             else
+-                pMember->PutString(pWhatName->pData->aUId.GetStr());
+-            #endif
++            {
++                pMember->PutString( String::CreateFromAscii( pWhatName->pData->aUId.getStr() ) );
++            }
+ 
+             pMember = pImpl->pControlsObj->Find(CUniString("name"),SbxCLASS_DONTCARE);
+             if ( pMember != NULL )
+@@ -2772,20 +2744,18 @@ SbxVariable* TestToolObj::Find( const String& aStr, SbxClassType aType)
+             pWhatName = ( (ControlDef*)m_pSIds->GetObject( nElement ) );
+             pMyVar->SetName( pWhatName->pData->Kurzname );
+ 
+-            // FIXME: HELPID
+-            #if 0
+-            if ( pWhatName->pData->aUId.HasNumeric() )
++            sal_uLong nId = static_cast< sal_uLong >( pWhatName->pData->aUId.toInt64() );
++            if ( nId )
+             {
+                 pMyVar->SetUserData( ID_Dispatch );
+-                pMyVar->nValue = pWhatName->pData->aUId.GetNum();
++                pMyVar->nValue = nId;
+                 pShortNames->Insert( aStr, pWhatName->pData->aUId, nSequence );
+             }
+             else
+             {
+                 pMyVar->SetUserData( ID_UNODispatch );
+-                pMyVar->aUnoSlot = pWhatName->pData->aUId.GetStr();
++                pMyVar->aUnoSlot = String::CreateFromAscii( pWhatName->pData->aUId.getStr() );
+             }
+-            #endif
+             return pMyVar;
+         }
+ 
+@@ -2801,13 +2771,11 @@ SbxVariable* TestToolObj::Find( const String& aStr, SbxClassType aType)
+                 pWhatName = ( (ControlDef*)m_pSIds->GetObject( nElement ) );
+                 pReturn->SetName( pWhatName->pData->Kurzname );
+ 
+-                // FIXME: HELPID
+-                #if 0
+-                if ( pWhatName->pData->aUId.HasNumeric() )
+-                    pReturn->PutULong(pWhatName->pData->aUId.GetNum());
++                sal_uLong nId = static_cast< sal_uLong >( pWhatName->pData->aUId.toInt64() );
++                if ( nId )
++                    pReturn->PutULong( nId);
+                 else
+-                    pReturn->PutString(pWhatName->pData->aUId.GetStr());
+-                #endif
++                    pReturn->PutString( String::CreateFromAscii( pWhatName->pData->aUId ) );
+                 return pReturn;
+             }
+         }
+@@ -3197,8 +3165,7 @@ void TestToolObj::SortControlsByNumber( sal_Bool bIncludeActive )
+         }
+         if ( !bIncludeActive )
+         {
+-            // FIXME: HELPID
+-            ControlItem *pZeroItem = new ControlItemUId( UniString(), rtl::OString() );
++            ControlItem *pZeroItem = new ControlItemUId( UniString(), rtl::OString(UID_ACTIVE) );
+             sal_uInt16 nNr;
+             if ( m_pReverseControls->Seek_Entry( pZeroItem, &nNr ) )
+             {
+@@ -3235,19 +3202,13 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+             {
+                 String aUStrId;     // UniqueStringID Used for Mozilla Integration
+                 pRetStream->Read( aUStrId );
+-                // FIXME: HELPID
+-                #if 0
+-                aUId = rtl::OString( aUStrId );
+-                #endif
++                aUId = rtl::OUStringToOString( aUStrId, RTL_TEXTENCODING_UTF8 );
+             }
+             else
+             {
+                 comm_ULONG nUId;
+                 pRetStream->Read( nUId );         // bei Sequence einfach die Sequence
+-                // FIXME: HELPID
+-                #if 0
+-                aUId = rtl::OString( nUId );
+-                #endif
++                aUId = rtl::OString::valueOf( static_cast< sal_Int64 >( nUId ) );
+             }
+             pRetStream->Read(nParams);
+ 
+@@ -3276,9 +3237,7 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+             {
+                 case RET_Sequence:
+                     {
+-                        // FIXME: HELPID
+-                        #if 0
+-                        sal_uLong nUId = aUId.GetNum();
++                        sal_uLong nUId = static_cast< sal_uLong >( aUId.toInt64() );
+                         if ( nSequence != nUId )
+                         {
+                             bSequenceOK = sal_False;
+@@ -3288,7 +3247,6 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                         {
+                             nClearSequence = nUId;
+                         }
+-                        #endif
+                     }
+                     break;
+                 case RET_Value:
+@@ -3346,10 +3304,7 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                         }
+ 
+                         WinInfoRec *pWinInfo = new WinInfoRec;
+-                        // FIXME: HELPID
+-                        #if 0
+-                        pWinInfo->aUId = aUId.GetText();
+-                        #endif
++                        pWinInfo->aUId = String::CreateFromAscii( aUId.getStr() );
+                         pWinInfo->nRType = (sal_uInt16)nLNr1;   // just sal_uLong for Transport, data is always USHORT
+                         pWinInfo->aRName = aString1;
+                         pWinInfo->bIsReset = bBool1;
+@@ -3401,11 +3356,10 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                         }
+ 
+                         // Langname feststellen
+-                        // FIXME: HELPID
+-                        #if 0
+-                        if ( aUId.HasString() )
++                        sal_uLong nTmpId = aUId.toInt64();
++                        if ( !nTmpId )
+                         {   // use the String ID since there is no LongName in hid.lst
+-                            pWinInfo->aLangname = aUId.GetStr();
++                            pWinInfo->aLangname = String::CreateFromAscii( aUId.getStr() );
+                         }
+                         else
+                         {
+@@ -3418,7 +3372,6 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                                 delete pNewItem;
+                             }
+                         }
+-                        #endif
+ 
+                         aWinInfoHdl.Call( pWinInfo );
+ 
+@@ -3427,9 +3380,7 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                     break;
+                 case RET_ProfileInfo:
+                     {
+-                        // FIXME: HELPID
+-                        #if 0
+-                        sal_uLong nUId = aUId.GetNum();
++                        sal_uLong nUId = static_cast< sal_uLong >(aUId.toInt64());
+                         if ( nParams & PARAM_STR_1 )
+                         {
+                             DirEntry FilePath = pImpl->aLogFileBase + DirEntry(DirEntry(aLogFileName).GetBase().AppendAscii(".prf"));
+@@ -3557,14 +3508,11 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                                     break;
+                             }
+                         }
+-                        #endif
+                     }
+                     break;
+                 case RET_DirectLoging:
+                     {
+-                        // FIXME: HELPID
+-                        #if 0
+-                        sal_uLong nUId = aUId.GetNum();
++                        sal_uLong nUId = static_cast< sal_uLong>( aUId.toInt64() );
+                         switch ( nUId )
+                         {
+                         case S_AssertError:
+@@ -3580,7 +3528,6 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                         default:
+                             ;
+                         }
+-                        #endif
+                     }
+                     break;
+                 case RET_MacroRecorder:
+@@ -3611,8 +3558,7 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+                             if ( m_pReverseControls )
+                             {
+                                 sal_uInt16 nNr;
+-                                                    // FIXME: HELPID
+-                                ControlItem *pNewItem = new ControlItemUId( String(), rtl::OString( /*nLNr1*/ ) );
++                                ControlItem *pNewItem = new ControlItemUId( String(), rtl::OString::valueOf( static_cast< sal_Int64 >( nLNr1 ) ));
+                                 if ( m_pReverseControls->Seek_Entry(pNewItem,&nNr) )
+                                     aULongNames = m_pReverseControls->GetObject(nNr)->pData->Kurzname;
+                                 delete pNewItem;
+@@ -3852,19 +3798,13 @@ sal_Bool TestToolObj::ReturnResults( SvStream *pIn )
+             {
+                 String aUStrId;     // UniqueStringID Used for Mozilla Integration
+                 pRetStream->Read( aUStrId );
+-                // FIXME: HELPID
+-                #if 0
+-                aUId = rtl::OString( aUStrId );
+-                #endif
++                aUId = rtl::OUStringToOString( aUStrId, RTL_TEXTENCODING_UTF8 );
+             }
+             else
+             {
+                 comm_ULONG nUId;
+                 pRetStream->Read( nUId );         // bei Sequence einfach die Sequence
+-                // FIXME: HELPID
+-                #if 0
+-                aUId = rtl::OString( nUId );
+-                #endif
++                aUId = rtl::OString::valueOf( static_cast< sal_Int64 >( nUId ) );
+             }
+             pRetStream->Read( aString );
+             ReplaceNumbers (aString);
+@@ -3910,15 +3850,11 @@ String TestToolObj::GetMethodName( sal_uLong nMethodId )
+         ReadFlatArray( Controls::arClasses, Controls::pClasses );
+     if ( Controls::pClasses )
+     {
+-        // FIXME: HELPID
+-        #if 0
+         for ( nElement = 0 ; nElement < Controls::pClasses->Count() ; nElement++ )
+-            if ( Controls::pClasses->GetObject(nElement)->pData->aUId.Matches( nMethodId ) )
++        {
++            if ( Controls::pClasses->GetObject(nElement)->pData->aUId.match( rtl::OString::valueOf( static_cast< sal_Int64 >( nMethodId ) ) ) )
+                 return Controls::pClasses->GetObject(nElement)->pData->Kurzname;
+-        #else
+-        (void)nElement;
+-        (void)nMethodId;
+-        #endif
++        }
+     }
+     return String();
+ }
+@@ -3930,15 +3866,9 @@ String TestToolObj::GetKeyName( sal_uInt16 nKeyCode )
+         ReadFlatArray( CmdStream::arKeyCodes, CmdStream::pKeyCodes );
+     if ( CmdStream::pKeyCodes )
+     {
+-        // FIXME: HELPID
+-        #if 0
+         for ( nElement = 0 ; nElement < CmdStream::pKeyCodes->Count() ; nElement++ )
+-            if ( CmdStream::pKeyCodes->GetObject(nElement)->pData->aUId.Matches( nKeyCode ) )
++            if ( CmdStream::pKeyCodes->GetObject(nElement)->pData->aUId.match( rtl::OString::valueOf( static_cast< sal_Int64 >( nKeyCode  ) ) ) )
+                 return CmdStream::pKeyCodes->GetObject(nElement)->pData->Kurzname;
+-        #else
+-        (void)nElement;
+-        (void)nKeyCode;
+-        #endif
+     }
+     return CUniString( "UnknownKeyCode" );
+ }
+@@ -3967,8 +3897,7 @@ static ControlDefLoad const arRes_Type [] =
+         bFound = sal_False;
+         if ( aType.CompareTo(UIdKenn) == COMPARE_EQUAL )
+         {
+-                // FIXME: HELPID
+-            aResult = pShortNames->GetName(rtl::OString(/*nNumber*/));
++            aResult = pShortNames->GetName( rtl::OString::valueOf( static_cast< sal_Int64 >( nNumber )) );
+             bFound = sal_True;
+         }
+         if ( aType.CompareTo(MethodKenn ) == COMPARE_EQUAL )
+@@ -3985,17 +3914,12 @@ static ControlDefLoad const arRes_Type [] =
+             sal_uInt16 nElement;
+             if ( pRCommands )
+             {
+-                // FIXME: HELPID
+-                #if 0
+                 for ( nElement = 0 ; nElement < pRCommands->Count() ; nElement++ )
+-                    if ( pRCommands->GetObject(nElement)->pData->aUId.Matches( nNumber ) )
++                    if ( pRCommands->GetObject(nElement)->pData->aUId.match( rtl::OString::valueOf( static_cast< sal_Int64 >( nNumber ) ) ) )
+                     {
+                         aResult = pRCommands->GetObject(nElement)->pData->Kurzname;
+                         nElement = pRCommands->Count();
+                     }
+-                #else
+-                (void)nElement;
+-                #endif
+             }
+         }
+         if ( aType.CompareTo(TypeKenn ) == COMPARE_EQUAL )
+@@ -4007,23 +3931,17 @@ static ControlDefLoad const arRes_Type [] =
+             sal_uInt16 nElement;
+             if ( pRTypes )
+             {
+-                // FIXME: HELPID
+-                #if 0
+                 for ( nElement = 0 ; nElement < pRTypes->Count() ; nElement++ )
+-                    if ( pRTypes->GetObject(nElement)->pData->aUId.Matches( nNumber ) )
++                    if ( pRTypes->GetObject(nElement)->pData->aUId.match( rtl::OString::valueOf( static_cast< sal_Int64 >( nNumber ) ) ) )
+                     {
+                         aResult = pRTypes->GetObject(nElement)->pData->Kurzname;
+                         nElement = pRTypes->Count();
+                     }
+-                #else
+-                (void)nElement;
+-                #endif
+             }
+         }
+         if ( aType.CompareTo(SlotKenn ) == COMPARE_EQUAL )
+         {
+-                // FIXME: HELPID
+-            aResult = pShortNames->GetName(rtl::OString(/*nNumber*/));
++            aResult = pShortNames->GetName(rtl::OString::valueOf( static_cast< sal_Int64>( nNumber ) ));
+             bFound = sal_True;
+         }
+         if ( aType.CompareTo(TabKenn ) == COMPARE_EQUAL )
+@@ -4154,8 +4072,7 @@ SbxVariable* Controls::Find( const String& aStr, SbxClassType aType)
+     if (pClasses && pClasses->Seek_Entry(&WhatName,&nElement))
+     {
+         pMethodVar->SetName(aStr);
+-        // FIXME: HELPID
+-        sal_uLong nUId = 0;//pClasses->GetObject(nElement)->pData->aUId.GetNum();
++        sal_uLong nUId =  static_cast< sal_uLong >( pClasses->GetObject(nElement)->pData->aUId.toInt64() );
+         pMethodVar->nValue = nUId;
+ 
+          pMethodVar->SetUserData( GetUserData() );
+-- 
+1.7.5.4
+
+
+From 242f1bee6e0df3c58c257178058d61a1c349c2ed Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Thu, 29 Sep 2011 21:32:08 +0100
+Subject: [components 4/5] get this building with gcc 4.6.1
+
+---
+ .../source/propctrlr/editpropertyhandler.cxx       |   12 +++---
+ .../source/propctrlr/formcomponenthandler.cxx      |   44 ++++++++++----------
+ .../source/propctrlr/xsdvalidationhelper.cxx       |    2 +-
+ .../propctrlr/xsdvalidationpropertyhandler.cxx     |   36 ++++++++--------
+ 4 files changed, 47 insertions(+), 47 deletions(-)
+
+diff --git a/extensions/source/propctrlr/editpropertyhandler.cxx b/extensions/source/propctrlr/editpropertyhandler.cxx
+index a1693ae..363f685 100644
+--- extensions/source/propctrlr/editpropertyhandler.cxx
++++ extensions/source/propctrlr/editpropertyhandler.cxx
+@@ -248,13 +248,13 @@ namespace pcr
+         ::std::vector< ::rtl::OUString > aSuperseded;
+         if ( implHaveBothScrollBarProperties() )
+         {
+-            aSuperseded.push_back( PROPERTY_HSCROLL );
+-            aSuperseded.push_back( PROPERTY_VSCROLL );
++            aSuperseded.push_back( static_cast<const rtl::OUString&>(PROPERTY_HSCROLL) );
++            aSuperseded.push_back( static_cast<const rtl::OUString&>(PROPERTY_VSCROLL) );
+         }
+         if ( implHaveTextTypeProperty() )
+         {
+-            aSuperseded.push_back( PROPERTY_RICHTEXT );
+-            aSuperseded.push_back( PROPERTY_MULTILINE );
++            aSuperseded.push_back(  static_cast<const rtl::OUString&>(PROPERTY_RICHTEXT) );
++            aSuperseded.push_back(  static_cast<const rtl::OUString&>(PROPERTY_MULTILINE) );
+         }
+         if ( aSuperseded.empty() )
+             return Sequence< ::rtl::OUString >();
+@@ -267,8 +267,8 @@ namespace pcr
+         ::osl::MutexGuard aGuard( m_aMutex );
+         ::std::vector< ::rtl::OUString > aInterestingActuatingProps;
+         if ( implHaveTextTypeProperty() )
+-            aInterestingActuatingProps.push_back( PROPERTY_TEXTTYPE );
+-        aInterestingActuatingProps.push_back( PROPERTY_MULTILINE );
++            aInterestingActuatingProps.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TEXTTYPE) );
++        aInterestingActuatingProps.push_back( static_cast<const rtl::OUString&>(PROPERTY_MULTILINE) );
+         return Sequence< ::rtl::OUString >( &(*aInterestingActuatingProps.begin()), aInterestingActuatingProps.size() );;
+     }
+ 
+diff --git a/extensions/source/propctrlr/formcomponenthandler.cxx b/extensions/source/propctrlr/formcomponenthandler.cxx
+index 48d0bbe..a006ab5 100644
+--- extensions/source/propctrlr/formcomponenthandler.cxx
++++ extensions/source/propctrlr/formcomponenthandler.cxx
+@@ -947,28 +947,28 @@ namespace pcr
+     {
+         ::osl::MutexGuard aGuard( m_aMutex );
+         ::std::vector< ::rtl::OUString > aInterestingProperties;
+-        aInterestingProperties.push_back( PROPERTY_DATASOURCE );
+-        aInterestingProperties.push_back( PROPERTY_COMMAND );
+-        aInterestingProperties.push_back( PROPERTY_COMMANDTYPE );
+-        aInterestingProperties.push_back( PROPERTY_LISTSOURCE );
+-        aInterestingProperties.push_back( PROPERTY_LISTSOURCETYPE );
+-        aInterestingProperties.push_back( PROPERTY_SUBMIT_ENCODING );
+-        aInterestingProperties.push_back( PROPERTY_REPEAT );
+-        aInterestingProperties.push_back( PROPERTY_TABSTOP );
+-        aInterestingProperties.push_back( PROPERTY_BORDER );
+-        aInterestingProperties.push_back( PROPERTY_CONTROLSOURCE );
+-        aInterestingProperties.push_back( PROPERTY_DROPDOWN );
+-        aInterestingProperties.push_back( PROPERTY_IMAGE_URL );
+-        aInterestingProperties.push_back( PROPERTY_TARGET_URL );
+-        aInterestingProperties.push_back( PROPERTY_STRINGITEMLIST );
+-        aInterestingProperties.push_back( PROPERTY_BUTTONTYPE );
+-        aInterestingProperties.push_back( PROPERTY_ESCAPE_PROCESSING );
+-        aInterestingProperties.push_back( PROPERTY_TRISTATE );
+-        aInterestingProperties.push_back( PROPERTY_DECIMAL_ACCURACY );
+-        aInterestingProperties.push_back( PROPERTY_SHOWTHOUSANDSEP );
+-        aInterestingProperties.push_back( PROPERTY_FORMATKEY );
+-        aInterestingProperties.push_back( PROPERTY_EMPTY_IS_NULL );
+-        aInterestingProperties.push_back( PROPERTY_TOGGLE );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DATASOURCE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_COMMAND) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_COMMANDTYPE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_LISTSOURCE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_LISTSOURCETYPE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_SUBMIT_ENCODING) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_REPEAT) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TABSTOP) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_BORDER) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_CONTROLSOURCE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DROPDOWN) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_IMAGE_URL) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TARGET_URL) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_STRINGITEMLIST) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_BUTTONTYPE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_ESCAPE_PROCESSING) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TRISTATE) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DECIMAL_ACCURACY) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_SHOWTHOUSANDSEP) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_FORMATKEY) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_EMPTY_IS_NULL) );
++        aInterestingProperties.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TOGGLE) );
+         return Sequence< ::rtl::OUString >( &(*aInterestingProperties.begin()), aInterestingProperties.size() );
+     }
+ 
+diff --git a/extensions/source/propctrlr/xsdvalidationhelper.cxx b/extensions/source/propctrlr/xsdvalidationhelper.cxx
+index 4ade7c5..54338a3 100644
+--- extensions/source/propctrlr/xsdvalidationhelper.cxx
++++ extensions/source/propctrlr/xsdvalidationhelper.cxx
+@@ -271,7 +271,7 @@ namespace pcr
+                 Reference< XPropertySet > xNewType( getDataType( _rName ), UNO_QUERY );
+ 
+                 // fire any changes in the properties which result from this new type
+-                std::set< ::rtl::OUString > aFilter; aFilter.insert( PROPERTY_NAME );
++                std::set< ::rtl::OUString > aFilter; aFilter.insert( static_cast<const rtl::OUString&>(PROPERTY_NAME) );
+                 firePropertyChanges( xOldType, xNewType, aFilter );
+ 
+                 // fire the change in the Data Type property
+diff --git a/extensions/source/propctrlr/xsdvalidationpropertyhandler.cxx b/extensions/source/propctrlr/xsdvalidationpropertyhandler.cxx
+index b9ca345..31c6ba2 100644
+--- extensions/source/propctrlr/xsdvalidationpropertyhandler.cxx
++++ extensions/source/propctrlr/xsdvalidationpropertyhandler.cxx
+@@ -247,27 +247,27 @@ namespace pcr
+         ::std::vector< ::rtl::OUString > aSuperfluous;
+         if ( m_pHelper.get() )
+         {
+-            aSuperfluous.push_back( PROPERTY_CONTROLSOURCE );
+-            aSuperfluous.push_back( PROPERTY_EMPTY_IS_NULL );
+-            aSuperfluous.push_back( PROPERTY_FILTERPROPOSAL );
+-            aSuperfluous.push_back( PROPERTY_LISTSOURCETYPE );
+-            aSuperfluous.push_back( PROPERTY_LISTSOURCE );
+-            aSuperfluous.push_back( PROPERTY_BOUNDCOLUMN );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_CONTROLSOURCE) );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_EMPTY_IS_NULL) );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_FILTERPROPOSAL) );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_LISTSOURCETYPE) );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_LISTSOURCE) );
++            aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_BOUNDCOLUMN) );
+ 
+             bool bAllowBinding = m_pHelper->canBindToAnyDataType();
+ 
+             if ( bAllowBinding )
+             {
+-                aSuperfluous.push_back( PROPERTY_MAXTEXTLEN );
+-                aSuperfluous.push_back( PROPERTY_VALUEMIN );
+-                aSuperfluous.push_back( PROPERTY_VALUEMAX );
+-                aSuperfluous.push_back( PROPERTY_DECIMAL_ACCURACY );
+-                aSuperfluous.push_back( PROPERTY_TIMEMIN );
+-                aSuperfluous.push_back( PROPERTY_TIMEMAX );
+-                aSuperfluous.push_back( PROPERTY_DATEMIN );
+-                aSuperfluous.push_back( PROPERTY_DATEMAX );
+-                aSuperfluous.push_back( PROPERTY_EFFECTIVE_MIN );
+-                aSuperfluous.push_back( PROPERTY_EFFECTIVE_MAX );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_MAXTEXTLEN) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_VALUEMIN) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_VALUEMAX) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DECIMAL_ACCURACY) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TIMEMIN) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_TIMEMAX) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DATEMIN) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_DATEMAX) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_EFFECTIVE_MIN) );
++                aSuperfluous.push_back(  static_cast<const rtl::OUString&>(PROPERTY_EFFECTIVE_MAX) );
+             }
+         }
+ 
+@@ -283,8 +283,8 @@ namespace pcr
+         ::std::vector< ::rtl::OUString > aInterestedInActuations( 2 );
+         if ( m_pHelper.get() )
+         {
+-            aInterestedInActuations.push_back( PROPERTY_XSD_DATA_TYPE );
+-            aInterestedInActuations.push_back( PROPERTY_XML_DATA_MODEL );
++            aInterestedInActuations.push_back(  static_cast<const rtl::OUString&>(PROPERTY_XSD_DATA_TYPE) );
++            aInterestedInActuations.push_back(  static_cast<const rtl::OUString&>(PROPERTY_XML_DATA_MODEL) );
+         }
+         if ( aInterestedInActuations.empty() )
+             return Sequence< ::rtl::OUString >();
+-- 
+1.7.5.4
+
+reverting on repository extensions from libreoffice-3.4.3.2 to merge-base 0c7f48ba62c0a8fca4b75c272d8aadcc4cc3d809
+commits on repository extensions merge-base 0c7f48ba62c0a8fca4b75c272d8aadcc4cc3d809 to libreoffice-3.4.4.1
+From 53e66aea4c1b3617363fd138a7903190d964da6b Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Tom=C3=A1=C5=A1=20Chv=C3=A1tal?= <tchvatal@suse.cz>
+Date: Fri, 30 Sep 2011 11:51:04 +0200
+Subject: [extensions 1/6] This is merge of
+ f6f8f67460bba296c49f794d14621b7313df4f7d.
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+It is not posible to git-am due to merge to core/ repository.
+It had one minor collision on pdfioutdev_gpl.hxx.
+
+Orginal header:
+From f6f8f67460bba296c49f794d14621b7313df4f7d Mon Sep 17 00:00:00 2001
+From: Caolán McNamara <caolanm@redhat.com>
+Date: Tue, 19 Jul 2011 07:54:07 +0000
+Subject: poppler 0.17.0 changed its api for no some reason or other
+---
+ .../pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx       |    4 ++++
+ .../pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx       |    9 ++++++++-
+ 2 files changed, 12 insertions(+), 1 deletions(-)
+
+diff --git a/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx b/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
+index f7741b4..5022dd5 100644
+--- sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
++++ sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
+@@ -489,7 +489,11 @@ void PDFOutDev::endPage()
+     printf("endPage\n");
+ }
+ 
++#if POPPLER_CHECK_VERSION(0, 17, 0)
++void PDFOutDev::processLink(AnnotLink *link, Catalog *catalog)
++#else
+ void PDFOutDev::processLink(Link* link, Catalog*)
++#endif
+ {
+     assert(link);
+ 
+diff --git a/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx b/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
+index 3ac0f49..8a1708c 100644
+--- sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
++++ sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
+@@ -65,7 +65,10 @@ class GfxPath;
+ class GfxFont;
+ class PDFDoc;
+ #ifndef SYSTEM_POPPLER
++#define POPPLER_CHECK_VERSION(major,minor,micro) (0)
+ typedef GString GooString;
++#else
++#include <glib/poppler-features.h>
+ #endif
+ 
+ namespace pdfi
+@@ -193,9 +196,13 @@ namespace pdfi
+         // Convert between device and user coordinates.
+         // virtual void cvtDevToUser(double dx, double dy, double *ux, double *uy);
+         // virtual void cvtUserToDev(double ux, double uy, int *dx, int *dy);
+-        
++       
++        #if POPPLER_CHECK_VERSION(0, 17, 0)
++        virtual void processLink(AnnotLink *link, Catalog *catalog);
++        #else
+         //----- link borders
+         virtual void processLink(Link *link, Catalog *catalog);
++        #endif 
+         
+         //----- save/restore graphics state
+         virtual void saveState(GfxState *state);
+-- 
+1.7.5.4
+
+
+From 9540db43f3f1b11d3407a45aefda235d7e78f76b Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Fri, 2 Sep 2011 12:15:49 +0000
+Subject: [extensions 2/6] Resolves: rhbz#735182 libreoffice doesn't build
+ with poppler-0.17.3
+
+---
+ .../pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx       |    6 +++++-
+ 1 files changed, 5 insertions(+), 1 deletions(-)
+
+diff --git a/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx b/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
+index 5022dd5..bd6d721 100644
+--- sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
++++ sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.cxx
+@@ -150,7 +150,11 @@ void writeBinaryBuffer( const OutputBuffer& rBuffer )
+ void writeJpeg_( OutputBuffer& o_rOutputBuf, Stream* str, bool bWithLinefeed )
+ {
+     // dump JPEG file as-is
++#if POPPLER_CHECK_VERSION(0, 17, 3)
++    str = str->getBaseStream();
++#else
+     str = ((DCTStream *)str)->getRawStream();
++#endif
+     str->reset();
+ 
+     int c;
+@@ -490,7 +494,7 @@ void PDFOutDev::endPage()
+ }
+ 
+ #if POPPLER_CHECK_VERSION(0, 17, 0)
+-void PDFOutDev::processLink(AnnotLink *link, Catalog *catalog)
++void PDFOutDev::processLink(AnnotLink *link, Catalog *)
+ #else
+ void PDFOutDev::processLink(Link* link, Catalog*)
+ #endif
+-- 
+1.7.5.4
+
+
+From a9cc06fa45d4cd9547f40a9869c64c912b821b42 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Lubo=C5=A1=20Lu=C5=88=C3=A1k?= <l.lunak@suse.cz>
+Date: Wed, 21 Sep 2011 15:13:25 +0000
+Subject: [extensions 3/6] build without glib poppler bindings
+
+- there's not configure check for it, only for poppler itself
+- and it's not actually used anyway
+---
+ .../pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx       |    6 +++++-
+ 1 files changed, 5 insertions(+), 1 deletions(-)
+
+diff --git a/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx b/sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
+index 8a1708c..2f8d717 100644
+--- sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
++++ sdext/source/pdfimport/xpdfwrapper/pdfioutdev_gpl.hxx
+@@ -68,7 +68,11 @@ class PDFDoc;
+ #define POPPLER_CHECK_VERSION(major,minor,micro) (0)
+ typedef GString GooString;
+ #else
+-#include <glib/poppler-features.h>
++#include <cpp/poppler-version.h>
++#define POPPLER_CHECK_VERSION(major,minor,micro) \
++  (POPPLER_VERSION_MAJOR > (major) || \
++   (POPPLER_VERSION_MAJOR == (major) && POPPLER_VERSION_MINOR > (minor)) || \
++   (POPPLER_VERSION_MAJOR == (major) && POPPLER_VERSION_MINOR == (minor) && POPPLER_VERSION_MICRO >= (micro)))
+ #endif
+ 
+ namespace pdfi
+-- 
+1.7.5.4
+
+
+From 28664eecf3b5af8d850f86d392edf7afba0e4779 Mon Sep 17 00:00:00 2001
+From: Andras Timar <atimar@suse.com>
+Date: Thu, 20 Oct 2011 11:09:24 +0200
+Subject: [extensions 4/6] fix localization of NLPSolver
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+Signed-off-by: Caolán McNamara <caolanm@redhat.com>
+---
+ nlpsolver/makefile.mk |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/nlpsolver/makefile.mk b/nlpsolver/makefile.mk
+index a7d0996..ddbe7aa 100644
+--- nlpsolver/makefile.mk
++++ nlpsolver/makefile.mk
+@@ -46,7 +46,7 @@ PATCH_FILES=nlpsolver-0.9.patch
+ 
+ ANT_FLAGS+=-Dplatforms.JDK_1.5.home=$(JAVA_HOME) -Doffice.program.dir=$(SOLARBINDIR)
+ 
+-CONFIGURE_ACTION=(cd ../../../../locale && $(GNUTAR) -cf - .) | (cd src/ && $(GNUTAR) xf -)
++CONFIGURE_ACTION=(cd ../../../../locale && $(GNUTAR) -cf - .) | (cd src/locale/ && rm *de_DE* && $(GNUTAR) xf -)
+ 
+ .IF "$(JAVACISGCJ)"=="yes"
+ JAVA_HOME=
+-- 
+1.7.5.4
+
+
+From 03208fbdf808413480b8b7809d703d879bbfe803 Mon Sep 17 00:00:00 2001
+From: Andras Timar <atimar@suse.com>
+Date: Sun, 23 Oct 2011 21:06:29 +0200
+Subject: [extensions 5/6] nlpsolver translation update
+
+---
+ nlpsolver/locale/NLPSolverCommon_nb.properties     |    2 +-
+ .../locale/NLPSolverStatusDialog_is.properties     |    2 +-
+ 2 files changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/nlpsolver/locale/NLPSolverCommon_nb.properties b/nlpsolver/locale/NLPSolverCommon_nb.properties
+index 3b88d95..477fea9 100644
+--- nlpsolver/locale/NLPSolverCommon_nb.properties
++++ nlpsolver/locale/NLPSolverCommon_nb.properties
+@@ -1,6 +1,6 @@
+ # x-no-translate
+ #BaseNLPSolver
+-NLPSolverCommon.Properties.AssumeNonNegative=Assume Non-Negative Variables
++NLPSolverCommon.Properties.AssumeNonNegative=Anta positive variabler
+ #BaseEvolutionarySolver
+ NLPSolverCommon.Properties.SwarmSize=Size of Swarm
+ NLPSolverCommon.Properties.LibrarySize=Bibliotekst\u00F8rrelse
+diff --git a/nlpsolver/locale/NLPSolverStatusDialog_is.properties b/nlpsolver/locale/NLPSolverStatusDialog_is.properties
+index 74a8b69..f037c9a 100644
+--- nlpsolver/locale/NLPSolverStatusDialog_is.properties
++++ nlpsolver/locale/NLPSolverStatusDialog_is.properties
+@@ -25,4 +25,4 @@ NLPSolverStatusDialog.Time.Minutes=M\u00EDn\u00FAtur
+ NLPSolverStatusDialog.Time.Hour=Klukkustund
+ NLPSolverStatusDialog.Time.Hours=Klukkustundir
+ NLPSolverStatusDialog.Time.Day=Dagur
+-NLPSolverStatusDialog.Time.Days=Days
++NLPSolverStatusDialog.Time.Days=Dagur
+-- 
+1.7.5.4
+
+reverting on repository extras from libreoffice-3.4.3.2 to merge-base 2ca63db5ce0e02bd01f3097962c6d1eb65c28fd5
+commits on repository extras merge-base 2ca63db5ce0e02bd01f3097962c6d1eb65c28fd5 to libreoffice-3.4.4.1
+reverting on repository filters from libreoffice-3.4.3.2 to merge-base 1d6a8a19cc5280720f299cf65eab49aac88edd62
+commits on repository filters merge-base 1d6a8a19cc5280720f299cf65eab49aac88edd62 to libreoffice-3.4.4.1
+From f709e7ac395fed12490edb2037372a2d4e219db4 Mon Sep 17 00:00:00 2001
+From: Peter Jentsch <pjotr@guineapics.de>
+Date: Thu, 20 Oct 2011 14:06:10 +0100
+Subject: [filters 1/3] initial support for user defined xslt service impl in
+ filter jar
+
+Supports importing the 2nd userdata parameter for xslt filter
+definitions from manually edited custom XML filter settings.
+
+Signed-off-by: Michael Meeks <michael.meeks@suse.com>
+---
+ filter/source/xsltdialog/typedetectionimport.cxx   |    1 +
+ filter/source/xsltdialog/xmlfiltercommon.hxx       |    1 +
+ .../source/xsltdialog/xmlfiltersettingsdialog.cxx  |    9 +++++++--
+ 3 files changed, 9 insertions(+), 2 deletions(-)
+
+diff --git a/filter/source/xsltdialog/typedetectionimport.cxx b/filter/source/xsltdialog/typedetectionimport.cxx
+index 83b377d..ec01ba1 100644
+--- filter/source/xsltdialog/typedetectionimport.cxx
++++ filter/source/xsltdialog/typedetectionimport.cxx
+@@ -183,6 +183,7 @@ filter_info_impl* TypeDetectionImporter::createFilterForNode( Node * pNode )
+ 
+     OUString aAdapterService( getSubdata( 0, aDelim, aFilterUserData ) );
+     //Import/ExportService
++    pFilter->maXSLTTransformerImpl = getSubdata( 1, aDelim, aFilterUserData );
+     pFilter->maImportService = getSubdata( 2, aDelim, aFilterUserData );
+     pFilter->maExportService = getSubdata( 3, aDelim, aFilterUserData );
+     pFilter->maImportXSLT = getSubdata( 4, aDelim, aFilterUserData );
+diff --git a/filter/source/xsltdialog/xmlfiltercommon.hxx b/filter/source/xsltdialog/xmlfiltercommon.hxx
+index 9303a12..f58e42d 100644
+--- filter/source/xsltdialog/xmlfiltercommon.hxx
++++ filter/source/xsltdialog/xmlfiltercommon.hxx
+@@ -70,6 +70,7 @@ public:
+     rtl::OUString	maDocType;
+     rtl::OUString	maImportService;
+     rtl::OUString	maExportService;
++    rtl::OUString   maXSLTTransformerImpl;
+ 
+     sal_Int32		maFlags;
+     sal_Int32		maFileFormatVersion;
+diff --git a/filter/source/xsltdialog/xmlfiltersettingsdialog.cxx b/filter/source/xsltdialog/xmlfiltersettingsdialog.cxx
+index 541a529..5ae38a8 100644
+--- filter/source/xsltdialog/xmlfiltersettingsdialog.cxx
++++ filter/source/xsltdialog/xmlfiltersettingsdialog.cxx
+@@ -1167,6 +1167,7 @@ void XMLFilterSettingsDialog::initFilterList()
+                     continue;
+ 
+                 // get filter information from userdata
++                pTempFilter->maXSLTTransformerImpl = aUserData[1];
+                 pTempFilter->maImportService = aUserData[2];
+                 pTempFilter->maExportService = aUserData[3];
+                 pTempFilter->maImportXSLT = aUserData[4];
+@@ -1645,7 +1646,8 @@ filter_info_impl::filter_info_impl( const filter_info_impl& rInfo ) :
+     maFlags( rInfo.maFlags ),
+     maFileFormatVersion( rInfo.maFileFormatVersion ),
+     mnDocumentIconID( rInfo.mnDocumentIconID ),
+-    mbReadonly( rInfo.mbReadonly )
++    mbReadonly( rInfo.mbReadonly ),
++    maXSLTTransformerImpl( rInfo.maXSLTTransformerImpl )
+ {
+ }
+ 
+@@ -1668,7 +1670,9 @@ int filter_info_impl::operator==( const filter_info_impl& r ) const
+         maImportService != r.maImportService ||
+         maImportTemplate != r.maImportTemplate ||
+         maFlags != r.maFlags ||
+-        maFileFormatVersion != r.maFileFormatVersion )
++        maFileFormatVersion != r.maFileFormatVersion ||
++        maXSLTTransformerImpl != r.maXSLTTransformerImpl
++        )
+         return false;
+ 
+     return true;
+@@ -1689,6 +1693,7 @@ Sequence< OUString > filter_info_impl::getFilterUserData() const
+         aUserData[3] = pInfo->maXMLExporter;
+     }
+     */
++    aUserData[1] = maXSLTTransformerImpl;
+     aUserData[2] = maImportService;
+     aUserData[3] = maExportService;
+     aUserData[4] = maImportXSLT;
+-- 
+1.7.5.4
+
+
+From 46c7ac486e44899cce3057727eccc502ee995a4d Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Wed, 13 Apr 2011 13:48:19 +0100
+Subject: [filters 2/3] add these back in to silence the MAXFILTER assert
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ binfilter/bf_sw/source/filter/basflt/sw_fltini.cxx |   13 ++++++++++
+ .../bf_sw/source/filter/basflt/sw_shellio.cxx      |   24 +-------------------
+ binfilter/inc/bf_sw/iodetect.hxx                   |    5 +--
+ 3 files changed, 16 insertions(+), 26 deletions(-)
+
+diff --git a/binfilter/bf_sw/source/filter/basflt/sw_fltini.cxx b/binfilter/bf_sw/source/filter/basflt/sw_fltini.cxx
+index 8aaedf4..ed36043 100644
+--- binfilter/bf_sw/source/filter/basflt/sw_fltini.cxx
++++ binfilter/bf_sw/source/filter/basflt/sw_fltini.cxx
+@@ -89,10 +89,23 @@ inline void _SetFltPtr( USHORT& rPos, SwRead pReader, const sal_Char* pNm )
+ 
+ void _InitFilter()
+ {
++    SwRead pRd;
++
+     USHORT nCnt = 0;
+     _SetFltPtr( nCnt, (ReadSw3 = new Sw3Reader), FILTER_SW5 );
+     _SetFltPtr( nCnt, ReadSw3, FILTER_SW4 );
+     _SetFltPtr( nCnt, ReadSw3, FILTER_SW3 );
++    _SetFltPtr( nCnt, (ReadSwg = new SwgReader), FILTER_SWG );
++    _SetFltPtr( nCnt, ReadSwg, FILTER_SWGV );
++    _SetFltPtr( nCnt, new Sw6Reader, sSwDos );
++    _SetFltPtr( nCnt, (ReadAscii = new AsciiReader), FILTER_BAS );
++    _SetFltPtr( nCnt, new W4WReader, FILTER_W4W );
++    _SetFltPtr( nCnt, ( pRd = new ExcelReader ), sCExcel );
++    _SetFltPtr( nCnt, pRd, sExcel );
++    _SetFltPtr( nCnt, new LotusReader, sLotusD );
++    _SetFltPtr( nCnt, ReadSwg, sSwg1 );
++
++    _SetFltPtr( nCnt, ReadAscii, FILTER_TEXT );
+ 
+     OSL_ENSURE( MAXFILTER == nCnt, "Anzahl Filter ungleich der Definierten" );
+ }
+diff --git a/binfilter/bf_sw/source/filter/basflt/sw_shellio.cxx b/binfilter/bf_sw/source/filter/basflt/sw_shellio.cxx
+index 606aaa9..50180b3 100644
+--- binfilter/bf_sw/source/filter/basflt/sw_shellio.cxx
++++ binfilter/bf_sw/source/filter/basflt/sw_shellio.cxx
+@@ -351,29 +351,7 @@ using namespace ::com::sun::star;
+ /*?*/ 				// we cannot create a SwDocShell. We could create a
+ /*?*/ 				// SwWebDocShell however, because this exists always
+ /*?*/ 				// for the help.
+-                    OSL_ASSERT("ReadXML removed");
+-
+-//               SvtModuleOptions aModuleOptions;
+-//              if( aModuleOptions.IsWriter() )
+-//              {
+-//                  SwDocShell *pDocSh =
+-//                      new SwDocShell ( SFX_CREATE_MODE_INTERNAL );
+-//                  SvEmbeddedObjectRef xDocSh = pDocSh;
+-//                  if( pDocSh->DoInitNew( 0 ) )
+-//                  {
+-//                      pTemplate = pDocSh->GetDoc();
+-//                      pTemplate->SetOle2Link( Link() );
+-//                      pTemplate->SetBrowseMode( bTmplBrowseMode );
+-//                      pTemplate->RemoveAllFmtLanguageDependencies();
+-//
+-//                      ReadXML->SetOrganizerMode( TRUE );
+-//                      SwReader aRdr( *xStor, aEmptyStr, pTemplate );
+-//                      aRdr.Read( *ReadXML );
+-//                      ReadXML->SetOrganizerMode( FALSE );
+-//
+-//                      pTemplate->AddLink();
+-//                  }
+-//                }
++                                OSL_ASSERT("ReadXML removed");
+ /*?*/ 			}
+ /*?*/ 			else
+ /*?*/ 			{
+diff --git a/binfilter/inc/bf_sw/iodetect.hxx b/binfilter/inc/bf_sw/iodetect.hxx
+index 02e2416..ed4697a 100644
+--- binfilter/inc/bf_sw/iodetect.hxx
++++ binfilter/inc/bf_sw/iodetect.hxx
+@@ -105,7 +105,7 @@ struct SwIoDetect
+ #endif
+ 
+ 
+-const USHORT MAXFILTER = 14;
++const USHORT MAXFILTER = 13;
+ 
+ #define FORAMTNAME_SW4 		"StarWriter 4.0"
+ #define FORAMTNAME_SW3   	"StarWriter 3.0"
+@@ -161,8 +161,7 @@ SwIoDetect aReaderWriter[ MAXFILTER ] = {                      \
+     {/* 9*/ SwIoEntry(sExcel,         4,            FALSE)},   \
+     {/*10*/ SwIoEntry(sLotusD,        5,            TRUE)},    \
+     {/*11*/ SwIoEntry(sSwg1,          4,            FALSE)},   \
+-    {/*12*/ SwIoEntry(FILTER_XML,     4,            TRUE)},    \
+-    {/*13*/ SwIoEntry(FILTER_TEXT,    4,            TRUE)}     \
++    {/*12*/ SwIoEntry(FILTER_TEXT,    4,            TRUE)}     \
+ };
+ 
+ // Filter erkennung
+-- 
+1.7.5.4
+
+reverting on repository help from libreoffice-3.4.3.2 to merge-base 72187f746976ff9a90a6a36f6bb34df4ab3ea7a1
+commits on repository help merge-base 72187f746976ff9a90a6a36f6bb34df4ab3ea7a1 to libreoffice-3.4.4.1
+From 09da52a344af15b9393d5cd3085a1f70a2028502 Mon Sep 17 00:00:00 2001
+From: Andras Timar <atimar@suse.com>
+Date: Tue, 25 Oct 2011 14:41:28 +0200
+Subject: [help 1/2] remove/change *.services.openoffice.org links
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ .../source/text/sbasic/shared/main0601.xhp         |    2 +-
+ helpcontent2/source/text/scalc/01/04060100.xhp     |    4 +-
+ helpcontent2/source/text/scalc/01/04060101.xhp     |    2 +-
+ helpcontent2/source/text/scalc/01/04060107.xhp     |    2 +-
+ helpcontent2/source/text/scalc/01/04060110.xhp     |    4 +-
+ helpcontent2/source/text/scalc/01/04060116.xhp     |    2 +-
+ helpcontent2/source/text/scalc/01/04060182.xhp     |    2 +-
+ helpcontent2/source/text/scalc/01/04060185.xhp     |    2 +-
+ .../source/text/scalc/guide/database_filter.xhp    |    2 +-
+ .../source/text/scalc/guide/database_sort.xhp      |    2 +-
+ helpcontent2/source/text/shared/01/02100001.xhp    |    4 +-
+ helpcontent2/source/text/shared/01/06020000.xhp    |    2 +-
+ helpcontent2/source/text/shared/01/06040400.xhp    |    2 +-
+ .../source/text/shared/01/packagemanager.xhp       |    4 +-
+ .../source/text/shared/01/ref_pdf_export.xhp       |    4 +-
+ .../shared/explorer/database/dabawiz02access.xhp   |    2 +-
+ .../source/text/shared/explorer/database/main.xhp  |    2 +-
+ .../shared/explorer/database/migrate_macros.xhp    |    2 +-
+ .../text/shared/explorer/database/rep_main.xhp     |   36 +-------------------
+ .../shared/explorer/database/rep_navigator.xhp     |    2 +-
+ .../source/text/shared/guide/assistive.xhp         |    2 +-
+ .../text/shared/guide/digital_signatures.xhp       |    2 +-
+ .../text/shared/guide/digitalsign_receive.xhp      |    2 +-
+ .../source/text/shared/guide/digitalsign_send.xhp  |    2 +-
+ .../shared/guide/ms_import_export_limitations.xhp  |    2 +-
+ .../source/text/shared/optionen/01010400.xhp       |    4 +-
+ .../source/text/swriter/guide/numbering_lines.xhp  |    2 +-
+ .../source/text/swriter/guide/numbering_paras.xhp  |    2 +-
+ .../text/swriter/guide/spellcheck_dialog.xhp       |    8 ++--
+ .../source/text/swriter/guide/using_thesaurus.xhp  |    4 +-
+ 30 files changed, 40 insertions(+), 74 deletions(-)
+
+diff --git a/helpcontent2/source/text/sbasic/shared/main0601.xhp b/helpcontent2/source/text/sbasic/shared/main0601.xhp
+index b2e3879..6c6eb46 100644
+--- helpcontent2/source/text/sbasic/shared/main0601.xhp
++++ helpcontent2/source/text/sbasic/shared/main0601.xhp
+@@ -45,7 +45,7 @@
+ <paragraph role="heading" id="hd_id3154232" xml-lang="en-US" level="1" l10n="U" oldref="1"><link href="text/sbasic/shared/main0601.xhp" name="$[officename] Basic Help">%PRODUCTNAME Basic Help</link></paragraph>
+ <section id="basicalt">
+ <paragraph role="paragraph" id="par_id3153894" xml-lang="en-US" l10n="U" oldref="4">%PRODUCTNAME %PRODUCTVERSION provides an Application Programming Interface (API) that allows controlling the $[officename] components with different programming languages by using the $[officename] Software Development Kit (SDK). For more information about the $[officename] API and the Software Development Kit, visit <link href="http://api.openoffice.org/" name="http://api.openoffice.org">http://api.openoffice.org</link></paragraph>
+-<paragraph role="paragraph" id="par_id3147226" xml-lang="en-US" l10n="CHG" oldref="10">This help section explains the most common runtime functions of %PRODUCTNAME Basic. For more in-depth information please refer to the <link href="http://wiki.services.openoffice.org/wiki/Documentation/BASIC_Guide">OpenOffice.org BASIC Programming Guide</link> on the OpenOffice.org Wiki.</paragraph>
++<paragraph role="paragraph" id="par_id3147226" xml-lang="en-US" l10n="CHG" oldref="10">This help section explains the most common runtime functions of %PRODUCTNAME Basic. For more in-depth information please refer to the <link href="http://wiki.documentfoundation.org/Documentation/BASIC_Guide">OpenOffice.org BASIC Programming Guide</link> on the OpenOffice.org Wiki.</paragraph>
+ </section>
+ <paragraph role="heading" id="hd_id3146957" xml-lang="en-US" level="3" l10n="U" oldref="9">Working with %PRODUCTNAME Basic</paragraph>
+ <embed href="text/sbasic/shared/01000000.xhp#doc_title"/>
+diff --git a/helpcontent2/source/text/scalc/01/04060100.xhp b/helpcontent2/source/text/scalc/01/04060100.xhp
+index 35c6a9b..c8ffe7d 100644
+--- helpcontent2/source/text/scalc/01/04060100.xhp
++++ helpcontent2/source/text/scalc/01/04060100.xhp
+@@ -45,7 +45,7 @@
+ <paragraph xml-lang="en-US" id="hd_id3154944" role="heading" level="1" l10n="CHG"
+                  oldref="16">Functions by Category</paragraph>
+       <paragraph xml-lang="en-US" id="par_id3149378" role="paragraph" l10n="CHG" oldref="2">This section describes the functions of $[officename] Calc. The various functions are divided into categories in the Function Wizard.</paragraph>
+-      <paragraph xml-lang="en-US" id="par_id0120200910234570" role="tip" l10n="NEW">You can find detailed explanations, illustrations, and examples of Calc functions in the <link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_Functions_listed_by_category">OpenOffice.org Wiki</link>.</paragraph>
++      <paragraph xml-lang="en-US" id="par_id0120200910234570" role="tip" l10n="NEW">You can find detailed explanations, illustrations, and examples of Calc functions in the <link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_Functions_listed_by_category">OpenOffice.org Wiki</link>.</paragraph>
+       <paragraph xml-lang="en-US" id="hd_id3146972" role="heading" level="2" l10n="U" oldref="3"><link href="text/scalc/01/04060101.xhp" name="Database">Database</link></paragraph>
+       <embed href="text/scalc/01/04060101.xhp#datenbanktext"/>
+       <paragraph xml-lang="en-US" id="hd_id3155443" role="heading" level="2" l10n="U" oldref="4"><link href="text/scalc/01/04060102.xhp" name="Date &amp; Time">Date &amp; Time</link></paragraph>
+@@ -75,7 +75,7 @@
+       <embed href="text/scalc/01/04060111.xhp#addintext"/>
+       <paragraph xml-lang="en-US" id="par_id3150715" role="paragraph" l10n="U" oldref="14"><link href="text/scalc/01/04060199.xhp" name="Operators">Operators</link> are also available.</paragraph>
+       <section id="relatedtopics">
+-         <paragraph xml-lang="en-US" id="par_id0902200809540918" role="paragraph" l10n="NEW"><variable id="drking"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_Functions_listed_by_category">Calc functions in the OpenOffice.org Wiki</link>
++         <paragraph xml-lang="en-US" id="par_id0902200809540918" role="paragraph" l10n="NEW"><variable id="drking"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_Functions_listed_by_category">Calc functions in the OpenOffice.org Wiki</link>
+ </variable></paragraph>
+       </section>
+    </body>
+diff --git a/helpcontent2/source/text/scalc/01/04060101.xhp b/helpcontent2/source/text/scalc/01/04060101.xhp
+index d93663a..2cd7057 100644
+--- helpcontent2/source/text/scalc/01/04060101.xhp
++++ helpcontent2/source/text/scalc/01/04060101.xhp
+@@ -501,7 +501,7 @@
+       <paragraph xml-lang="en-US" id="par_id3147083" role="paragraph" l10n="U" oldref="87">
+ <emph>SearchCriteria</emph> is the cell range containing search criteria. If you write several criteria in one row they are connected by AND. If you write the criteria in different rows they are connected by OR. Empty cells in the search criteria range will be ignored.</paragraph>
+       <paragraph xml-lang="en-US" id="par_id3151188" role="paragraph" l10n="U" oldref="188">Choose <switchinline select="sys"><caseinline select="MAC">%PRODUCTNAME - Preferences</caseinline><defaultinline>Tools - Options</defaultinline></switchinline> - <link href="text/shared/optionen/01060500.xhp" name="Spreadsheet - Calculate">%PRODUCTNAME Calc - Calculate</link> to define how $[officename] Calc acts when searching for identical entries.</paragraph>
+-      <paragraph xml-lang="en-US" id="par_id3882869" role="paragraph" l10n="NEW">See also the Wiki page about <link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Conditional_Counting_and_Summation">Conditional Counting and Summation</link>.</paragraph>
++      <paragraph xml-lang="en-US" id="par_id3882869" role="paragraph" l10n="NEW">See also the Wiki page about <link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Conditional_Counting_and_Summation">Conditional Counting and Summation</link>.</paragraph>
+ <sort order="asc">
+ <section id="Section1">
+ <bookmark xml-lang="en-US" branch="index" id="bm_id3150882"><bookmark_value>DCOUNT function</bookmark_value>
+diff --git a/helpcontent2/source/text/scalc/01/04060107.xhp b/helpcontent2/source/text/scalc/01/04060107.xhp
+index 62f07e7..5fa4da4 100644
+--- helpcontent2/source/text/scalc/01/04060107.xhp
++++ helpcontent2/source/text/scalc/01/04060107.xhp
+@@ -657,7 +657,7 @@
+ </bookmark>
+ <bookmark xml-lang="en-US" branch="hid/SC_HID_FUNC_RGP" id="bm_id3144716" localize="false"/>
+ <paragraph role="heading" id="hd_id3109846" xml-lang="en-US" level="2" l10n="U" oldref="64">LINEST</paragraph>
+-<paragraph role="paragraph" id="par_id3144733" xml-lang="en-US" l10n="CHG" oldref="65"><ahelp hid="HID_FUNC_RGP">Returns a table of statistics for a straight line that best fits a data set.</ahelp><comment>changed based on http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_LINEST_function (issue 76142)</comment></paragraph>
++<paragraph role="paragraph" id="par_id3144733" xml-lang="en-US" l10n="CHG" oldref="65"><ahelp hid="HID_FUNC_RGP">Returns a table of statistics for a straight line that best fits a data set.</ahelp><comment>changed based on http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_LINEST_function (issue 76142)</comment></paragraph>
+ <paragraph role="heading" id="hd_id3152825" xml-lang="en-US" level="3" l10n="U" oldref="66">Syntax</paragraph>
+ <paragraph role="code" id="par_id3152839" xml-lang="en-US" l10n="U" oldref="67">LINEST(data_Y; data_X; linearType; stats)</paragraph>
+ <paragraph role="paragraph" id="par_id3152853" xml-lang="en-US" l10n="U" oldref="68">
+diff --git a/helpcontent2/source/text/scalc/01/04060110.xhp b/helpcontent2/source/text/scalc/01/04060110.xhp
+index 7daa875..b3ce97c 100644
+--- helpcontent2/source/text/scalc/01/04060110.xhp
++++ helpcontent2/source/text/scalc/01/04060110.xhp
+@@ -74,7 +74,7 @@
+ <bookmark xml-lang="en-US" branch="hid/SC_HID_FUNC_ASC" id="bm_id3187353" localize="false"/>
+ <paragraph xml-lang="en-US" id="hd_id7723929" role="heading" level="2" l10n="NEW">ASC</paragraph>
+          <paragraph xml-lang="en-US" id="par_id8455153" role="paragraph" l10n="NEW"><ahelp hid=".">The ASC function converts full-width to half-width ASCII and katakana characters. Returns a text string.</ahelp></paragraph>
+-         <paragraph xml-lang="en-US" id="par_id9912411" role="paragraph" l10n="NEW">See <link href="http://wiki.services.openoffice.org/mwiki/index.php?title=Calc/Features/JIS_and_ASC_functions">http://wiki.services.openoffice.org/mwiki/index.php?title=Calc/Features/JIS_and_ASC_functions</link> for a conversion table.</paragraph>
++         <paragraph xml-lang="en-US" id="par_id9912411" role="paragraph" l10n="NEW">See <link href="http://wiki.documentfoundation.org/Calc/Features/JIS_and_ASC_functions">http://wiki.documentfoundation.org/Calc/Features/JIS_and_ASC_functions</link> for a conversion table.</paragraph>
+          <paragraph xml-lang="en-US" id="hd_id9204992" role="heading" level="3" l10n="NEW">Syntax</paragraph>
+          <paragraph xml-lang="en-US" id="par_id1993774" role="code" l10n="NEW">ASC("Text")</paragraph>
+          <paragraph xml-lang="en-US" id="par_id2949919" role="paragraph" l10n="NEW">
+@@ -306,7 +306,7 @@
+ <bookmark xml-lang="en-US" branch="hid/SC_HID_FUNC_JIS" id="bm_id3818475" localize="false"/>
+ <paragraph xml-lang="en-US" id="hd_id3666188" role="heading" level="2" l10n="NEW">JIS</paragraph>
+          <paragraph xml-lang="en-US" id="par_id964384" role="paragraph" l10n="NEW"><ahelp hid=".">The JIS function converts half-width to full-width ASCII and katakana characters. Returns a text string.</ahelp></paragraph>
+-         <paragraph xml-lang="en-US" id="par_id1551561" role="paragraph" l10n="NEW">See <link href="http://wiki.services.openoffice.org/mwiki/index.php?title=Calc/Features/JIS_and_ASC_functions">http://wiki.services.openoffice.org/mwiki/index.php?title=Calc/Features/JIS_and_ASC_functions</link> for a conversion table.</paragraph>
++         <paragraph xml-lang="en-US" id="par_id1551561" role="paragraph" l10n="NEW">See <link href="http://wiki.documentfoundation.org/Calc/Features/JIS_and_ASC_functions">http://wiki.documentfoundation.org/Calc/Features/JIS_and_ASC_functions</link> for a conversion table.</paragraph>
+          <paragraph xml-lang="en-US" id="hd_id2212897" role="heading" level="3" l10n="NEW">Syntax</paragraph>
+          <paragraph xml-lang="en-US" id="par_id2504654" role="code" l10n="NEW">JIS("Text")</paragraph>
+          <paragraph xml-lang="en-US" id="par_id5292519" role="paragraph" l10n="NEW">
+diff --git a/helpcontent2/source/text/scalc/01/04060116.xhp b/helpcontent2/source/text/scalc/01/04060116.xhp
+index 47fe5a9..8d90988 100644
+--- helpcontent2/source/text/scalc/01/04060116.xhp
++++ helpcontent2/source/text/scalc/01/04060116.xhp
+@@ -553,7 +553,7 @@
+             <emph>FromUnit</emph> is the unit from which conversion is taking place.</paragraph>
+          <paragraph xml-lang="en-US" id="par_id3153790" role="paragraph" l10n="U" oldref="213">
+             <emph>ToUnit</emph> is the unit to which conversion is taking place. Both units must be of the same type.</paragraph>
+-<paragraph xml-lang="en-US" id="par_id09022809540918" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_CONVERT_ADD_function">Current list of CONVERT_ADD units in the OpenOffice.org Wiki.</link></paragraph>
++<paragraph xml-lang="en-US" id="par_id09022809540918" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_CONVERT_ADD_function">Current list of CONVERT_ADD units in the OpenOffice.org Wiki.</link></paragraph>
+          <paragraph xml-lang="en-US" id="hd_id3156270" role="heading" level="3" l10n="U"
+                     oldref="214">Examples</paragraph>
+          <paragraph xml-lang="en-US" id="par_id3156336" role="paragraph" l10n="U" oldref="215">
+diff --git a/helpcontent2/source/text/scalc/01/04060182.xhp b/helpcontent2/source/text/scalc/01/04060182.xhp
+index ea6384c..d6bc19f 100644
+--- helpcontent2/source/text/scalc/01/04060182.xhp
++++ helpcontent2/source/text/scalc/01/04060182.xhp
+@@ -283,7 +283,7 @@
+             <emph>mu</emph> is the known mean of the population.</paragraph>
+          <paragraph xml-lang="en-US" id="par_id3154740" role="paragraph" l10n="CHG" oldref="109">
+             <emph>Sigma</emph> (optional) is the known standard deviation of the population. If omitted, the standard deviation of the given sample is used.</paragraph>
+-	 <paragraph xml-lang="en-US" id="par_id0305200911372999" role="paragraph" l10n="NEW">See also the <link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_ZTEST_function">Wiki page</link>.</paragraph>
++	 <paragraph xml-lang="en-US" id="par_id0305200911372999" role="paragraph" l10n="NEW">See also the <link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_ZTEST_function">Wiki page</link>.</paragraph>
+       </section>
+       <section id="harmean">
+ <bookmark xml-lang="en-US" branch="index" id="bm_id3153623"><bookmark_value>HARMEAN function</bookmark_value>
+diff --git a/helpcontent2/source/text/scalc/01/04060185.xhp b/helpcontent2/source/text/scalc/01/04060185.xhp
+index 53907a2..5193dbe 100644
+--- helpcontent2/source/text/scalc/01/04060185.xhp
++++ helpcontent2/source/text/scalc/01/04060185.xhp
+@@ -521,7 +521,7 @@
+                     oldref="183">Example</paragraph>
+          <paragraph xml-lang="en-US" id="par_id3146077" role="paragraph" l10n="U" oldref="184">
+             <item type="input">=WEIBULL(2;1;1;1)</item> returns 0.86.</paragraph>
+-         <paragraph xml-lang="en-US" id="par_id0305200911372899" role="paragraph" l10n="NEW">See also the <link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Calc:_WEIBULL_function">Wiki page</link>.</paragraph>
++         <paragraph xml-lang="en-US" id="par_id0305200911372899" role="paragraph" l10n="NEW">See also the <link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Calc:_WEIBULL_function">Wiki page</link>.</paragraph>
+       </section>
+ </sort>
+ <section id="relatedtopics">
+diff --git a/helpcontent2/source/text/scalc/guide/database_filter.xhp b/helpcontent2/source/text/scalc/guide/database_filter.xhp
+index ef57d19..3d20377 100644
+--- helpcontent2/source/text/scalc/guide/database_filter.xhp
++++ helpcontent2/source/text/scalc/guide/database_filter.xhp
+@@ -96,7 +96,7 @@
+          <embed href="text/scalc/guide/database_sort.xhp#database_sort"/>
+          <embed href="text/scalc/guide/cellcopy.xhp#cellcopy"/>
+          <embed href="text/scalc/guide/specialfilter.xhp#specialfilter"/>
+-         <paragraph xml-lang="en-US" id="par_id4525284" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Defining_a_Data_Range">Wiki page about defining a data range</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id4525284" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Defining_a_Data_Range">Wiki page about defining a data range</link></paragraph>
+       </section>
+    </body>
+ </helpdocument>
+\ No newline at end of file
+diff --git a/helpcontent2/source/text/scalc/guide/database_sort.xhp b/helpcontent2/source/text/scalc/guide/database_sort.xhp
+index 477bf7a..8c3f927 100644
+--- helpcontent2/source/text/scalc/guide/database_sort.xhp
++++ helpcontent2/source/text/scalc/guide/database_sort.xhp
+@@ -64,7 +64,7 @@
+       <section id="relatedtopics">
+          <embed href="text/scalc/guide/database_define.xhp#database_define"/>
+          <embed href="text/scalc/guide/database_filter.xhp#database_filter"/>
+-         <paragraph xml-lang="en-US" id="par_id1846980" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Defining_a_Data_Range">Wiki page about defining a data range</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id1846980" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Defining_a_Data_Range">Wiki page about defining a data range</link></paragraph>
+       </section>
+    </body>
+ </helpdocument>
+\ No newline at end of file
+diff --git a/helpcontent2/source/text/shared/01/02100001.xhp b/helpcontent2/source/text/shared/01/02100001.xhp
+index c68e45b..e42e993 100644
+--- helpcontent2/source/text/shared/01/02100001.xhp
++++ helpcontent2/source/text/shared/01/02100001.xhp
+@@ -356,8 +356,8 @@
+          <embed href="text/swriter/guide/finding.xhp#finding"/>
+ </case>
+ </switch>
+-<paragraph xml-lang="en-US" id="par_id1751457" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Regular_Expressions_in_Writer">Wiki page about regular expressions in Writer</link></paragraph>
+-         <paragraph xml-lang="en-US" id="par_id5483870" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Regular_Expressions_in_Calc">Wiki page about regular expressions in Calc</link></paragraph>
++<paragraph xml-lang="en-US" id="par_id1751457" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Regular_Expressions_in_Writer">Wiki page about regular expressions in Writer</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id5483870" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Regular_Expressions_in_Calc">Wiki page about regular expressions in Calc</link></paragraph>
+       </section>
+    </body>
+ </helpdocument>
+\ No newline at end of file
+diff --git a/helpcontent2/source/text/shared/01/06020000.xhp b/helpcontent2/source/text/shared/01/06020000.xhp
+index 4904b7b..1d9bd75 100644
+--- helpcontent2/source/text/shared/01/06020000.xhp
++++ helpcontent2/source/text/shared/01/06020000.xhp
+@@ -73,7 +73,7 @@
+ 
+ <bookmark xml-lang="en-US" branch="hid/svx:MenuButton:RID_SVXDLG_THESAURUS:MB_LANGUAGE" id="bm_id3149763" localize="false"/>
+ <paragraph role="heading" id="hd_id3146775" xml-lang="en-US" level="2" l10n="U" oldref="15">Language</paragraph>
+-<paragraph role="paragraph" id="par_id3159157" xml-lang="en-US" l10n="U" oldref="16"><ahelp hid=".">Select a language for the thesaurus.</ahelp> You can install languages with a thesaurus library from the <link href="http://extensions.services.openoffice.org/">Extensions</link> web page.</paragraph>
++<paragraph role="paragraph" id="par_id3159157" xml-lang="en-US" l10n="U" oldref="16"><ahelp hid=".">Select a language for the thesaurus.</ahelp> You can install languages with a thesaurus library from the <link href="http://extensions.libreoffice.org/">Extensions</link> web page.</paragraph>
+ 
+ </body>
+ </helpdocument>
+diff --git a/helpcontent2/source/text/shared/01/06040400.xhp b/helpcontent2/source/text/shared/01/06040400.xhp
+index c4b8875..c0c246b 100644
+--- helpcontent2/source/text/shared/01/06040400.xhp
++++ helpcontent2/source/text/shared/01/06040400.xhp
+@@ -55,7 +55,7 @@
+ <bookmark xml-lang="en-US" branch="hid/CUI_HID_OFAPAGE_QUOTE_SW_CLB" id="bm_id59906552" localize="false"/>
+ <paragraph xml-lang="en-US" id="par_id31537173" role="paragraph" l10n="NEW"><ahelp hid=".">Select to apply the replacements while you type [T], or when you modify existing text [M].</ahelp></paragraph>
+ 
+-<comment>new feature, cws cbosdo01. http://wiki.services.openoffice.org/wiki/Non_Breaking_Spaces_Before_Punctuation_In_French_(espaces_ins%C3%A9cables)</comment>
++<comment>new feature, cws cbosdo01. http://wiki.documentfoundation.org/Non_Breaking_Spaces_Before_Punctuation_In_French_(espaces_ins%C3%A9cables)</comment>
+ <paragraph xml-lang="en-US" id="hd_id3159300" role="heading" level="2" l10n="U" oldref="25">Add non breaking space before specific punctuation marks in French text</paragraph>
+ <paragraph xml-lang="en-US" id="par_id3153173" role="paragraph" l10n="U" oldref="27">Inserts a non breaking space before ";", "!", "?" and ":" when the character language is set to French (France, Belgium, Luxembourg, Monaco, or Switzerland) and before ":" only when the character language is set to French (Canada).</paragraph>
+ 
+diff --git a/helpcontent2/source/text/shared/01/packagemanager.xhp b/helpcontent2/source/text/shared/01/packagemanager.xhp
+index e3db16e..40ab11b 100644
+--- helpcontent2/source/text/shared/01/packagemanager.xhp
++++ helpcontent2/source/text/shared/01/packagemanager.xhp
+@@ -77,7 +77,7 @@
+ </list><comment>UFI: Extension Guide needed. Until we have that guide, I'll add some more info in this file.</comment>
+ <paragraph id="hd_id3895382" role="heading" xml-lang="en-US" level="2">To install an extension</paragraph>
+ <paragraph id="par_id9143955" role="paragraph" xml-lang="en-US">An extension is available as a file with the file extension .oxt.</paragraph>
+-<paragraph id="par_id7857905" role="paragraph" xml-lang="en-US">You can find a collection of extensions on the Web. Click the "Get more extensions here" link in the Extension Manager to open your Web browser and see the <link href="http://extensions.services.openoffice.org/">http://extensions.services.openoffice.org/</link> page.<comment># i78606</comment></paragraph>
++<paragraph id="par_id7857905" role="paragraph" xml-lang="en-US">You can find a collection of extensions on the Web. Click the "Get more extensions here" link in the Extension Manager to open your Web browser and see the <link href="http://extensions.libreoffice.org/">http://extensions.libreoffice.org/</link> page.<comment># i78606</comment></paragraph>
+ <paragraph id="hd_id5016937" role="heading" xml-lang="en-US" level="3">To install a user extension</paragraph>
+ <paragraph id="par_id1856440" role="paragraph" xml-lang="en-US">Do any of the following:</paragraph>
+ <list type="ordered">
+@@ -129,4 +129,4 @@
+ <paragraph id="par_id1439558" role="paragraph" xml-lang="en-US"><ahelp hid=".">Select an installed extension, then click to open the Options dialog for the extension.</ahelp></paragraph>
+ <paragraph id="par_id0103201110331832" role="paragraph" xml-lang="en-US">Some additional commands can appear in the context menu of an extension in the Extension Manager window, depending on the selected extension. You can choose to show the license text again. You can choose to exclude the extension from checking for updates or to include an excluded extension.</paragraph>
+ </body>
+-</helpdocument>
+\ No newline at end of file
++</helpdocument>
+diff --git a/helpcontent2/source/text/shared/01/ref_pdf_export.xhp b/helpcontent2/source/text/shared/01/ref_pdf_export.xhp
+index 02029b6..e08ee9e 100644
+--- helpcontent2/source/text/shared/01/ref_pdf_export.xhp
++++ helpcontent2/source/text/shared/01/ref_pdf_export.xhp
+@@ -134,7 +134,7 @@
+ <paragraph xml-lang="en-US" id="par_id853434896" role="paragraph" l10n="NEW"><ahelp hid=".">Normally the 14 standard Postscript fonts are not embedded in a PDF file, because every PDF reader software already contains these fonts. Enable this option to embed the standard fonts that are installed on your system and that are used in the document.</ahelp> Use this option if you expect to have a better looking or more useful standard font than the font that is available in the recipients' PDF reader software.</paragraph>
+ <bookmark xml-lang="en-US" branch="hid/filter:CheckBox:RID_PDF_TAB_GENER:CB_ADDSTREAM" id="bm_id0804200803552411" localize="false"/>
+ <paragraph xml-lang="en-US" id="hd_id080420080355360" role="heading" level="2" l10n="NEW">Create hybrid file</paragraph>
+-      <paragraph xml-lang="en-US" id="par_id0804200803553767" role="paragraph" l10n="NEW"><ahelp hid=".">When the <link href="http://extensions.services.openoffice.org/project/pdfimport">PDF Import Extension</link> is installed, this setting enables you to export the document as a .pdf file containing two file formats: PDF and ODF.</ahelp></paragraph>
++      <paragraph xml-lang="en-US" id="par_id0804200803553767" role="paragraph" l10n="NEW"><ahelp hid=".">This setting enables you to export the document as a .pdf file containing two file formats: PDF and ODF.</ahelp></paragraph>
+       <paragraph xml-lang="en-US" id="hd_id9796441" role="heading" level="2" l10n="NEW">Initial View</paragraph>
+       <paragraph xml-lang="en-US" id="hd_id1218604" role="heading" level="2" l10n="NEW">Panes</paragraph>
+ <bookmark xml-lang="en-US" branch="hid/filter:RadioButton:RID_PDF_TAB_OPNFTR:RB_OPNMODE_PAGEONLY" id="bm_id4472792" localize="false"/>
+@@ -284,4 +284,4 @@
+                  oldref="50">Export</paragraph>
+       <paragraph xml-lang="en-US" id="par_id3146975" role="paragraph" l10n="U" oldref="51"><ahelp hid=".">Exports the current file in PDF format.</ahelp></paragraph>
+    </body>
+-</helpdocument>
+\ No newline at end of file
++</helpdocument>
+diff --git a/helpcontent2/source/text/shared/explorer/database/dabawiz02access.xhp b/helpcontent2/source/text/shared/explorer/database/dabawiz02access.xhp
+index 69752d2..0b9ea23 100644
+--- helpcontent2/source/text/shared/explorer/database/dabawiz02access.xhp
++++ helpcontent2/source/text/shared/explorer/database/dabawiz02access.xhp
+@@ -45,7 +45,7 @@
+ </bookmark><comment>mw added 2 new index entries</comment><paragraph role="heading" id="par_idN1053D" xml-lang="en-US" level="1" l10n="NEW"><variable id="access"><link href="text/shared/explorer/database/dabawiz02access.xhp">Microsoft Access Connection</link>
+ </variable></paragraph>
+ <paragraph role="paragraph" id="par_idN10541" xml-lang="en-US" l10n="CHG"><ahelp hid=".">Specifies the settings for importing a database file in Microsoft Access or Access 2007 format.</ahelp></paragraph>
+-<paragraph role="paragraph" id="par_id1142772" xml-lang="en-US" l10n="NEW">See also the English Wiki page <link href="http://wiki.services.openoffice.org/wiki/MSA-Base_Faq">http://wiki.services.openoffice.org/wiki/MSA-Base_Faq</link>.</paragraph>
++<paragraph role="paragraph" id="par_id1142772" xml-lang="en-US" l10n="NEW">See also the English Wiki page <link href="http://wiki.documentfoundation.org/MSA-Base_Faq">http://wiki.documentfoundation.org/MSA-Base_Faq</link>.</paragraph>
+ <bookmark xml-lang="en-US" branch="hid/DBACCESS_HID_PAGE_DBWIZARD_MSACCESS_ET_MSACCESSLOCATION" id="bm_id627155" localize="false"/><paragraph role="heading" id="par_idN10544" xml-lang="en-US" level="2" l10n="NEW">Microsoft Access database file</paragraph>
+ <paragraph role="paragraph" id="par_idN10548" xml-lang="en-US" l10n="NEW"><ahelp hid=".">Specifies the path to the database file.</ahelp></paragraph>
+ <bookmark xml-lang="en-US" branch="hid/DBACCESS_HID_PAGE_DBWIZARD_MSACCESS_PB_MSACCESSLOCATION" id="bm_id8335215" localize="false"/><paragraph role="heading" id="par_idN1054B" xml-lang="en-US" level="2" l10n="NEW">Browse</paragraph>
+diff --git a/helpcontent2/source/text/shared/explorer/database/main.xhp b/helpcontent2/source/text/shared/explorer/database/main.xhp
+index bde780c..5162f57 100644
+--- helpcontent2/source/text/shared/explorer/database/main.xhp
++++ helpcontent2/source/text/shared/explorer/database/main.xhp
+@@ -108,7 +108,7 @@
+ <embedvar href="text/shared/explorer/database/toolbars.xhp#toolbars"/>
+ </paragraph>
+ <embed href="text/shared/04/01020000.xhp#DB_keys"/>
+-<paragraph role="paragraph" id="par_id6474806" xml-lang="en-US" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Database">Wiki page about Base</link></paragraph>
++<paragraph role="paragraph" id="par_id6474806" xml-lang="en-US" l10n="NEW"><link href="http://wiki.documentfoundation.org/Database">Wiki page about Base</link></paragraph>
+ </section>
+ </body>
+ </helpdocument>
+diff --git a/helpcontent2/source/text/shared/explorer/database/migrate_macros.xhp b/helpcontent2/source/text/shared/explorer/database/migrate_macros.xhp
+index 11b48dd..c4266f0 100644
+--- helpcontent2/source/text/shared/explorer/database/migrate_macros.xhp
++++ helpcontent2/source/text/shared/explorer/database/migrate_macros.xhp
+@@ -62,7 +62,7 @@
+       <embed href="text/shared/00/00000001.xhp#finish"/>
+       <embed href="text/shared/00/00000001.xhp#abbrechen"/>
+       <section id="relatedtopics">
+-         <paragraph xml-lang="en-US" id="par_id0112200902353554" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Macros_in_Database_Documents">An in depth explanation by the developers (Wiki).</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id0112200902353554" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Macros_in_Database_Documents">An in depth explanation by the developers (Wiki).</link></paragraph>
+       </section>
+    </body>
+ </helpdocument>
+\ No newline at end of file
+diff --git a/helpcontent2/source/text/shared/explorer/database/rep_main.xhp b/helpcontent2/source/text/shared/explorer/database/rep_main.xhp
+index 75e98c6..9209062 100644
+--- helpcontent2/source/text/shared/explorer/database/rep_main.xhp
++++ helpcontent2/source/text/shared/explorer/database/rep_main.xhp
+@@ -45,40 +45,6 @@
+ </variable></paragraph>
+       <paragraph xml-lang="en-US" id="par_id5248573" role="paragraph" l10n="NEW">The Report Builder is a tool to create your own database reports. Unlike with the <link href="text/shared/autopi/01100000.xhp">Report Wizard</link>, using the Report Builder you can take control to design the report the way you want. The generated report is a Writer document that you can edit, too.</paragraph>
+       <paragraph xml-lang="en-US" id="par_id7128818" role="note" l10n="NEW">To use the Report Builder, the Report Builder extension must be installed. In addition, the Java Runtime Environment (JRE) software must be installed, and this software must be selected in %PRODUCTNAME.</paragraph>
+-      <paragraph xml-lang="en-US" id="hd_id3753776" role="heading" level="2" l10n="NEW">To Install the Report Builder Extension</paragraph>
+-      <list type="ordered">
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id5284279" role="paragraph" l10n="NEW">Choose Tools - Extension Manager to open the <link href="text/shared/01/packagemanager.xhp">Extension Manager</link>.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id4494766" role="paragraph" l10n="CHG">If you see the Report Builder in the Extension Manager list, then you do not need to install the extension. Else click the link "Get more extensions here". This opens your web browser at the address <link href="http://extensions.services.openoffice.org">http://extensions.services.openoffice.org</link> and shows a list of available extensions.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id7858516" role="paragraph" l10n="NEW">Find the Report Builder extension. Click at the icon or the "click here" text link. This opens the download page for the extension.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id973540" role="paragraph" l10n="NEW">Click the "Get it!" icon. The extension file will be downloaded to your computer.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id4680928" role="paragraph" l10n="NEW">Switch back from your web browser to the %PRODUCTNAME window. The Extension Manager should still be visible.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id9014252" role="paragraph" l10n="NEW">In the Extension Manager, click Add to open the Add extensions dialog.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id6011841" role="paragraph" l10n="NEW">Select the extension file that you downloaded. Click Open.</paragraph>
+-            <paragraph xml-lang="en-US" id="par_id2591326" role="paragraph" l10n="NEW">This starts the installation of the Report Builder extension.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id6201666" role="paragraph" l10n="NEW">Read the license. If you accept the license, click Accept to continue the installation.</paragraph>
+-         </listitem>
+-         <listitem>
+-            <paragraph xml-lang="en-US" id="par_id208136" role="paragraph" l10n="NEW">Click Close to close the Extension Manager.</paragraph>
+-         </listitem>
+-	          <listitem>
+-            <paragraph xml-lang="en-US" id="par_id20813699" role="paragraph" l10n="NEW">Restart %PRODUCTNAME. If the Quickstarter is running, also close the Quickstarter.</paragraph>
+-         </listitem>
+-      </list>
+       <paragraph xml-lang="en-US" id="hd_id556047" role="heading" level="2" l10n="NEW">To install the JRE software</paragraph>
+       <paragraph xml-lang="en-US" id="par_id4515823" role="paragraph" l10n="NEW">The Report Builder requires an installed Java Runtime Environment (JRE).</paragraph>
+       <list type="ordered">
+@@ -251,4 +217,4 @@
+ 	</image> and double-click your last saved report. A new Writer document will be created which shows the new data.</paragraph>
+       <paragraph xml-lang="en-US" id="par_id8147221" role="paragraph" l10n="NEW">To print a report, choose <item type="menuitem">File - Print</item> from the Writer document.</paragraph>
+    </body>
+-</helpdocument>
+\ No newline at end of file
++</helpdocument>
+diff --git a/helpcontent2/source/text/shared/explorer/database/rep_navigator.xhp b/helpcontent2/source/text/shared/explorer/database/rep_navigator.xhp
+index 4380d9a..dc5ba76 100644
+--- helpcontent2/source/text/shared/explorer/database/rep_navigator.xhp
++++ helpcontent2/source/text/shared/explorer/database/rep_navigator.xhp
+@@ -51,7 +51,7 @@
+ <paragraph role="heading" id="hd_id2932828" xml-lang="en-US" level="2" l10n="NEW">To enter functions to the report</paragraph>
+ <bookmark xml-lang="en-US" branch="hid/.uno:NewFunction" id="bm_id974456" localize="false"/><paragraph role="paragraph" id="par_id5091708" xml-lang="en-US" l10n="NEW"><ahelp hid=".">In the context menu of the Report Navigator, you see the same commands as in the Report Builder view, plus additional commands to create new functions or to delete them.</ahelp></paragraph>
+ <paragraph role="paragraph" id="par_id9449446" xml-lang="en-US" l10n="NEW">Functions can be entered using a syntax as specified by the <link href="http://en.wikipedia.org/wiki/OpenFormula">OpenFormula</link> proposal.</paragraph>
+-<paragraph role="paragraph" id="par_id4095583" xml-lang="en-US" l10n="NEW">See <link href="http://wiki.services.openoffice.org/wiki/Database">Wiki page about Base</link> for some more help regarding the functions in a report.</paragraph>
++<paragraph role="paragraph" id="par_id4095583" xml-lang="en-US" l10n="NEW">See <link href="http://wiki.documentfoundation.org/Database">Wiki page about Base</link> for some more help regarding the functions in a report.</paragraph>
+ <paragraph role="heading" id="hd_id311593" xml-lang="en-US" level="3" l10n="NEW">To calculate a sum for each client<comment>copied from a mail by Ocke - did not test</comment></paragraph>
+ <list type="ordered">
+ <listitem>
+diff --git a/helpcontent2/source/text/shared/guide/assistive.xhp b/helpcontent2/source/text/shared/guide/assistive.xhp
+index 4694bb2..56d0227 100644
+--- helpcontent2/source/text/shared/guide/assistive.xhp
++++ helpcontent2/source/text/shared/guide/assistive.xhp
+@@ -49,7 +49,7 @@
+ <paragraph role="heading" id="hd_id3147399" xml-lang="en-US" level="1" l10n="U" oldref="22"><variable id="assistive"><link href="text/shared/guide/assistive.xhp" name="Assistive Tools in $[officename]">Assistive Tools in $[officename]</link>
+ </variable></paragraph>
+ <paragraph role="paragraph" id="par_id3143267" xml-lang="en-US" l10n="U" oldref="25">$[officename] supports some assistive technology tools like screen magnification software, screen readers, and on-screen keyboards. Most of these tools communicate with $[officename] by means of the Java(TM) Access Bridge software, that uses the Java Accessibility API, a part of the Java runtime environment.</paragraph>
+-<paragraph role="tip" id="par_id8847010" xml-lang="en-US" l10n="NEW">A current list of supported assistive tools can be found on the OpenOffice.org Wiki at <link href="http://wiki.services.openoffice.org/wiki/Accessibility">http://wiki.services.openoffice.org/wiki/Accessibility</link>.</paragraph>
++<paragraph role="tip" id="par_id8847010" xml-lang="en-US" l10n="NEW">A current list of supported assistive tools can be found on the OpenOffice.org Wiki at <link href="http://wiki.documentfoundation.org/Accessibility">http://wiki.documentfoundation.org/Accessibility</link>.</paragraph>
+ <paragraph role="heading" id="hd_id3145345" xml-lang="en-US" level="2" l10n="U" oldref="12">Requirements to use assistive tools in $[officename]</paragraph>
+ <list type="unordered">
+ <listitem>
+diff --git a/helpcontent2/source/text/shared/guide/digital_signatures.xhp b/helpcontent2/source/text/shared/guide/digital_signatures.xhp
+index 9812393..f4dc100 100644
+--- helpcontent2/source/text/shared/guide/digital_signatures.xhp
++++ helpcontent2/source/text/shared/guide/digital_signatures.xhp
+@@ -108,7 +108,7 @@
+       <paragraph xml-lang="en-US" id="par_id6075624" role="paragraph" l10n="NEW">On Windows operating systems, the Windows features of validating a signature are used. On Solaris and Linux systems, files that are supplied by Thunderbird, Mozilla or Firefox are used. You must ensure that the files that are in use within your system are really the original files that were supplied by the original developers. For malevolent intruders, there are numerous ways to replace original files with other files that they supply.</paragraph>
+       <paragraph xml-lang="en-US" id="par_id6819971" role="warning" l10n="NEW">The messages about validation of a signature that you see in %PRODUCTNAME are the messages that the validation files return. The %PRODUCTNAME software has no way to ensure that the messages reflect the true status of any certificate. The %PRODUCTNAME software only displays the messages that other files that are not under control of %PRODUCTNAME report. There is no legal responsibility of %PRODUCTNAME that the displayed messages reflect the true status of a digital signature.</paragraph>
+       <section id="relatedtopics">
+-         <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
+          <paragraph xml-lang="en-US" id="par_id486465" role="paragraph" l10n="NEW"><link href="text/shared/guide/digitalsign_send.xhp">Applying digital signatures</link></paragraph>
+          <paragraph xml-lang="en-US" id="par_id3448591" role="paragraph" l10n="NEW"><link href="text/shared/guide/digitalsign_receive.xhp">Opening a document using WebDAV over HTTPS</link></paragraph>
+       </section>
+diff --git a/helpcontent2/source/text/shared/guide/digitalsign_receive.xhp b/helpcontent2/source/text/shared/guide/digitalsign_receive.xhp
+index 8d917da..23a79fb 100644
+--- helpcontent2/source/text/shared/guide/digitalsign_receive.xhp
++++ helpcontent2/source/text/shared/guide/digitalsign_receive.xhp
+@@ -96,7 +96,7 @@
+   <paragraph xml-lang="en-US" id="par_id3397320" role="paragraph" l10n="NEW"><ahelp hid="." visibility="hidden">If you enable <emph>Remember password till end of session</emph>, your password will be remembered for subsequent WebDAV connections until you exit %PRODUCTNAME.</ahelp></paragraph>
+   <section id="relatedtopics">
+    
+-   <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
++   <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
+    <paragraph xml-lang="en-US" id="par_id2182378" role="paragraph" l10n="NEW"><link href="text/shared/guide/digital_signatures.xhp">About digital signatures</link></paragraph>
+    
+   </section>
+diff --git a/helpcontent2/source/text/shared/guide/digitalsign_send.xhp b/helpcontent2/source/text/shared/guide/digitalsign_send.xhp
+index 0aa7525..9a0d4a4 100644
+--- helpcontent2/source/text/shared/guide/digitalsign_send.xhp
++++ helpcontent2/source/text/shared/guide/digitalsign_send.xhp
+@@ -109,7 +109,7 @@
+ <!-- removed HID 1311736326 -->
+ <paragraph xml-lang="en-US" id="par_id7705618" role="paragraph" l10n="NEW"><ahelp hid="." visibility="hidden">Choose this setting to cancel the connection.</ahelp></paragraph>
+       <section id="relatedtopics">
+-         <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id3204443" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/How_to_use_digital_Signatures">English Wiki page on digital signatures</link></paragraph>
+          <paragraph xml-lang="en-US" id="par_id5166173" role="paragraph" l10n="NEW"><link href="text/shared/guide/digital_signatures.xhp">About digital signatures</link></paragraph>
+       </section>
+    </body>
+diff --git a/helpcontent2/source/text/shared/guide/ms_import_export_limitations.xhp b/helpcontent2/source/text/shared/guide/ms_import_export_limitations.xhp
+index 3953867..8e3daff 100644
+--- helpcontent2/source/text/shared/guide/ms_import_export_limitations.xhp
++++ helpcontent2/source/text/shared/guide/ms_import_export_limitations.xhp
+@@ -127,7 +127,7 @@
+ <paragraph role="paragraph" id="par_id0811200801491972" xml-lang="en-US" l10n="NEW">In Excel, the formula =A1+A2 returns 2, but the formula =SUM(A1,A2) returns 0.<comment>in SUM(A1&lt;limiter&gt;A2), use the Excel limiter comma , in English and semicolon ; in German</comment></paragraph>
+ </listitem>
+ </list>
+-<paragraph role="note" id="par_id3150439" xml-lang="en-US" l10n="CHG" oldref="30">For a detailed overview about converting documents to and from Microsoft Office format, see the <link href="http://wiki.services.openoffice.org/wiki/Documentation/OOoAuthors_User_Manual/Migration_Guide">Migration Guide</link>.</paragraph>
++<paragraph role="note" id="par_id3150439" xml-lang="en-US" l10n="CHG" oldref="30">For a detailed overview about converting documents to and from Microsoft Office format, see the <link href="http://wiki.documentfoundation.org/Documentation/OOoAuthors_User_Manual/Migration_Guide">Migration Guide</link>.</paragraph>
+ <paragraph role="heading" id="par_idN10A9F" xml-lang="en-US" level="2" l10n="NEW">Opening Microsoft Office Documents That Are Protected With a Password</paragraph>
+ <paragraph role="paragraph" id="par_id8699606" xml-lang="en-US" l10n="NEW">%PRODUCTNAME can open the following Microsoft Office document types that are protected by a password.</paragraph>
+ <table id="tbl_id4497512">
+diff --git a/helpcontent2/source/text/shared/optionen/01010400.xhp b/helpcontent2/source/text/shared/optionen/01010400.xhp
+index 443cbe7..da45647 100644
+--- helpcontent2/source/text/shared/optionen/01010400.xhp
++++ helpcontent2/source/text/shared/optionen/01010400.xhp
+@@ -152,8 +152,8 @@
+ <paragraph role="paragraph" id="par_id3155098" xml-lang="en-US" l10n="CHG" oldref="18">Specifies that hyphenation will also be carried out in footnotes, headers and footers.</paragraph>
+ </section>
+ <section id="relatedtopics">
+-<paragraph role="paragraph" id="par_id6434522" xml-lang="en-US" l10n="CHG" localize="false"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Adding_More_Languages">Wiki page: Adding more languages</link></paragraph>
+-<paragraph role="paragraph" id="par_id3552964" xml-lang="en-US" l10n="CHG" localize="false"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Spellchecking_in_More_Languages">Wiki page: Multiple language spellchecking</link></paragraph>
++<paragraph role="paragraph" id="par_id6434522" xml-lang="en-US" l10n="CHG" localize="false"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Adding_More_Languages">Wiki page: Adding more languages</link></paragraph>
++<paragraph role="paragraph" id="par_id3552964" xml-lang="en-US" l10n="CHG" localize="false"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Spellchecking_in_More_Languages">Wiki page: Multiple language spellchecking</link></paragraph>
+ </section>
+ </body>
+ </helpdocument>
+diff --git a/helpcontent2/source/text/swriter/guide/numbering_lines.xhp b/helpcontent2/source/text/swriter/guide/numbering_lines.xhp
+index a69dbd6..6d6bd8d 100644
+--- helpcontent2/source/text/swriter/guide/numbering_lines.xhp
++++ helpcontent2/source/text/swriter/guide/numbering_lines.xhp
+@@ -136,6 +136,6 @@
+       <paragraph xml-lang="en-US" id="par_id3153934" role="paragraph" l10n="U" oldref="5"><link href="text/swriter/01/06180000.xhp" name="Tools - Line Numbering">Tools - Line Numbering</link></paragraph>
+       <embed href="text/swriter/guide/using_numbering.xhp#using_numbering"/>
+       <paragraph xml-lang="en-US" id="par_id3153960" role="paragraph" l10n="U" oldref="32"><link href="text/swriter/01/05030800.xhp" name="Format - Paragraph - Numbering">Format - Paragraph - Numbering</link></paragraph>
+-      <paragraph xml-lang="en-US" id="par_id2212591" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Setting_up_a_Style_for_Numbering_Lines_in_Code_Listings">Wiki page about numbering paragraphs by styles</link></paragraph>
++      <paragraph xml-lang="en-US" id="par_id2212591" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Setting_up_a_Style_for_Numbering_Lines_in_Code_Listings">Wiki page about numbering paragraphs by styles</link></paragraph>
+    </body>
+ </helpdocument>
+\ No newline at end of file
+diff --git a/helpcontent2/source/text/swriter/guide/numbering_paras.xhp b/helpcontent2/source/text/swriter/guide/numbering_paras.xhp
+index 8373dbf..146cb20 100644
+--- helpcontent2/source/text/swriter/guide/numbering_paras.xhp
++++ helpcontent2/source/text/swriter/guide/numbering_paras.xhp
+@@ -95,6 +95,6 @@
+       <embed href="text/shared/guide/numbering_stop.xhp#numbering_stop"/>
+       <embed href="text/swriter/guide/captions.xhp#captions"/>
+       <embed href="text/swriter/guide/number_sequence.xhp#number_sequence"/>
+-      <paragraph xml-lang="en-US" id="par_id6943571" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Setting_up_a_Style_for_Numbering_Lines_in_Code_Listings">Wiki page about numbering paragraphs by styles</link></paragraph>
++      <paragraph xml-lang="en-US" id="par_id6943571" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Setting_up_a_Style_for_Numbering_Lines_in_Code_Listings">Wiki page about numbering paragraphs by styles</link></paragraph>
+    </body>
+ </helpdocument>
+diff --git a/helpcontent2/source/text/swriter/guide/spellcheck_dialog.xhp b/helpcontent2/source/text/swriter/guide/spellcheck_dialog.xhp
+index b532178..a990901 100644
+--- helpcontent2/source/text/swriter/guide/spellcheck_dialog.xhp
++++ helpcontent2/source/text/swriter/guide/spellcheck_dialog.xhp
+@@ -46,7 +46,7 @@
+                  oldref="37"><variable id="spellcheck_dialog"><link href="text/swriter/guide/spellcheck_dialog.xhp" name="Checking Spelling and Grammar">Checking Spelling and Grammar</link>
+ </variable></paragraph>
+       <paragraph xml-lang="en-US" id="par_id3149814" role="paragraph" l10n="CHG" oldref="9">You can manually check the spelling and grammar of a text selection or the entire document.</paragraph>
+-      <paragraph xml-lang="en-US" id="par_id0525200902184476" role="note" l10n="NEW">To check the spelling and the grammar of a text, the appropriate dictionaries must be installed. For many languages three different dictionaries exist: a spellchecker, a hyphenation dictionary, and a thesaurus. Each dictionary covers one language only. Grammar checkers can be downloaded and installed as extensions. See the <link href="http://extensions.services.openoffice.org/dictionary">extensions web page</link>.</paragraph>
++      <paragraph xml-lang="en-US" id="par_id0525200902184476" role="note" l10n="NEW">To check the spelling and the grammar of a text, the appropriate dictionaries must be installed. For many languages three different dictionaries exist: a spellchecker, a hyphenation dictionary, and a thesaurus. Each dictionary covers one language only. Grammar checkers can be downloaded and installed as extensions. See the <link href="http://extensions.libreoffice.org">extensions web page</link>.</paragraph>
+       <paragraph xml-lang="en-US" id="par_id3149828" role="paragraph" l10n="U" oldref="10">The spellcheck starts at the current cursor position, or at the beginning of the text selection.</paragraph>
+       <list type="ordered">
+          <listitem>
+@@ -72,8 +72,8 @@
+          <paragraph xml-lang="en-US" id="par_id3147107" role="paragraph" l10n="U" oldref="49"><link href="text/shared/01/06010000.xhp" name="Spellcheck dialog">Spelling and Grammar dialog</link></paragraph>
+          <embed href="text/swriter/guide/using_hyphen.xhp#using_hyphen"/>
+          <embed href="text/swriter/guide/using_thesaurus.xhp#using_thesaurus"/>
+-         <paragraph xml-lang="en-US" id="par_id9625843" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Adding_More_Languages">Wiki page: Adding more languages</link></paragraph>
+-         <paragraph xml-lang="en-US" id="par_id1683706" role="paragraph" l10n="NEW"><link href="http://wiki.services.openoffice.org/wiki/Documentation/How_Tos/Spellchecking_in_More_Languages">Wiki page: Multiple language spellchecking</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id9625843" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Adding_More_Languages">Wiki page: Adding more languages</link></paragraph>
++         <paragraph xml-lang="en-US" id="par_id1683706" role="paragraph" l10n="NEW"><link href="http://wiki.documentfoundation.org/Documentation/How_Tos/Spellchecking_in_More_Languages">Wiki page: Multiple language spellchecking</link></paragraph>
+       </section>
+    </body>
+-</helpdocument>
+\ No newline at end of file
++</helpdocument>
+diff --git a/helpcontent2/source/text/swriter/guide/using_thesaurus.xhp b/helpcontent2/source/text/swriter/guide/using_thesaurus.xhp
+index 5471ba9..22b5336 100644
+--- helpcontent2/source/text/swriter/guide/using_thesaurus.xhp
++++ helpcontent2/source/text/swriter/guide/using_thesaurus.xhp
+@@ -72,11 +72,11 @@
+ 
+ 
+       <paragraph xml-lang="en-US" id="par_id3156263" role="paragraph" l10n="U" oldref="19">Initially, the thesaurus uses the language of the selected word in the document, if a thesaurus library for that language is installed. The title bar of the Thesaurus dialog displays the language in use.</paragraph>
+-      <paragraph xml-lang="en-US" id="par_id3145113" role="note" l10n="U" oldref="18">To look up the word in a different language, click the Language button, and select one of the installed thesaurus languages. A thesaurus library may not be available for all installed languages. You can install languages with a thesaurus library from the <link href="http://extensions.services.openoffice.org/">Extensions</link> web page.</paragraph>
++      <paragraph xml-lang="en-US" id="par_id3145113" role="note" l10n="U" oldref="18">To look up the word in a different language, click the Language button, and select one of the installed thesaurus languages. A thesaurus library may not be available for all installed languages. You can install languages with a thesaurus library from the <link href="http://extensions.libreoffice.org/">Extensions</link> web page.</paragraph>
+ <paragraph xml-lang="en-US" id="par_id3196263" role="paragraph" l10n="U" oldref="19">If a thesaurus library is installed for the language of a word, the context menu of the word shows a Synonyms submenu. Select any of the terms from the submenu to replace the word.</paragraph>
+       <embed href="text/shared/00/00000004.xhp#related"/>
+       <embed href="text/swriter/guide/spellcheck_dialog.xhp#spellcheck_dialog"/>
+       <embed href="text/swriter/guide/using_hyphen.xhp#using_hyphen"/>
+       <paragraph xml-lang="en-US" id="par_id3154392" role="paragraph" l10n="U" oldref="41"><link href="text/shared/01/06020000.xhp" name="Thesaurus">Thesaurus</link></paragraph>
+    </body>
+-</helpdocument>
+\ No newline at end of file
++</helpdocument>
+-- 
+1.7.5.4
+
+reverting on repository impress from libreoffice-3.4.3.2 to merge-base ec6afdaa4e05aa93ab1de7c66304b9f8ad7c25c6
+commits on repository impress merge-base ec6afdaa4e05aa93ab1de7c66304b9f8ad7c25c6 to libreoffice-3.4.4.1
+From 66d627beac2d018b7bb0c9eefd863cae6bca2e64 Mon Sep 17 00:00:00 2001
+From: Thorsten Behrens <tbehrens@novell.com>
+Date: Tue, 6 Sep 2011 16:25:49 +0200
+Subject: [impress 1/3] Fix hang in slideshow.
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+This fixes fdo#32861, by processing all remaining events after the
+post-yield callback comes around (that's supposed to be the time
+when the app can spend time on event processing).
+
+Signed-off-by: Caolán McNamara <caolanm@redhat.com>
+---
+ sd/source/ui/slideshow/slideshowimpl.cxx |    3 +++
+ 1 files changed, 3 insertions(+), 0 deletions(-)
+
+diff --git a/sd/source/ui/slideshow/slideshowimpl.cxx b/sd/source/ui/slideshow/slideshowimpl.cxx
+index 3ae8df2..8a400d2 100644
+--- sd/source/ui/slideshow/slideshowimpl.cxx
++++ sd/source/ui/slideshow/slideshowimpl.cxx
+@@ -1883,6 +1883,9 @@ IMPL_LINK( SlideshowImpl, PostYieldListener, void*, EMPTYARG )
+ {
+     Application::EnableNoYieldMode(false);
+     Application::RemovePostYieldListener(LINK(this, SlideshowImpl, PostYieldListener));
++    Application::Reschedule(true); // fix for fdo#32861 - process
++                                   // *all* outstanding events after
++                                   // yield is done.
+     if (mbDisposed)
+         return 0;
+     return updateSlideShow();
+-- 
+1.7.5.4
+
+
+From 20140491c901db50783e4f515fae38af7215af7f Mon Sep 17 00:00:00 2001
+From: Ivan Timofeev <timofeev.i.s@gmail.com>
+Date: Mon, 19 Sep 2011 11:52:28 +0100
+Subject: [impress 2/3] fdo#38391: don't crash while dropping texture
+
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>
+---
+ sd/source/ui/view/sdview4.cxx |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/sd/source/ui/view/sdview4.cxx b/sd/source/ui/view/sdview4.cxx
+index f63c3d1..834ff6d 100644
+--- sd/source/ui/view/sdview4.cxx
++++ sd/source/ui/view/sdview4.cxx
+@@ -117,7 +117,7 @@ SdrGrafObj* View::InsertGraphic( const Graphic& rGraphic, sal_Int8& rAction,
+     if( mnAction == DND_ACTION_LINK && pPickObj && pPV )
+     {
+         const bool bIsGraphic = pPickObj->ISA( SdrGrafObj );
+-        if( bIsGraphic || (pObj->IsEmptyPresObj() && !bOnMaster) )
++        if( bIsGraphic || (pObj && pObj->IsEmptyPresObj() && !bOnMaster) )
+         {
+             if( IsUndoEnabled() )
+                 BegUndo(String(SdResId(STR_INSERTGRAPHIC)));	
+-- 
+1.7.5.4
+
+reverting on repository libs-core from libreoffice-3.4.3.2 to merge-base 8bae371ca9602ffe00e51448e710e2f5cd018e54
+diff --git a/svx/inc/svx/svdorect.hxx b/svx/inc/svx/svdorect.hxx
+index 006bec1..6114875 100644
+--- svx/inc/svx/svdorect.hxx
++++ svx/inc/svx/svdorect.hxx
+@@ -85,8 +85,6 @@ public:
+     SdrRectObj();
+     SdrRectObj(const Rectangle& rRect);
+ 
+-    SdrRectObj& operator=(const SdrRectObj& rCopy);
+-
+     // Konstruktion eines Textrahmens
+     SdrRectObj(SdrObjKind eNewTextKind);
+     SdrRectObj(SdrObjKind eNewTextKind, const Rectangle& rRect);
+diff --git a/svx/source/svdraw/svdorect.cxx b/svx/source/svdraw/svdorect.cxx
+index fb642bf..f8bb958 100644
+--- svx/source/svdraw/svdorect.cxx
++++ svx/source/svdraw/svdorect.cxx
+@@ -122,30 +122,19 @@ SdrRectObj::SdrRectObj(SdrObjKind eNewTextKind, const Rectangle& rNewRect, SvStr
+ 
+ SdrRectObj::~SdrRectObj()
+ {
+-    delete mpXPoly;
+-}
+-
+-SdrRectObj& SdrRectObj::operator=(const SdrRectObj& rCopy)
+-{
+-    if ( this == &rCopy )
+-        return *this;
+-
+-    SdrTextObj::operator=( rCopy );
+-
+-    delete mpXPoly;
+-
+-    if ( rCopy.mpXPoly )
+-        mpXPoly = new XPolygon( *rCopy.mpXPoly );
+-    else
+-        mpXPoly = NULL;
+-
+-    return *this;
++    if(mpXPoly) 
++    {
++        delete mpXPoly;
++    }
+ }
+ 
+ void SdrRectObj::SetXPolyDirty()
+ {
+-    delete mpXPoly;
+-    mpXPoly = 0L;
++    if(mpXPoly) 
++    {
++        delete mpXPoly;
++        mpXPoly = 0L;
++    }
+ }
+ 
+ bool SdrRectObj::PaintNeedsXPoly(long nEckRad) const
+@@ -180,7 +169,6 @@ XPolygon SdrRectObj::ImpCalcXPoly(const Rectangle& rRect1, long nRad1) const
+ 
+ void SdrRectObj::RecalcXPoly()
+ {
+-    delete mpXPoly;
+     mpXPoly = new XPolygon(ImpCalcXPoly(aRect,GetEckenradius()));
+ }
+ 
+commits on repository libs-core merge-base 8bae371ca9602ffe00e51448e710e2f5cd018e54 to libreoffice-3.4.4.1
+From 4252f25461096964205c550d483b4c13be2c44f3 Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel.mamane@gestman.lu>
+Date: Mon, 15 Aug 2011 14:02:25 +0200
+Subject: [libs-core 01/12] Janitorial: deduplicate code; no behaviour change
+
+---
+ basic/source/uno/namecont.cxx |    4 +---
+ 1 files changed, 1 insertions(+), 3 deletions(-)
+
+diff --git a/basic/source/uno/namecont.cxx b/basic/source/uno/namecont.cxx
+index 444a4ed..92225a4 100644
+--- basic/source/uno/namecont.cxx
++++ basic/source/uno/namecont.cxx
+@@ -1806,10 +1806,8 @@ void SfxLibraryContainer::storeLibraries_Impl( const uno::Reference< embed::XSto
+         // open the source storage which might be used to copy yet-unmodified libraries
+         try
+         {
+-            if ( mxStorage->hasByName( maLibrariesDir ) )
++            if ( mxStorage->hasByName( maLibrariesDir ) || bInplaceStorage )
+                 xSourceLibrariesStor = mxStorage->openStorageElement( maLibrariesDir, bInplaceStorage ? embed::ElementModes::READWRITE : embed::ElementModes::READ );
+-            else if ( bInplaceStorage )
+-                xSourceLibrariesStor = mxStorage->openStorageElement( maLibrariesDir, embed::ElementModes::READWRITE );
+         }
+         catch( const uno::Exception& )
+         {
+-- 
+1.7.5.4
+
+
+From 857ebe4b6e40275bbe2afaca41210dda97950b9f Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel.mamane@gestman.lu>
+Date: Sun, 14 Aug 2011 17:00:54 +0200
+Subject: [libs-core 02/12] fdo#40079: load Dialog library before trying to
+ get embedded images
+
+---
+ basic/source/uno/dlgcont.cxx |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/basic/source/uno/dlgcont.cxx b/basic/source/uno/dlgcont.cxx
+index c8da150..158d9fe 100644
+--- basic/source/uno/dlgcont.cxx
++++ basic/source/uno/dlgcont.cxx
+@@ -292,7 +292,7 @@ void SfxDialogLibraryContainer::storeLibrariesToStorage( const uno::Reference< e
+     Sequence< OUString > sLibraries = getElementNames();
+     for ( sal_Int32 i=0; i < sLibraries.getLength(); ++i )
+     {
+-        // libraries will already be loaded from above
++        loadLibrary( sLibraries[ i ] );
+         Reference< XNameContainer > xLib;
+         getByName( sLibraries[ i ] ) >>= xLib;
+         if ( xLib.is() )
+-- 
+1.7.5.4
+
+
+From 05e819b26a47089f56c1084302d4afcff3f66de7 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Mon, 22 Aug 2011 14:31:18 +0100
+Subject: [libs-core 03/12] Resolves: fdo#37403 backport collection of
+ operator= fixes
+
+---
+ svx/inc/svx/svdorect.hxx       |    2 ++
+ svx/source/svdraw/svdorect.cxx |   30 +++++++++++++++++++++---------
+ 2 files changed, 23 insertions(+), 9 deletions(-)
+
+diff --git a/svx/inc/svx/svdorect.hxx b/svx/inc/svx/svdorect.hxx
+index 6114875..006bec1 100644
+--- svx/inc/svx/svdorect.hxx
++++ svx/inc/svx/svdorect.hxx
+@@ -85,6 +85,8 @@ public:
+     SdrRectObj();
+     SdrRectObj(const Rectangle& rRect);
+ 
++    SdrRectObj& operator=(const SdrRectObj& rCopy);
++
+     // Konstruktion eines Textrahmens
+     SdrRectObj(SdrObjKind eNewTextKind);
+     SdrRectObj(SdrObjKind eNewTextKind, const Rectangle& rRect);
+diff --git a/svx/source/svdraw/svdorect.cxx b/svx/source/svdraw/svdorect.cxx
+index f8bb958..fb642bf 100644
+--- svx/source/svdraw/svdorect.cxx
++++ svx/source/svdraw/svdorect.cxx
+@@ -122,19 +122,30 @@ SdrRectObj::SdrRectObj(SdrObjKind eNewTextKind, const Rectangle& rNewRect, SvStr
+ 
+ SdrRectObj::~SdrRectObj()
+ {
+-    if(mpXPoly) 
+-    {
+-        delete mpXPoly;
+-    }
++    delete mpXPoly;
++}
++
++SdrRectObj& SdrRectObj::operator=(const SdrRectObj& rCopy)
++{
++    if ( this == &rCopy )
++        return *this;
++
++    SdrTextObj::operator=( rCopy );
++
++    delete mpXPoly;
++
++    if ( rCopy.mpXPoly )
++        mpXPoly = new XPolygon( *rCopy.mpXPoly );
++    else
++        mpXPoly = NULL;
++
++    return *this;
+ }
+ 
+ void SdrRectObj::SetXPolyDirty()
+ {
+-    if(mpXPoly) 
+-    {
+-        delete mpXPoly;
+-        mpXPoly = 0L;
+-    }
++    delete mpXPoly;
++    mpXPoly = 0L;
+ }
+ 
+ bool SdrRectObj::PaintNeedsXPoly(long nEckRad) const
+@@ -169,6 +180,7 @@ XPolygon SdrRectObj::ImpCalcXPoly(const Rectangle& rRect1, long nRad1) const
+ 
+ void SdrRectObj::RecalcXPoly()
+ {
++    delete mpXPoly;
+     mpXPoly = new XPolygon(ImpCalcXPoly(aRect,GetEckenradius()));
+ }
+ 
+-- 
+1.7.5.4
+
+
+From 53714706ae6c8dad65e7dfed124c065fea1e10f9 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Thu, 1 Sep 2011 13:43:35 +0100
+Subject: [libs-core 04/12] Resolves: fdo#37195 CreateProcessServiceFactory
+ can't happen before sync
+
+If CreateProcessServiceFactory is called, then common.rdb of
+"Users/YOU/AppData/Roaming/LibreOffice/3/user/extensions/bundled/registry/
+com.sun.star.comp.deployment.component.PackageRegistryBackend/common.rdb" is
+opened mmapped
+
+On a new start of an LibreOffice which wants to synchronize new config over an
+old config, then it will want do a copy of
+"install/share/prereg/bundled/registry/
+com.sun.star.comp.deployment.component.PackageRegistryBackend/common.rdb"
+over
+"Users/YOU/AppData/Roaming/LibreOffice/3/user/extensions/bundled/registry/
+com.sun.star.comp.deployment.component.PackageRegistryBackend/common.rdb"
+which will fail on windows with error 1224, i.e. ERROR_USER_MAPPED_FILE
+
+That aborts the copy_bundled_recursive copy, leaving an old config
+pointing to the old location of dictionaries.
+
+So for windows at least, CreateProcessServiceFactory shouldn't happen before
+copy_bundled_recursive.
+
+Signed-off-by: Andras Timar <atimar@suse.com>
+---
+ desktop/inc/app.hxx                |    4 ++--
+ desktop/source/app/app.cxx         |   17 +++++++++++++++--
+ desktop/source/app/sofficemain.cxx |    1 -
+ 3 files changed, 17 insertions(+), 5 deletions(-)
+
+diff --git a/desktop/inc/app.hxx b/desktop/inc/app.hxx
+index 7f9a7ef..e13283d 100644
+--- desktop/inc/app.hxx
++++ desktop/inc/app.hxx
+@@ -139,11 +139,11 @@ class Desktop : public Application
+         void                    SetSplashScreenText( const ::rtl::OUString& rText );
+         void                    SetSplashScreenProgress( sal_Int32 );
+ 
+-        void                    CreateProcessServiceFactory();
++        static void             ensureProcessServiceFactory();
+ 
+     private:
+         // Bootstrap methods
+-        ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory > CreateApplicationServiceManager();
++        static ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory > CreateApplicationServiceManager();
+ 
+         void					RegisterServices( ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& xSMgr );
+         void					DeregisterServices();
+diff --git a/desktop/source/app/app.cxx b/desktop/source/app/app.cxx
+index 873588d..1a8fb2f 100644
+--- desktop/source/app/app.cxx
++++ desktop/source/app/app.cxx
+@@ -322,7 +322,10 @@ CommandLineArgs* Desktop::GetCommandLineArgs()
+     {
+         ::osl::MutexGuard aGuard( ::osl::Mutex::getGlobalMutex() );
+         if ( !pArgs )
++        {
++            ensureProcessServiceFactory();
+             pArgs = new CommandLineArgs;
++        }
+     }
+ 
+     return pArgs;
+@@ -711,8 +714,15 @@ void Desktop::Init()
+             copy_bundled_recursive( aPreregBundledPath, aUserPath, +1 );
+         }
+     }
+-    
++
+     // We need to have service factory before going further.
++    // We need to have service factory before going further, but see fdo#37195.
++    // Doing this will mmap common.rdb, making it not overwritable on windows,
++    // so this can't happen before the synchronization above. Lets rework this
++    // so that the above is called *from* ensureProcessServiceFactory or
++    // something to enforce this gotcha
++    ensureProcessServiceFactory();
++
+     if( !::comphelper::getProcessServiceFactory().is())
+     {
+         OSL_FAIL("Service factory should have been crated in soffice_main().");
+@@ -764,8 +774,11 @@ void Desktop::InitFinished()
+ 
+ // GetCommandLineArgs() requires this code to work, otherwise it will abort, and
+ // on Unix command line args needs to be checked before Desktop::Init()
+-void Desktop::CreateProcessServiceFactory()
++void Desktop::ensureProcessServiceFactory()
+ {
++    if( ::comphelper::getProcessServiceFactory().is())
++        return;
++
+     Reference < XMultiServiceFactory > rSMgr = CreateApplicationServiceManager();
+     if( rSMgr.is() )
+     {
+diff --git a/desktop/source/app/sofficemain.cxx b/desktop/source/app/sofficemain.cxx
+index 1e640c5..214fcdf 100644
+--- desktop/source/app/sofficemain.cxx
++++ desktop/source/app/sofficemain.cxx
+@@ -49,7 +49,6 @@ extern "C" int soffice_main()
+     desktop::Desktop aDesktop;
+     // This string is used during initialization of the Gtk+ VCL module
+     aDesktop.SetAppName( rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("soffice")) );
+-    aDesktop.CreateProcessServiceFactory();
+ #ifdef UNX
+     // handle --version and --help already here, otherwise they would be handled
+     // after VCL initialization that might fail if $DISPLAY is not set
+-- 
+1.7.5.4
+
+
+From 14bc9100d36eae3999f1623efce8ee84091da842 Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel@mamane.lu>
+Date: Mon, 12 Sep 2011 01:10:38 +0200
+Subject: [libs-core 05/12] don't rely on ../ure to find javaldx, use proper
+ ../basis-link/ure-link
+
+---
+ desktop/unx/source/start.c |    2 +-
+ 1 files changed, 1 insertions(+), 1 deletions(-)
+
+diff --git a/desktop/unx/source/start.c b/desktop/unx/source/start.c
+index 445bd44..a70a3c1 100755
+--- desktop/unx/source/start.c
++++ desktop/unx/source/start.c
+@@ -837,7 +837,7 @@ exec_javaldx (Args *args)
+     rtl_uString_newFromAscii( &pApp, "file://" );
+     rtl_uString_newConcat( &pApp, pApp, args->pAppPath );
+     pTmp = NULL;
+-    rtl_uString_newFromAscii( &pTmp, "/../ure/bin/javaldx" );
++    rtl_uString_newFromAscii( &pTmp, "/../basis-link/ure-link/bin/javaldx" );
+     rtl_uString_newConcat( &pApp, pApp, pTmp );
+     rtl_uString_release( pTmp );
+ 
+-- 
+1.7.5.4
+
+
+From 253ff23c3a93b5ea45a2451a8bc97fca19856a75 Mon Sep 17 00:00:00 2001
+From: David Tardon <dtardon@redhat.com>
+Date: Tue, 24 May 2011 06:30:46 +0200
+Subject: [libs-core 06/12] handle NULL display gracefully
+
+(cherry-picked from core 2daa098c3c1b49ce4d46306eddc45f7a66b7c021)
+
+Signed-off-by: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+---
+ desktop/unx/source/splashx.c |    6 +++++-
+ 1 files changed, 5 insertions(+), 1 deletions(-)
+
+diff --git a/desktop/unx/source/splashx.c b/desktop/unx/source/splashx.c
+index 4f5d4b2..e975733 100755
+--- desktop/unx/source/splashx.c
++++ desktop/unx/source/splashx.c
+@@ -589,6 +589,9 @@ static void process_events()
+ // Draw the progress
+ void splash_draw_progress( int progress )
+ {
++    if (!display)
++        return;
++
+     // sanity
+     if ( progress < 0 )
+         progress = 0;
+@@ -619,7 +622,8 @@ void splash_draw_progress( int progress )
+ // Close the window & cleanup
+ void splash_close_window()
+ {
+-    XCloseDisplay( display );
++    if (display)
++        XCloseDisplay( display );
+     display = NULL;
+ #ifdef USE_LIBPNG
+     png_destroy_read_struct( &png_ptr, &info_ptr, NULL );
+-- 
+1.7.5.4
+
+
+From 299ada910665c38cc9ccd7a20fb54f8b15229f8c Mon Sep 17 00:00:00 2001
+From: Tor Lillqvist <tlillqvist@suse.com>
+Date: Mon, 19 Sep 2011 12:29:40 +0100
+Subject: [libs-core 07/12] Improve windows odma library location
+
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>
+---
+ ucb/source/ucp/odma/odma_lib.cxx |   15 ++++++++++++---
+ 1 files changed, 12 insertions(+), 3 deletions(-)
+
+diff --git a/ucb/source/ucp/odma/odma_lib.cxx b/ucb/source/ucp/odma/odma_lib.cxx
+index 074c585..f998358 100644
+--- ucb/source/ucp/odma/odma_lib.cxx
++++ ucb/source/ucp/odma/odma_lib.cxx
+@@ -80,16 +80,25 @@ namespace odma
+         if (bBeenHere)
+             return bLoaded;
+ 
++        bBeenHere = sal_True;
++
+         ::rtl::OUString sPath;
+     #ifdef WNT
+-        sPath = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("ODMA32.DLL"));
++        OSL_ASSERT( sizeof( wchar_t ) == sizeof( sal_Unicode ) );
++
++        wchar_t system32[MAX_PATH];
++        UINT n = GetSystemDirectoryW( system32, MAX_PATH );
++
++        if (n == 0)
++            return sal_False;
++
++        sPath = ::rtl::OUString( reinterpret_cast< const sal_Unicode* >( system32 ), n ) + ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("\\ODMA32.DLL"));
++
+     #endif
+     #ifdef UNX
+         sPath = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("libodma.so"));
+     #endif
+ 
+-        bBeenHere = sal_True;
+-
+         pODMA = osl_loadModule( sPath.pData,SAL_LOADMODULE_NOW );
+         if( !pODMA)
+             return sal_False;
+-- 
+1.7.5.4
+
+
+From 0f5a2ad6aca673c43abb7228df9e80e2eac3c372 Mon Sep 17 00:00:00 2001
+From: Noel Power <nopower@suse.com>
+Date: Wed, 21 Sep 2011 14:42:05 +0100
+Subject: [libs-core 08/12] fdo#37164 get testtool working
+
+---
+ basic/source/classes/sb.cxx     |    3 +++
+ fpicker/source/office/iodlg.src |    2 +-
+ 2 files changed, 4 insertions(+), 1 deletions(-)
+
+diff --git a/basic/source/classes/sb.cxx b/basic/source/classes/sb.cxx
+index 4541089..f9cbab6 100644
+--- basic/source/classes/sb.cxx
++++ basic/source/classes/sb.cxx
+@@ -478,6 +478,9 @@ SbxBase* SbFormFactory::Create( sal_uInt16, sal_uInt32 )
+ 
+ SbxObject* SbFormFactory::CreateObject( const String& rClassName )
+ {
++    if ( !SbiRuntime::isVBAEnabled() )
++        return NULL;
++
+     if( SbModule* pMod = pMOD )
+     {
+         if( SbxVariable* pVar = pMod->Find( rClassName, SbxCLASS_OBJECT ) )
+diff --git a/fpicker/source/office/iodlg.src b/fpicker/source/office/iodlg.src
+index 4a3c2f6..d966faa 100644
+--- fpicker/source/office/iodlg.src
++++ fpicker/source/office/iodlg.src
+@@ -92,7 +92,7 @@ ModalDialog DLG_SVT_EXPLORERFILE
+         };
+         QuickHelpText [ en-US ] = "List";
+     };
+-        HelpID = "fpicker:ImageButton:DLG_SVT_EXPLORERFILE:BTN_EXPLORERFILE_DETAILSVIEW";
++
+     MenuButton BTN_EXPLORERFILE_UP
+     {
+         HelpID = "fpicker:MenuButton:DLG_SVT_EXPLORERFILE:BTN_EXPLORERFILE_UP";
+-- 
+1.7.5.4
+
+
+From 1191c474bdf21fda5e8b8ced6b0b50286dea2391 Mon Sep 17 00:00:00 2001
+From: Thorsten Behrens <tbehrens-Et1tbQHTxzrQT0dZR+AlfA@public.gmane.org>
+Date: Fri, 21 Oct 2011 11:14:32 +0200
+Subject: [libs-core 09/12] Fix fdo#41995 fallout - recognize .svg in odf
+ container
+
+Seems the graphic load code is stupid and not using the path name /
+file extension to guess file type, but only "magic byte" detection.
+Giving filter framework the path now, so that .svg actually loads.
+
+Signed-off-by: Michael Stahl <mstahl@redhat.com>
+---
+ svx/source/svdraw/svdograf.cxx |    7 +++++--
+ 1 files changed, 5 insertions(+), 2 deletions(-)
+
+diff --git a/svx/source/svdraw/svdograf.cxx b/svx/source/svdraw/svdograf.cxx
+index e51a268..56d0643 100644
+--- svx/source/svdraw/svdograf.cxx
++++ svx/source/svdraw/svdograf.cxx
+@@ -1299,8 +1299,11 @@ IMPL_LINK( SdrGrafObj, ImpSwapHdl, GraphicObject*, pO )
+                         mbIsPreview = sal_True;
+                     }
+ 
+-                    if( !GraphicFilter::GetGraphicFilter()->ImportGraphic( aGraphic, String(), *pStream,
+-                                                        GRFILTER_FORMAT_DONTKNOW, NULL, 0, pFilterData ) )
++                    if( !GraphicFilter::GetGraphicFilter()->ImportGraphic( aGraphic,
++                                                                           aStreamInfo.maUserData,
++                                                                           *pStream,
++                                                                           GRFILTER_FORMAT_DONTKNOW,
++                                                                           NULL, 0, pFilterData ) )
+                     {
+                         const String aUserData( pGraphic->GetUserData() );
+ 
+-- 
+1.7.5.4
+
+
+From 45e6ceee47e4f1c5fdf800ae35b062f8387cf61c Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel@mamane.lu>
+Date: Mon, 12 Sep 2011 00:00:33 +0200
+Subject: [libs-core 10/12] fdo#40701: DbGridControl::RemoveColumn even if no
+ corresponding Model column
+
+That case crops up when nId==0 i.e. the Handle column
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ svx/source/fmcomp/gridctrl.cxx |    4 ++--
+ 1 files changed, 2 insertions(+), 2 deletions(-)
+
+diff --git a/svx/source/fmcomp/gridctrl.cxx b/svx/source/fmcomp/gridctrl.cxx
+index bb666bc..eaf6a31 100644
+--- svx/source/fmcomp/gridctrl.cxx
++++ svx/source/fmcomp/gridctrl.cxx
+@@ -1722,12 +1722,12 @@ sal_uInt16 DbGridControl::AppendColumn(const XubString& rName, sal_uInt16 nWidth
+ //------------------------------------------------------------------------------
+ void DbGridControl::RemoveColumn(sal_uInt16 nId)
+ {
++    DbGridControl_Base::RemoveColumn(nId);
++
+     sal_uInt16 nIndex = GetModelColumnPos(nId);
+     if (nIndex == GRID_COLUMN_NOT_FOUND)
+         return;
+ 
+-    DbGridControl_Base::RemoveColumn(nId);
+-
+     delete m_aColumns[ nIndex ];
+     DbGridColumns::iterator it = m_aColumns.begin();
+     ::std::advance( it, nIndex );
+-- 
+1.7.5.4
+
+
+From 8590273b3ee8f34386bcb9e620fab10794b38a6f Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel@mamane.lu>
+Date: Sun, 11 Sep 2011 23:40:09 +0200
+Subject: [libs-core 11/12] FmXGridPeer::getByIndex: Error checking of
+ pGrid->GetModelColumnPos(nId) call
+
+Fixes crash of fdo#40701, but not broken feature
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ svx/source/fmcomp/fmgridif.cxx |    3 +++
+ 1 files changed, 3 insertions(+), 0 deletions(-)
+
+diff --git a/svx/source/fmcomp/fmgridif.cxx b/svx/source/fmcomp/fmgridif.cxx
+index 3080d77..a4146a9 100644
+--- svx/source/fmcomp/fmgridif.cxx
++++ svx/source/fmcomp/fmgridif.cxx
+@@ -2442,6 +2442,9 @@ Any FmXGridPeer::getByIndex(sal_Int32 _nIndex) throw( IndexOutOfBoundsException,
+     // get the list position
+     sal_uInt16 nPos = pGrid->GetModelColumnPos(nId);
+ 
++    if ( nPos == GRID_COLUMN_NOT_FOUND )
++        return aElement;
++
+     DbGridColumn* pCol = pGrid->GetColumns().at( nPos );
+     Reference< ::com::sun::star::awt::XControl >  xControl(pCol->GetCell());
+     aElement <<= xControl;
+-- 
+1.7.5.4
+
+reverting on repository libs-extern from libreoffice-3.4.3.2 to merge-base ce315d5b5c7c2d19a2faee03b703d0a7ec1dd298
+commits on repository libs-extern merge-base ce315d5b5c7c2d19a2faee03b703d0a7ec1dd298 to libreoffice-3.4.4.1
+From 2d25fee9ed2fc381ef51dae36c892fa2ebc9d0a5 Mon Sep 17 00:00:00 2001
+From: Lionel Elie Mamane <lionel@mamane.lu>
+Date: Fri, 2 Sep 2011 14:39:41 +0200
+Subject: [libs-extern 1/2] fdo#39355: reenable "use typedefs and endianess
+ from sal" patch hunk
+
+---
+ icc/SampleICC-1.3.2.patch |    1 +
+ 1 files changed, 1 insertions(+), 0 deletions(-)
+
+diff --git a/icc/SampleICC-1.3.2.patch b/icc/SampleICC-1.3.2.patch
+index 3371520..cb65c42 100644
+--- icc/SampleICC-1.3.2.patch
++++ icc/SampleICC-1.3.2.patch
+@@ -1389,6 +1389,7 @@
+   
+     //Define how 64 bit integers are represented
+     #define ICCUINT64 unsigned __int64
++***************
+ *** 107,126 ****
+   
+   #else // non-PC, perhaps Mac or Linux
+-- 
+1.7.5.4
+
+reverting on repository libs-extern-sys from libreoffice-3.4.3.2 to merge-base ececdb1d36efce5f5dd8a42a5a0eecdf45ce1a7d
+commits on repository libs-extern-sys merge-base ececdb1d36efce5f5dd8a42a5a0eecdf45ce1a7d to libreoffice-3.4.4.1
+From 221e7cea3552e155bf1f648a38a9f339f5017ab5 Mon Sep 17 00:00:00 2001
+From: Martin Hosken <martin_hosken@sil.org>
+Date: Tue, 23 Aug 2011 11:43:04 +0100
+Subject: [libs-extern-sys 1/8] Upgrade graphite to 1.0.2 and simplify patches
+
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>
+---
+ graphite/graphite2-0.9.2.patch |  453 ----------------------------------------
+ graphite/graphite_make.patch   |   41 +---
+ graphite/makefile.mk           |    6 +-
+ 3 files changed, 13 insertions(+), 487 deletions(-)
+ delete mode 100644 graphite/graphite2-0.9.2.patch
+
+diff --git a/graphite/graphite2-0.9.2.patch b/graphite/graphite2-0.9.2.patch
+deleted file mode 100644
+index a775c1f..0000000
+--- graphite/graphite2-0.9.2.patch
++++ /dev/null
+@@ -1,453 +0,0 @@
+-diff -r 5369cdd12120 CMakeLists.txt
+---- misc/build/graphite2-0.9.2/CMakeLists.txt	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/CMakeLists.txt	Fri Feb 18 16:05:40 2011 +0700
+-@@ -61,7 +61,7 @@
+- add_subdirectory(gr2fonttest)
+- add_subdirectory(tests)
+- add_subdirectory(doc)
+--set(version 0.0.0)
+-+set(version 2.0.0)
+- set(libdir ${CMAKE_INSTALL_PREFIX}/lib)
+- set(includedir ${CMAKE_INSTALL_PREFIX}/include)
+- 
+-diff -r 5369cdd12120 gr2fonttest/gr2FontTest.cpp
+---- misc/build/graphite2-0.9.2/gr2fonttest/gr2FontTest.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/gr2fonttest/gr2FontTest.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -758,13 +758,11 @@
+-         float advanceWidth = gr_seg_advance_X(pSeg);
+-         fprintf(log, "Advance width = %6.1f\n", advanceWidth);
+-         unsigned int numchar = gr_seg_n_cinfo(pSeg);
+--        gr_uint32 *firsts = (gr_uint32 *)malloc(numchar * sizeof(gr_uint32));
+--        gr_uint32 *lasts = (gr_uint32 *)malloc(numchar * sizeof(gr_uint32));
+--        gr_seg_char_slots(pSeg, firsts, lasts, 0, 0);
+-         fprintf(log, "\nChar\tUnicode\tBefore\tAfter\n");
+-         for (unsigned int j = 0; j < numchar; j++)
+-         {
+--            fprintf(log, "%d\t%04X\t%d\t%d\n", j, gr_cinfo_unicode_char(gr_seg_cinfo(pSeg, j)), firsts[j], lasts[j]);
+-+            const gr_char_info *c = gr_seg_cinfo(pSeg, j);
+-+            fprintf(log, "%d\t%04X\t%d\t%d\n", j, gr_cinfo_unicode_char(c), gr_cinfo_before(c), gr_cinfo_after(c));
+-         }
+-         free(map);
+-         gr_seg_destroy(pSeg);
+-diff -r 5369cdd12120 include/graphite2/Segment.h
+---- misc/build/graphite2-0.9.2/include/graphite2/Segment.h	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/include/graphite2/Segment.h	Fri Feb 18 16:05:40 2011 +0700
+-@@ -135,6 +135,20 @@
+-   */
+- GR2_API int gr_cinfo_break_weight(const gr_char_info* p/*not NULL*/);
+- 
+-+/** Returns the slot index that after this character is after in the slot stream
+-+  *
+-+  * @return after slot index between 0 and gr_seg_n_slots()
+-+  * @param p Pointer to charinfo to return information on.
+-+  */
+-+GR2_API int gr_cinfo_after(const gr_char_info* p/*not NULL*/);
+-+
+-+/** Returns the slot index that before this character is before in the slot stream
+-+  *
+-+  * @return before slot index between 0 and gr_seg_n_slots()
+-+  * @param p Pointer to charinfo to return information on.
+-+  */
+-+GR2_API int gr_cinfo_before(const gr_char_info* p/*not NULL*/);
+-+
+- /** Returns the number of unicode characters in a string.
+-   *
+-   * @return number of characters in the string
+-@@ -205,22 +219,6 @@
+-   */
+- GR2_API const gr_slot* gr_seg_last_slot(gr_segment* pSeg/*not NULL*/);    //may give a base slot or a slot which is attached to another
+- 
+--/** Calculates the underlying character to glyph associations.
+--  *
+--  * @param pSeg  Pointer to the segment we want information on.
+--  * @param begins An array of gr_seg_n_cinfo integers giving slot index for each
+--  *               charinfo. The value corresponds to which slot a cursor would be before
+--  *               if an underlying cursor were before the charinfo at this index.
+--  * @param ends  An array of gr_seg_n_cinfo integers giving the slot index for each
+--  *              charinfo. The value at an index corresponds to which slot a cursor would
+--  *              be after if an underlying cursor were after the charinfo at the index.
+--  * @param sbegins   An array of gr_seg_n_cinfo gr_slot * corresponding to the gr_slot at
+--  *                  index given by begins. The pointer to the array may be NULL.
+--  * @param sends An array of gr_seg_n_cinfo gr_slot * corresponding to the gr_slot at the
+--  *              index given by ends. The pointer to the array may be NULL.
+--  */
+--GR2_API void gr_seg_char_slots(const gr_segment *pSeg, gr_uint32 *begins, gr_uint32 *ends, gr_slot **sbegins, gr_slot **sends);
+--
+- /** Returns the next slot along in the segment.
+-   *
+-   * Slots are held in a linked list. This returns the next in the linked list. The slot
+-@@ -306,6 +304,13 @@
+-   */
+- GR2_API int gr_slot_after(const gr_slot* p/*not NULL*/);
+- 
+-+/** Returns the index of this slot in the segment
+-+  *
+-+  * Returns the index given to this slot during final positioning. This corresponds to the value returned br gr_cinfo_before()
+-+  * and gr_cinfo_after()
+-+  */
+-+GR2_API unsigned int gr_slot_index(const gr_slot* p/*not NULL*/);
+-+
+- /** Return a slot attribute value
+-   *
+-   * Given a slot and an attribute along with a possible subattribute, return the
+-diff -r 5369cdd12120 src/CMakeLists.txt
+---- misc/build/graphite2-0.9.2/src/CMakeLists.txt	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/CMakeLists.txt	Fri Feb 18 16:05:40 2011 +0700
+-@@ -25,7 +25,7 @@
+- INCLUDE(CheckTypeSize)
+- INCLUDE(CheckCXXSourceCompiles)
+- 
+--set(GRAPHITE_API_MAJOR 1)
+-+set(GRAPHITE_API_MAJOR 2)
+- set(GRAPHITE_API_MINOR 0)
+- set(GRAPHITE_API_AGE 0)
+- set(GRAPHITE_SO_VERSION ${GRAPHITE_API_MAJOR}.${GRAPHITE_API_MINOR}.${GRAPHITE_API_AGE})
+-diff -r 5369cdd12120 src/CharInfo.h
+---- misc/build/graphite2-0.9.2/src/CharInfo.h	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/CharInfo.h	Fri Feb 18 16:05:40 2011 +0700
+-@@ -29,16 +29,23 @@
+- {
+- 
+- public:
+-+    CharInfo() : m_before(-1), m_after(0) {}
+-     void init(int cid) { m_char = cid; }
+-     unsigned int unicodeChar() const { return m_char; }
+-     void feats(int offset) { m_featureid = offset; }
+-     int fid() const { return m_featureid; }
+-     int breakWeight() const { return m_break; }
+-     void breakWeight(int val) { m_break = val; }
+-+    int after() const { return m_after; }
+-+    void after(int val) { m_after = val; }
+-+    int before() const { return m_before; }
+-+    void before(int val) { m_before = val; }
+- 
+-     CLASS_NEW_DELETE
+- private:
+-     int m_char;     // Unicode character from character stream
+-+    int m_before;   // slot index before us, comes before
+-+    int m_after;    // slot index after us, comes after
+-     uint8 m_featureid;	// index into features list in the segment
+-     int8 m_break;	// breakweight coming from lb table
+- };
+-diff -r 5369cdd12120 src/Segment.cpp
+---- misc/build/graphite2-0.9.2/src/Segment.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Segment.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -283,6 +283,7 @@
+- {
+-     Position currpos;
+-     Slot *s, *ls = NULL;
+-+    int iSlot = 0;
+-     float cMin = 0.;
+-     float clusterMin = 0.;
+-     Rect bbox;
+-@@ -292,8 +293,16 @@
+-     
+-     if (m_dir & 1)
+-     {
+--        for (s = iEnd; s && s != iStart->prev(); s = s->prev())
+-+        for (s = iEnd, iSlot = m_numGlyphs - 1; s && s != iStart->prev(); s = s->prev(), --iSlot)
+-         {
+-+            for (int j = s->before(); j <= s->after(); j++)
+-+            {
+-+                CharInfo *c = charinfo(j);
+-+                if (c->before() == -1 || iSlot < c->before()) c->before(iSlot);
+-+                if (c->after() < iSlot) c->after(iSlot);
+-+            }
+-+            s->index(iSlot);
+-+
+-             if (s->isBase())
+-             {
+-                 clusterMin = currpos.x;
+-@@ -306,8 +315,16 @@
+-     }
+-     else
+-     {
+--        for (s = iStart; s && s != iEnd->next(); s = s->next())
+-+        for (s = iStart, iSlot = 0; s && s != iEnd->next(); s = s->next(), ++iSlot)
+-         {
+-+            for (int j = s->before(); j <= s->after(); j++)
+-+            {
+-+                CharInfo *c = charinfo(j);
+-+                if (c->before() == -1 || iSlot < c->before()) c->before(iSlot);
+-+                if (c->after() < iSlot) c->after(iSlot);
+-+            }
+-+            s->index(iSlot);
+-+
+-             if (s->isBase())
+-             {
+-                 clusterMin = currpos.x;
+-@@ -321,35 +338,6 @@
+-     if (iStart == m_first && iEnd == m_last) m_advance = currpos;
+- }
+- 
+--
+--void Segment::getCharSlots(uint32 *begins, uint32 *ends, Slot **sbegins, Slot **sends) const
+--{
+--    Slot *s;
+--    uint32 i;
+--    if (!begins || !ends) return;
+--    memset(begins, 0xFF, m_numCharinfo * sizeof(uint32));
+--    memset(ends, 0, m_numCharinfo * sizeof(uint32));
+--    
+--    for (s = m_first, i = 0; s; s = s->next(), i++)
+--    {
+--        for (int j = s->before(); j <= s->after(); j++)
+--        {
+--            assert(j >= 0);
+--            assert(j < static_cast<int>(m_numCharinfo));
+--            if (i < begins[j])
+--            {
+--                begins[j] = i;
+--                if (sbegins) sbegins[j] = s;
+--            }
+--            if (i > ends[j])
+--            {
+--                ends[j] = i;
+--                if (sends) sends[j] = s;
+--            }
+--        }
+--    }
+--}
+--
+- #ifndef DISABLE_TRACING
+- void Segment::logSegment(gr_encform enc, const void* pStart, size_t nChars) const
+- {
+-diff -r 5369cdd12120 src/Segment.h
+---- misc/build/graphite2-0.9.2/src/Segment.h	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Segment.h	Fri Feb 18 16:05:40 2011 +0700
+-@@ -118,7 +118,6 @@
+-     int defaultOriginal() const { return m_defaultOriginal; }
+-     const Face * getFace() const { return m_face; }
+-     const Features & getFeatures(unsigned int /*charIndex*/) { assert(m_feats.size() == 1); return m_feats[0]; }
+--    void getCharSlots(uint32 *begins, uint32 *ends, Slot **sbegins, Slot **sends) const;
+- 
+-     CLASS_NEW_DELETE
+- 
+-diff -r 5369cdd12120 src/Slot.cpp
+---- misc/build/graphite2-0.9.2/src/Slot.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Slot.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -188,15 +188,15 @@
+-     }
+- }
+- 
+--int Slot::getAttr(const Segment *seg, attrCode index, uint8 subindex) const
+-+int Slot::getAttr(const Segment *seg, attrCode ind, uint8 subindex) const
+- {
+-     if (!this) return 0;
+--    if (index == gr_slatUserDefnV1)
+-+    if (ind == gr_slatUserDefnV1)
+-     {
+--        index = gr_slatUserDefn;
+-+        ind = gr_slatUserDefn;
+-         subindex = 0;
+-     }
+--    switch (index)
+-+    switch (ind)
+-     {
+-     case gr_slatAdvX :
+-         return static_cast<int>(m_advance.x);
+-@@ -259,15 +259,15 @@
+-     }
+- }
+- 
+--void Slot::setAttr(Segment *seg, attrCode index, uint8 subindex, int16 value, const SlotMap & map)
+-+void Slot::setAttr(Segment *seg, attrCode ind, uint8 subindex, int16 value, const SlotMap & map)
+- {
+-     if (!this) return;
+--    if (index == gr_slatUserDefnV1)
+-+    if (ind == gr_slatUserDefnV1)
+-     {
+--        index = gr_slatUserDefn;
+-+        ind = gr_slatUserDefn;
+-         subindex = 0;
+-     }
+--    switch (index)
+-+    switch (ind)
+-     {
+-     case gr_slatAdvX :
+-         m_advance = Position(value, m_advance.y);
+-diff -r 5369cdd12120 src/Slot.h
+---- misc/build/graphite2-0.9.2/src/Slot.h	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Slot.h	Fri Feb 18 16:05:40 2011 +0700
+-@@ -47,6 +47,8 @@
+-     Position advancePos() const { return m_advance; }
+-     int before() const { return m_before; }
+-     int after() const { return m_after; }
+-+    uint32 index() const { return m_index; }
+-+    void index(uint32 val) { m_index = val; }
+- 
+-     Slot();
+-     void set(const Slot & slot, int charOffset, uint8 numUserAttr);
+-@@ -58,10 +60,10 @@
+-     void setGlyph(Segment *seg, uint16 glyphid, const GlyphFace * theGlyph = NULL);
+-     void setRealGid(uint16 realGid) { m_realglyphid = realGid; }
+-     void origin(const Position &pos) { m_position = pos + m_shift; }
+--    void originate(int index) { m_original = index; }
+-+    void originate(int ind) { m_original = ind; }
+-     int original() const { return m_original; }
+--    void before(int index) { m_before = index; }
+--    void after(int index) { m_after = index; }
+-+    void before(int ind) { m_before = ind; }
+-+    void after(int ind) { m_after = ind; }
+-     bool isBase() const { return (!m_parent); }
+-     void update(int numSlots, int numCharInfo, Position &relpos);
+-     Position finalise(const Segment* seg, const Font* font, Position* base, Rect* bbox, float* cMin, uint8 attrLevel, float *clusterMin);
+-@@ -75,8 +77,8 @@
+-     uint16 *userAttrs() { return m_userAttr; }
+-     void userAttrs(uint16 *p) { m_userAttr = p; }
+-     void markInsertBefore(bool state) { if (!state) m_flags |= SLOT_INSERT; else m_flags &= ~SLOT_INSERT; }
+--    void setAttr(Segment* seg, attrCode index, uint8 subindex, int16 val, const SlotMap & map);
+--    int getAttr(const Segment *seg, attrCode index, uint8 subindex) const;
+-+    void setAttr(Segment* seg, attrCode ind, uint8 subindex, int16 val, const SlotMap & map);
+-+    int getAttr(const Segment *seg, attrCode ind, uint8 subindex) const;
+-     void attachTo(Slot *ap) { m_parent = ap; }
+-     Slot *attachedTo() const { return m_parent; }
+-     Slot* firstChild() const { return m_child; }
+-@@ -96,8 +98,9 @@
+-     unsigned short m_glyphid;        // glyph id
+-     uint16 m_realglyphid;
+-     uint32 m_original;	    // charinfo that originated this slot (e.g. for feature values)
+--    uint32 m_before;           // charinfo index of before association
+--    uint32 m_after;            // charinfo index of after association
+-+    uint32 m_before;        // charinfo index of before association
+-+    uint32 m_after;         // charinfo index of after association
+-+    uint32 m_index;         // slot index given to this slot during finalising
+-     Slot *m_parent;         // index to parent we are attached to
+-     Slot *m_child;          // index to first child slot that attaches to us
+-     Slot *m_sibling;        // index to next child that attaches to our parent
+-diff -r 5369cdd12120 src/gr_char_info.cpp
+---- misc/build/graphite2-0.9.2/src/gr_char_info.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/gr_char_info.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -39,4 +39,16 @@
+-     return p->breakWeight();
+- }
+- 
+--} // extern "C"
+-\ No newline at end of file
+-+int gr_cinfo_after(const gr_char_info *p/*not NULL*/)
+-+{
+-+    assert(p);
+-+    return p->after();
+-+}
+-+
+-+int gr_cinfo_before(const gr_char_info *p/*not NULL*/)
+-+{
+-+    assert(p);
+-+    return p->before();
+-+}
+-+
+-+} // extern "C"
+-diff -r 5369cdd12120 src/gr_segment.cpp
+---- misc/build/graphite2-0.9.2/src/gr_segment.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/gr_segment.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -162,11 +162,5 @@
+-     return static_cast<const gr_slot*>(pSeg->last());
+- }
+- 
+--void gr_seg_char_slots(const gr_segment *pSeg, gr_uint32 *begins, gr_uint32 *ends, gr_slot **sbegins, gr_slot **sends)
+--{
+--    assert(pSeg && begins && ends);
+--    pSeg->getCharSlots(begins, ends, reinterpret_cast<Slot**>(sbegins), reinterpret_cast<Slot**>(sends));
+--}
+--
+- 
+- } // extern "C"
+-diff -r 5369cdd12120 src/gr_slot.cpp
+---- misc/build/graphite2-0.9.2/src/gr_slot.cpp	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/gr_slot.cpp	Fri Feb 18 16:05:40 2011 +0700
+-@@ -121,6 +121,12 @@
+-     return p->after();
+- }
+- 
+-+unsigned int gr_slot_index(const gr_slot *p/*not NULL*/)
+-+{
+-+    assert(p);
+-+    return p->index();
+-+}
+-+
+- int gr_slot_attr(const gr_slot* p/*not NULL*/, const gr_segment* pSeg/*not NULL*/, gr_attrCode index, gr_uint8 subindex)
+- {
+-     assert(p);
+-diff current src/List.h
+---- misc/build/graphite2-0.9.2/src/List.h	Sat Feb 12 22:54:16 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/List.h	Fri Feb 18 16:05:40 2011 +0700
+-@@ -51,6 +51,6 @@
+-     template <typename I> 
+-     Vector(I first, const I last)               : m_first(0), m_last(0), m_end(0) { insert(begin(), first, last); }
+--    ~Vector() { free(m_first); }
+-+    ~Vector() { clear(); free(m_first); }
+-     
+-     iterator            begin()         { return m_first; }
+-     const_iterator      begin() const   { return m_first; }
+-
+---- misc/graphite2-0.9.2/src/Code.cpp	2011-02-12 16:54:16.000000000 +0100
+-+++ misc/build/graphite2-0.9.2/src/Code.cpp	2011-03-11 11:28:11.700215286 +0100
+-@@ -168,7 +168,7 @@
+-         face.getGlyphFaceCache()->numAttrs(),
+-         face.numFeatures(), 
+-         {1,1,1,1,1,1,1,1, 
+--         1,1,1,1,1,1,1,-1, 
+-+         1,1,1,1,1,1,1,(uint8)-1, 
+-          1,1,1,1,1,1,1,1, 
+-          1,1,1,1,1,1,0,0, 
+-          0,0,0,0,0,0,0,0, 
+---- misc/graphite2-0.9.2/include/graphite2/Types.h	2011-02-12 16:54:16.000000000 +0100
+-+++ misc/build/graphite2-0.9.2/include/graphite2/Types.h	2011-03-15 21:38:06.264788098 +0100
+-@@ -36,7 +36,7 @@
+- };
+- 
+- // Definitions for library publicly exported symbols
+--#if defined _WIN32 || defined __CYGWIN__
+-+#if ( defined _WIN32 || defined __CYGWIN__ ) && !defined GR2_STATIC
+-   #ifdef GR2_EXPORTING
+-     #ifdef __GNUC__
+-       #define GR2_API    __attribute__((dllexport))
+-diff -r b3a86877ec68 src/Pass.cpp
+---- misc/build/graphite2-0.9.2/src/Pass.cpp	Wed May 11 09:34:52 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Pass.cpp	Mon May 16 13:54:00 2011 +0700
+-@@ -513,6 +513,7 @@
+- bool Pass::testConstraint(const Rule &r, Machine & m) const
+- {
+-     if (r.sort - r.preContext > (int)m.slotMap().size() - m.slotMap().context())    return false;
+-+    if (m.slotMap().context() - r.preContext < 0) return false;
+-     if (!*r.constraint)                 return true;
+-     assert(r.constraint->constraint());
+- 
+-@@ -527,6 +528,7 @@
+-     Machine::status_t status = Machine::finished;
+-     for (int n = r.sort; n && map; --n, ++map)
+-     {
+-+	if (!*map) continue;
+-         const int32 ret = r.constraint->run(m, map, status);
+-         if (!ret || status != Machine::finished)
+-         {
+-diff -r b3a86877ec68 src/Rule.h
+---- misc/build/graphite2-0.9.2/src/Rule.h	Wed May 11 09:34:52 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/Rule.h	Mon May 16 13:54:00 2011 +0700
+-@@ -187,8 +187,9 @@
+-   // Merge the new sorted rules list into the current sorted result set.
+-   const RuleEntry * lre = begin(), * rre = state.rules;
+-   RuleEntry * out = m_rules + (m_begin == m_rules)*MAX_RULES;    
+-+  const RuleEntry * lrend = out + MAX_RULES;
+-   m_begin = out; 
+--  while (lre != end())
+-+  while (lre != end() && out != lrend)
+-   {
+-     if (*lre < *rre)      *out++ = *lre++;
+-     else if (*rre < *lre) { *out++ = *rre++; }
+-@@ -196,12 +197,12 @@
+- 
+-     if (rre == state.rules_end) 
+-     { 
+--      while (lre != end()) { *out++ = *lre++; }
+-+      while (lre != end() && out != lrend) { *out++ = *lre++; }
+-       m_end = out;
+-       return;
+-     }
+-   }
+--  while (rre != state.rules_end) { *out++ = *rre++; }
+-+  while (rre != state.rules_end && out != lrend) { *out++ = *rre++; }
+-   m_end = out;
+- }
+- 
+-
+diff --git a/graphite/graphite_make.patch b/graphite/graphite_make.patch
+index f28ed6d..73b6205 100644
+--- graphite/graphite_make.patch
++++ graphite/graphite_make.patch
+@@ -1,6 +1,6 @@
+---- misc/build/graphite2-0.9.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+-+++ misc/build/graphite2-0.9.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+-@@ -1,1 +1,54 @@
++--- misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+++++ misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
++@@ -1,1 +1,34 @@
+ -dummy
+ +EXTERNAL_WARNINGS_NOT_ERRORS := TRUE
+ +
+@@ -18,37 +18,17 @@
+ +CFLAGS+=-O3 -DNDEBUG
+ +.ENDIF
+ +
+-+VMACHINE=call
+++_NS := GR2
+++
+++GR2_MACHINE=call
+ +.IF "$(COM)"=="GCC"
+-+VMACHINE=direct
+++GR2_MACHINE=direct
+ +CFLAGSCXX+=-fpermissive
+ +.ENDIF
+ +
+-+SLOFILES= \
+-+    $(SLO)/$(VMACHINE)_machine.obj \
+-+    $(SLO)/gr_char_info.obj \
+-+    $(SLO)/gr_features.obj \
+-+    $(SLO)/gr_face.obj \
+-+    $(SLO)/gr_font.obj \
+-+    $(SLO)/gr_segment.obj \
+-+    $(SLO)/gr_slot.obj \
+-+    $(SLO)/CachedFace.obj \
+-+    $(SLO)/CmapCache.obj \
+-+    $(SLO)/Code.obj \
+-+    $(SLO)/Face.obj \
+-+    $(SLO)/FeatureMap.obj \
+-+    $(SLO)/Font.obj \
+-+    $(SLO)/GlyphFace.obj \
+-+    $(SLO)/GlyphFaceCache.obj \
+-+    $(SLO)/NameTable.obj \
+-+    $(SLO)/Pass.obj \
+-+    $(SLO)/SegCache.obj \
+-+    $(SLO)/SegCacheEntry.obj \
+-+    $(SLO)/SegCacheStore.obj \
+-+    $(SLO)/Segment.obj \
+-+    $(SLO)/Silf.obj \
+-+    $(SLO)/Slot.obj \
+-+    $(SLO)/TtfUtil.obj
+++.INCLUDE : files.mk
+++
+++SLOFILES= $(foreach,i,$(GR2_SOURCES:b) $(SLO)/$i.obj)
+ +
+ +LIB1ARCHIV=$(LB)$/lib$(TARGET).a
+ +LIB1TARGET=$(SLB)$/$(TARGET).lib
+@@ -56,4 +36,3 @@
+ +OUT2INC=../include/graphite2
+ +
+ +.INCLUDE : target.mk
+-
+diff --git a/graphite/makefile.mk b/graphite/makefile.mk
+index e580b40..ab6bce7 100644
+--- graphite/makefile.mk
++++ graphite/makefile.mk
+@@ -45,9 +45,9 @@ all:
+ 
+ # --- Files --------------------------------------------------------
+ .IF "$(ENABLE_GRAPHITE)"=="TRUE"
+-TARFILE_NAME=graphite2-0.9.2
+-TARFILE_MD5=0625a7d661f899a8ce263fc8a9879108
+-PATCH_FILES= graphite2-0.9.2.patch \
++TARFILE_NAME=graphite2-1.0.2
++TARFILE_MD5=3115c721f5cb7c464f01c2dddccfaba6
++PATCH_FILES= graphite2.patch \
+         graphite_make.patch
+ 
+ ADDITIONAL_FILES= \
+-- 
+1.7.5.4
+
+
+From 44fa311c6181aeddde4895cfd078d75ce79ef5e9 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Tue, 23 Aug 2011 11:48:04 +0100
+Subject: [libs-extern-sys 2/8] placement new needs new header included
+
+---
+ graphite/graphite2.placementnew.patch |   10 ++++++++++
+ graphite/makefile.mk                  |    3 ++-
+ 2 files changed, 12 insertions(+), 1 deletions(-)
+ create mode 100644 graphite/graphite2.placementnew.patch
+
+diff --git a/graphite/graphite2.placementnew.patch b/graphite/graphite2.placementnew.patch
+new file mode 100644
+index 0000000..47b50a2
+--- /dev/null
++++ graphite/graphite2.placementnew.patch
+@@ -0,0 +1,10 @@
++--- misc/graphite2-1.0.2/src/GlyphFace.cpp	2011-08-23 11:37:11.971472000 +0100
+++++ misc/build/graphite2-1.0.2/src/GlyphFace.cpp	2011-08-23 11:38:13.979750400 +0100
++@@ -25,6 +25,7 @@
++ of the License or (at your option) any later version.
++ */
++ #include <iterator>
+++#include <new>
++ #include "GlyphFace.h"
++ #include "XmlTraceLog.h"
++ #include "GlyphFaceCache.h"
+diff --git a/graphite/makefile.mk b/graphite/makefile.mk
+index ab6bce7..522c261 100644
+--- graphite/makefile.mk
++++ graphite/makefile.mk
+@@ -48,7 +48,8 @@ all:
+ TARFILE_NAME=graphite2-1.0.2
+ TARFILE_MD5=3115c721f5cb7c464f01c2dddccfaba6
+ PATCH_FILES= graphite2.patch \
+-        graphite_make.patch
++        graphite_make.patch \
++        graphite2.placementnew.patch
+ 
+ ADDITIONAL_FILES= \
+     src/makefile.mk
+-- 
+1.7.5.4
+
+
+From d7274c0dae4111e78998b8fb32f35d17d206c089 Mon Sep 17 00:00:00 2001
+From: Michael Meeks <michael.meeks@novell.com>
+Date: Tue, 23 Aug 2011 15:46:47 +0100
+Subject: [libs-extern-sys 3/8] add missing file I omitted to add
+
+---
+ graphite/graphite2.patch |   11 +++++++++++
+ 1 files changed, 11 insertions(+), 0 deletions(-)
+ create mode 100644 graphite/graphite2.patch
+
+diff --git a/graphite/graphite2.patch b/graphite/graphite2.patch
+new file mode 100644
+index 0000000..fcd486c
+--- /dev/null
++++ graphite/graphite2.patch
+@@ -0,0 +1,11 @@
++--- misc/graphite2-1.0.2/include/graphite2/Types.h	2011-02-12 16:54:16.000000000 +0100
+++++ misc/build/graphite2-1.0.2/include/graphite2/Types.h	2011-03-15 21:38:06.264788098 +0100
++@@ -36,7 +36,7 @@
++ };
++ 
++ // Definitions for library publicly exported symbols
++-#if defined _WIN32 || defined __CYGWIN__
+++#if ( defined _WIN32 || defined __CYGWIN__ ) && !defined GR2_STATIC
++   #ifdef GR2_EXPORTING
++     #ifdef __GNUC__
++       #define GR2_API    __attribute__((dllexport))
+-- 
+1.7.5.4
+
+
+From 6280ce956cab20712345bb9b1c7183145d8775f9 Mon Sep 17 00:00:00 2001
+From: Rene Engelhard <rene@debian.org>
+Date: Tue, 23 Aug 2011 11:35:15 +0200
+Subject: [libs-extern-sys 4/8] export WORDS_BIGENDIAN in set_soenv and make
+ graphite2 use it
+
+---
+ graphite/graphite_make.patch |    6 +++++-
+ 1 files changed, 5 insertions(+), 1 deletions(-)
+
+diff --git a/graphite/graphite_make.patch b/graphite/graphite_make.patch
+index 73b6205..c137c12 100644
+--- graphite/graphite_make.patch
++++ graphite/graphite_make.patch
+@@ -1,6 +1,6 @@
+ --- misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+ +++ misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+-@@ -1,1 +1,34 @@
++@@ -1,1 +1,38 @@
+ -dummy
+ +EXTERNAL_WARNINGS_NOT_ERRORS := TRUE
+ +
+@@ -18,6 +18,10 @@
+ +CFLAGS+=-O3 -DNDEBUG
+ +.ENDIF
+ +
+++.IF "$(WORDS_BIGENDIAN)" == "yes"
+++CFLAGS += -DWORDS_BIGENDIAN
+++.ENDIF
+++
+ +_NS := GR2
+ +
+ +GR2_MACHINE=call
+-- 
+1.7.5.4
+
+
+From 2a3a9ed405e6c5e1af293187bfc881d6f210093a Mon Sep 17 00:00:00 2001
+From: Michael Stahl <mstahl@redhat.com>
+Date: Tue, 18 Oct 2011 21:48:46 +0200
+Subject: [libs-extern-sys 5/8] nss: replace Linux 3.0 workaround with one for
+ 3.x
+
+backport of ab3895465a6cf0a8a41c7432ad9a8f77df7ae572 to 3.4
+
+Signed-off-by Michael Meeks <michael.meeks@suse.com>
+---
+ nss/makefile.mk      |    2 +-
+ nss/nss-linux3.patch |   13 +++++++++++++
+ nss/nss.patch        |   14 --------------
+ 3 files changed, 14 insertions(+), 15 deletions(-)
+ create mode 100644 nss/nss-linux3.patch
+
+diff --git a/nss/makefile.mk b/nss/makefile.mk
+index 45f1feb..22ebefb 100644
+--- nss/makefile.mk
++++ nss/makefile.mk
+@@ -44,7 +44,7 @@ all:
+ TARFILE_NAME=nss-3.12.8-with-nspr-4.8.6
+ TARFILE_MD5=71474203939fafbe271e1263e61d083e
+ TARFILE_ROOTDIR=nss-3.12.8
+-PATCH_FILES=nss.patch nss.aix.patch
++PATCH_FILES=nss.patch nss.aix.patch nss-linux3.patch
+ 
+ .IF "$(OS)"=="MACOSX"
+ PATCH_FILES+=nss_macosx.patch
+diff --git a/nss/nss-linux3.patch b/nss/nss-linux3.patch
+new file mode 100644
+index 0000000..62c667f
+--- /dev/null
++++ nss/nss-linux3.patch
+@@ -0,0 +1,13 @@
++--- misc/nss-3.12.8/mozilla/security/coreconf/arch.mk	2011-10-06 19:58:31.808695724 +0200
+++++ misc/build/nss-3.12.8/mozilla/security/coreconf/arch.mk	2011-10-06 19:58:00.074648943 +0200
++@@ -152,6 +152,10 @@
++ 
++ ifeq ($(OS_ARCH),Linux)
++     OS_RELEASE := $(subst ., ,$(OS_RELEASE))
+++    # force Linux 3.x to 2.6
+++    ifeq ($(word 1,$(OS_RELEASE)),3)
+++	OS_RELEASE := 2 6
+++    endif
++     ifneq ($(words $(OS_RELEASE)),1)
++ 	OS_RELEASE := $(word 1,$(OS_RELEASE)).$(word 2,$(OS_RELEASE))
++     endif
+diff --git a/nss/nss.patch b/nss/nss.patch
+index ac24855..6930e67 100644
+--- nss/nss.patch
++++ nss/nss.patch
+@@ -189,17 +189,3 @@
+  endif
+  CHECKLOC = $(CHECKLIBS:.$(DLL_SUFFIX)=.chk)
+  
+---- /dev/null	2011-07-24 19:07:44.290563140 +0200
+-+++ misc/build/nss-3.12.8/mozilla/security/coreconf/Linux3.0.mk	2011-07-24 22:21:02.710513995 +0200
+-@@ -0,0 +1,11 @@
+-+include $(CORE_DEPTH)/coreconf/Linux.mk
+-+
+-+OS_REL_CFLAGS   += -DLINUX2_1
+-+MKSHLIB         = $(CC) $(DSO_LDOPTS) -Wl,-soname -Wl,$(@:$(OBJDIR)/%.so=%.so) $(RPATH)
+-+
+-+ifdef MAPFILE
+-+	MKSHLIB += -Wl,--version-script,$(MAPFILE)
+-+endif
+-+PROCESS_MAP_FILE = grep -v ';-' $< | \
+-+        sed -e 's,;+,,' -e 's; DATA ;;' -e 's,;;,,' -e 's,;.*,;,' > $@
+-+
+-- 
+1.7.5.4
+
+
+From a7460c931b51f1876ff6b49d0c27300295c7d1f8 Mon Sep 17 00:00:00 2001
+From: Michael Stahl <mstahl@redhat.com>
+Date: Tue, 18 Oct 2011 21:52:30 +0200
+Subject: [libs-extern-sys 6/8] moz: replace Linux 3.0 workaround with one for
+ 3.x
+
+backport of fa70d98e729c0dba44e1c8e25fe1323bad918945 to 3.4
+
+Signed-off-by Michael Meeks <michael.meeks@suse.com>
+---
+ moz/makefile.mk                   |    4 +++-
+ moz/patches/nss-linux3.patch      |   13 +++++++++++++
+ moz/seamonkey-source-1.1.14.patch |   16 ----------------
+ 3 files changed, 16 insertions(+), 17 deletions(-)
+ create mode 100644 moz/patches/nss-linux3.patch
+
+diff --git a/moz/makefile.mk b/moz/makefile.mk
+index 94d6935..c11cf6a 100644
+--- moz/makefile.mk
++++ moz/makefile.mk
+@@ -95,7 +95,9 @@ PATCH_FILES = \
+     patches/link_fontconfig.patch \
+     patches/brokenmakefile.patch \
+     patches/aix_build_fix.patch \
+-    patches/libpr0n_build_fix.patch
++    patches/libpr0n_build_fix.patch \
++    patches/nss-linux3.patch \
++
+ 
+ # This file is needed for the W32 build when BUILD_MOZAB is set
+ # (currently only vc8/vs2005 is supported when BUILD_MOZAB is set)
+diff --git a/moz/patches/nss-linux3.patch b/moz/patches/nss-linux3.patch
+new file mode 100644
+index 0000000..b735669
+--- /dev/null
++++ moz/patches/nss-linux3.patch
+@@ -0,0 +1,13 @@
++--- misc/mozilla/security/coreconf/arch.mk	2011-10-06 19:58:31.808695724 +0200
+++++ misc/build/mozilla/security/coreconf/arch.mk	2011-10-06 19:58:00.074648943 +0200
++@@ -152,6 +152,10 @@
++ 
++ ifeq ($(OS_ARCH),Linux)
++     OS_RELEASE := $(subst ., ,$(OS_RELEASE))
+++    # force Linux 3.x to 2.6
+++    ifeq ($(word 1,$(OS_RELEASE)),3)
+++	OS_RELEASE := 2 6
+++    endif
++     ifneq ($(words $(OS_RELEASE)),1)
++ 	OS_RELEASE := $(word 1,$(OS_RELEASE)).$(word 2,$(OS_RELEASE))
++     endif
+diff --git a/moz/seamonkey-source-1.1.14.patch b/moz/seamonkey-source-1.1.14.patch
+index db62e8b..566a044 100644
+--- moz/seamonkey-source-1.1.14.patch
++++ moz/seamonkey-source-1.1.14.patch
+@@ -6336,19 +6336,3 @@
+  
+  clean clobber::
+  	rm -rf $(DIST)/$(APP_NAME).app
+---- /dev/null	2011-07-24 19:07:44.290563140 +0200
+-+++ misc/build/mozilla/security/coreconf/Linux3.0.mk	2011-07-24 22:21:02.710513995 +0200
+-@@ -0,0 +1,13 @@
+-+include $(CORE_DEPTH)/coreconf/Linux.mk
+-+
+-+DSO_LDOPTS      += -Wl,-z,defs
+-+
+-+OS_REL_CFLAGS   += -DLINUX2_1
+-+MKSHLIB         = $(CC) $(DSO_LDOPTS) -Wl,-soname -Wl,$(@:$(OBJDIR)/%.so=%.so)
+-+
+-+ifdef MAPFILE
+-+	MKSHLIB += -Wl,--version-script,$(MAPFILE)
+-+endif
+-+PROCESS_MAP_FILE = grep -v ';-' $< | \
+-+        sed -e 's,;+,,' -e 's; DATA ;;' -e 's,;;,,' -e 's,;.*,;,' > $@
+-+
+-- 
+1.7.5.4
+
+
+From 2cd89a55941292b3416070b9a5b90274deb59370 Mon Sep 17 00:00:00 2001
+From: Martin Hosken <martin_hosken@sil.org>
+Date: Thu, 20 Oct 2011 14:25:46 +0100
+Subject: [libs-extern-sys 7/8] Upgrade graphite to 1.0.3 fix surrogate
+ support
+
+Signed-off-by: Michael Meeks <michael.meeks@suse.com>
+---
+ graphite/graphite2.patch     |    4 ++--
+ graphite/graphite_make.patch |    4 ++--
+ graphite/makefile.mk         |    7 +++----
+ 3 files changed, 7 insertions(+), 8 deletions(-)
+
+diff --git a/graphite/graphite2.patch b/graphite/graphite2.patch
+index fcd486c..067c747 100644
+--- graphite/graphite2.patch
++++ graphite/graphite2.patch
+@@ -1,5 +1,5 @@
+---- misc/graphite2-1.0.2/include/graphite2/Types.h	2011-02-12 16:54:16.000000000 +0100
+-+++ misc/build/graphite2-1.0.2/include/graphite2/Types.h	2011-03-15 21:38:06.264788098 +0100
++--- misc/graphite2-1.0.3/include/graphite2/Types.h
+++++ misc/build/graphite2-1.0.3/include/graphite2/Types.h
+ @@ -36,7 +36,7 @@
+  };
+  
+diff --git a/graphite/graphite_make.patch b/graphite/graphite_make.patch
+index c137c12..4532163 100644
+--- graphite/graphite_make.patch
++++ graphite/graphite_make.patch
+@@ -1,5 +1,5 @@
+---- misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+-+++ misc/build/graphite2-1.0.2/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
++--- misc/build/graphite2-1.0.3/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+++++ misc/build/graphite2-1.0.3/src/makefile.mk  Fri Mar  4 10:20:30 2011 +0700
+ @@ -1,1 +1,38 @@
+ -dummy
+ +EXTERNAL_WARNINGS_NOT_ERRORS := TRUE
+diff --git a/graphite/makefile.mk b/graphite/makefile.mk
+index 522c261..3793d6c 100644
+--- graphite/makefile.mk
++++ graphite/makefile.mk
+@@ -45,11 +45,10 @@ all:
+ 
+ # --- Files --------------------------------------------------------
+ .IF "$(ENABLE_GRAPHITE)"=="TRUE"
+-TARFILE_NAME=graphite2-1.0.2
+-TARFILE_MD5=3115c721f5cb7c464f01c2dddccfaba6
++TARFILE_NAME=graphite2-1.0.3
++TARFILE_MD5=3bf481ca95109b14435125c0dd1f2217
+ PATCH_FILES= graphite2.patch \
+-        graphite_make.patch \
+-        graphite2.placementnew.patch
++        graphite_make.patch 
+ 
+ ADDITIONAL_FILES= \
+     src/makefile.mk
+-- 
+1.7.5.4
+
+reverting on repository libs-gui from libreoffice-3.4.3.2 to merge-base b059b524f01f6477605ea19cfaeb07df2d47053c
+commits on repository libs-gui merge-base b059b524f01f6477605ea19cfaeb07df2d47053c to libreoffice-3.4.4.1
+From cd19349339135af876d3c484813738c39a175a42 Mon Sep 17 00:00:00 2001
+From: Radek Doulik <rodo@novell.com>
+Date: Thu, 1 Sep 2011 11:14:21 +0200
+Subject: [libs-gui 1/7] make sure we stay in array bounds
+
+Signed-off-by: Thorsten Behrens <tbehrens@novell.com>
+---
+ vcl/unx/gtk/app/gtkdata.cxx |    6 ++++--
+ 1 files changed, 4 insertions(+), 2 deletions(-)
+
+diff --git a/vcl/unx/gtk/app/gtkdata.cxx b/vcl/unx/gtk/app/gtkdata.cxx
+index c38876b..6a61098 100644
+--- vcl/unx/gtk/app/gtkdata.cxx
++++ vcl/unx/gtk/app/gtkdata.cxx
+@@ -265,8 +265,10 @@ int GtkSalDisplay::GetDefaultMonitorNumber() const
+     gint nMonitors = gdk_screen_get_n_monitors(pScreen);
+     for (gint i = 0; i < nMonitors; ++i)
+     {
+-        if (g_ascii_strncasecmp (gdk_screen_get_monitor_plug_name(pScreen, i), "LVDS", 4) == 0)
+-            return m_aXineramaScreenIndexMap[i];
++        if (g_ascii_strncasecmp (gdk_screen_get_monitor_plug_name(pScreen, i), "LVDS", 4) == 0) {
++            OSL_ASSERT( size_t(i) < m_aXineramaScreenIndexMap.size() );
++            return (size_t(i) < m_aXineramaScreenIndexMap.size()) ? m_aXineramaScreenIndexMap[i] : 0;
++        }
+     }
+ #endif
+     return 0;
+-- 
+1.7.5.4
+
+
+From b3d61e7991192986dcd7103d3c86ee50f8425504 Mon Sep 17 00:00:00 2001
+From: Radek Doulik <rodo@novell.com>
+Date: Tue, 21 Jun 2011 13:25:16 +0200
+Subject: [libs-gui 2/7] fix crash when changing screen resolution
+
+ - m_aXineramaScreenIndexMap in GtkSalDisplay was shadowing
+   the same field in SalDisplay, which led to crash in saldisp.cxx
+   code in SalDisplay::addXineramaScreenUnique
+
+Signed-off-by: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>>
+---
+ vcl/unx/inc/plugins/gtk/gtkdata.hxx |    1 -
+ 1 files changed, 0 insertions(+), 1 deletions(-)
+
+diff --git a/vcl/unx/inc/plugins/gtk/gtkdata.hxx b/vcl/unx/inc/plugins/gtk/gtkdata.hxx
+index 93443f9..db7ebcf 100644
+--- vcl/unx/inc/plugins/gtk/gtkdata.hxx
++++ vcl/unx/inc/plugins/gtk/gtkdata.hxx
+@@ -60,7 +60,6 @@ class GtkSalDisplay : public SalDisplay
+     GdkDisplay*						m_pGdkDisplay;
+     GdkCursor                      *m_aCursors[ POINTER_COUNT ];
+     bool                            m_bStartupCompleted;
+-    std::vector< int >              m_aXineramaScreenIndexMap;
+ 
+     GdkCursor* getFromXPM( const unsigned char *pBitmap, const unsigned char *pMask,
+                            int nWidth, int nHeight, int nXHot, int nYHot );
+-- 
+1.7.5.4
+
+
+From 18744f661be29d5f41421c5b71b2434097e8ef4c Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Caol=C3=A1n=20McNamara?= <caolanm@redhat.com>
+Date: Thu, 29 Sep 2011 21:59:28 +0100
+Subject: [libs-gui 3/7] help gcc 4.6.1 out with ambiguity
+
+---
+ vcl/unx/gtk/a11y/atkutil.cxx |    6 +++++-
+ 1 files changed, 5 insertions(+), 1 deletions(-)
+
+diff --git a/vcl/unx/gtk/a11y/atkutil.cxx b/vcl/unx/gtk/a11y/atkutil.cxx
+index 68bb949..e662f6e 100644
+--- vcl/unx/gtk/a11y/atkutil.cxx
++++ vcl/unx/gtk/a11y/atkutil.cxx
+@@ -312,8 +312,12 @@ void DocumentFocusListener::attachRecursive(
+     uno::Reference< accessibility::XAccessibleEventBroadcaster > xBroadcaster =
+         uno::Reference< accessibility::XAccessibleEventBroadcaster >(xContext, uno::UNO_QUERY);
+ 
++    if (!xBroadcaster.is())
++        return;
++
+     // If not already done, add the broadcaster to the list and attach as listener.
+-    if( xBroadcaster.is() && m_aRefList.insert(xBroadcaster).second )
++    uno::Reference< uno::XInterface > xInterface = xBroadcaster;
++    if( m_aRefList.insert(xInterface).second )
+     {
+         xBroadcaster->addEventListener(static_cast< accessibility::XAccessibleEventListener *>(this));
+ 
+-- 
+1.7.5.4
+
+
+From 79801abff2e4764471a7b328f9150fe4feafe61f Mon Sep 17 00:00:00 2001
+From: Martin Hosken <martin_hosken@sil.org>
+Date: Thu, 20 Oct 2011 14:25:50 +0100
+Subject: [libs-gui 4/7] Upgrade graphite to 1.0.3 fix surrogate support
+
+Signed-off-by: Michael Meeks <michael.meeks@suse.com>
+---
+ vcl/source/glyphs/graphite_layout.cxx |   33 +++++++++++++++++++--------------
+ 1 files changed, 19 insertions(+), 14 deletions(-)
+
+diff --git a/vcl/source/glyphs/graphite_layout.cxx b/vcl/source/glyphs/graphite_layout.cxx
+index 02e9cea..5238609 100644
+--- vcl/source/glyphs/graphite_layout.cxx
++++ vcl/source/glyphs/graphite_layout.cxx
+@@ -36,9 +36,9 @@
+ #define GR_NAMESPACE
+ 
+ // Enable lots of debug info
+-#ifdef DEBUG
++#if OSL_DEBUG_LEVEL > 1
+ #include <cstdio>
+-//#define GRLAYOUT_DEBUG 1
++#define GRLAYOUT_DEBUG 1
+ #undef NDEBUG
+ #endif
+ 
+@@ -329,8 +329,9 @@ GraphiteLayout::fillFrom(gr_segment * pSegment, ImplLayoutArgs &rArgs, float fSc
+             float leftBoundary = gr_slot_origin_X(clusterFirst);
+             float rightBoundary = (clusterAfter)?
+                 gr_slot_origin_X(clusterAfter) : gr_seg_advance_X(pSegment);
+-            if (mnSegCharOffset + nFirstCharInCluster >= mnMinCharPos &&
+-                mnSegCharOffset + nFirstCharInCluster < mnEndCharPos)
++            size_t bFirstChar = gr_cinfo_base(gr_seg_cinfo(pSegment, nFirstCharInCluster));
++            if (mnSegCharOffset + bFirstChar >= mnMinCharPos &&
++                mnSegCharOffset + bFirstChar < mnEndCharPos)
+             {
+                 fMinX = minimum<float>(fMinX, leftBoundary);
+                 fMaxX = maximum<float>(fMaxX, rightBoundary);
+@@ -338,21 +339,22 @@ GraphiteLayout::fillFrom(gr_segment * pSegment, ImplLayoutArgs &rArgs, float fSc
+                 {
+                     for (int i = nFirstCharInCluster; i <= nLastCharInCluster; i++)
+                     {
+-                        if (mnSegCharOffset + i >= mnEndCharPos)
++                        size_t ibase = gr_cinfo_base(gr_seg_cinfo(pSegment, i));
++                        if (mnSegCharOffset + ibase >= mnEndCharPos)
+                             break;
+                         // from the point of view of the dx array, the xpos is
+                         // the origin of the first glyph of the next cluster ltr
+-                        mvCharDxs[mnSegCharOffset + i - mnMinCharPos] =
++                        mvCharDxs[mnSegCharOffset + ibase - mnMinCharPos] =
+                             static_cast<int>(rightBoundary * fScaling) + nDxOffset;
+-                        mvCharBreaks[mnSegCharOffset + i - mnMinCharPos] = gr_cinfo_break_weight(gr_seg_cinfo(pSegment, i));
++                        mvCharBreaks[mnSegCharOffset + ibase - mnMinCharPos] = gr_cinfo_break_weight(gr_seg_cinfo(pSegment, i));
+                     }
+                     // only set mvChar2BaseGlyph for first character of cluster
+-                    mvChar2BaseGlyph[mnSegCharOffset + nFirstCharInCluster - mnMinCharPos] = nBaseGlyphIndex;
++                    mvChar2BaseGlyph[mnSegCharOffset + bFirstChar - mnMinCharPos] = nBaseGlyphIndex;
+                 }
+                 append(pSegment, rArgs, baseSlot, rightBoundary, fScaling,
+                        nDxOffset, true, mnSegCharOffset + firstChar);
+             }
+-            if (mnSegCharOffset + nFirstCharInCluster >= mnEndCharPos)
++            if (mnSegCharOffset + bFirstChar >= mnEndCharPos)
+                 break;
+             baseSlot = gr_slot_next_sibling_attachment(baseSlot);
+         }
+@@ -596,20 +598,23 @@ gr_segment * GraphiteLayout::CreateSegment(ImplLayoutArgs& rArgs)
+                     nSegCharLimit - rArgs.mnEndCharPos, bRtl);
+             }
+         }
+-
++        size_t numchars = gr_count_unicode_characters(gr_utf16, rArgs.mpStr + mnSegCharOffset, rArgs.mpStr + limit, NULL);
+         if (mpFeatures)
+             pSegment = gr_make_seg(mpFont, mpFace, 0, mpFeatures->values(), gr_utf16,
+-                                        rArgs.mpStr + mnSegCharOffset, limit - mnSegCharOffset, bRtl);
++                                        rArgs.mpStr + mnSegCharOffset, numchars, bRtl);
+         else
+             pSegment = gr_make_seg(mpFont, mpFace, 0, NULL, gr_utf16,
+-                                        rArgs.mpStr + mnSegCharOffset, limit - mnSegCharOffset, bRtl);
++                                        rArgs.mpStr + mnSegCharOffset, numchars, bRtl);
+ 
+         //pSegment = new gr::RangeSegment((gr::Font *)&mrFont, mpTextSrc, &maLayout, mnMinCharPos, limit);
+         if (pSegment != NULL)
+         {
+ #ifdef GRLAYOUT_DEBUG
+-            fprintf(grLog(),"Gr::LayoutText %d-%d, context %d,len%d rtl%d scaling %f\n", rArgs.mnMinCharPos,
+-               rArgs.mnEndCharPos, limit, rArgs.mnLength, bRtl, mfScaling);
++            fprintf(grLog(),"Gr::LayoutText %d-%d, context %d,len%d,numchars%d, rtl%d scaling %f:", rArgs.mnMinCharPos,
++               rArgs.mnEndCharPos, limit, rArgs.mnLength, numchars, bRtl, mfScaling);
++            for (int i = mnSegCharOffset; i < limit; ++i)
++                fprintf(grLog(), " %04X", rArgs.mpStr[i]);
++            fprintf(grLog(), "\n");
+ #endif
+         }
+         else
+-- 
+1.7.5.4
+
+
+From 4c2b93d96689f62c24ebdb2d4e87ac08d51ed53a Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?Lubo=C5=A1=20Lu=C5=88=C3=A1k?= <l.lunak@suse.cz>
+Date: Thu, 20 Oct 2011 14:41:50 +0000
+Subject: [libs-gui 5/7] let Qt call XInitThreads(), so that it knows it's
+ been called (fdo#40298)
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+Otherwise QPixmap complains when used outside of the main Qt thread
+and resets itself to null pixmap, eventually leading to crashes.
+
+Signed-off-by: Tomáš Chvátal <tchvatal@suse.cz>
+---
+ vcl/unx/kde4/main.cxx |   11 +++++++++++
+ 1 files changed, 11 insertions(+), 0 deletions(-)
+
+diff --git a/vcl/unx/kde4/main.cxx b/vcl/unx/kde4/main.cxx
+index 32561d9..4365ad6 100644
+--- vcl/unx/kde4/main.cxx
++++ vcl/unx/kde4/main.cxx
+@@ -54,7 +54,18 @@ extern "C" {
+            established, so protect X against itself
+         */
+         if( ! ( pNoXInitThreads && *pNoXInitThreads ) )
++        {
++#if QT_VERSION >= 0x040800
++            // let Qt call XInitThreads(), so that also Qt knows it's been used
++            // (otherwise QPixmap may warn about threads not being initialized)
++            QApplication::setAttribute( Qt::AA_X11InitThreads );
++#else
+             XInitThreads();
++            // just in case somebody builds with old version and then upgrades Qt,
++            // otherwise this is a no-op
++            QApplication::setAttribute( static_cast< Qt::ApplicationAttribute >( 10 ));
++#endif
++        }
+         
+ #if QT_VERSION < 0x050000
+         // Qt 4.x support needs >= 4.1.0
+-- 
+1.7.5.4
+
+
+From ee26becc4a5690840fd3181b71d293340853b58e Mon Sep 17 00:00:00 2001
+From: julien2412 <serval2412@yahoo.fr>
+Date: Mon, 24 Oct 2011 14:46:13 +0200
+Subject: [libs-gui 6/7] activation order crashes address database (fdo#41022)
+
+Signed-off-by: Petr Mladek <pmladek@suse.cz>
+---
+ toolkit/source/controls/stdtabcontroller.cxx |   13 ++++---------
+ 1 files changed, 4 insertions(+), 9 deletions(-)
+
+diff --git a/toolkit/source/controls/stdtabcontroller.cxx b/toolkit/source/controls/stdtabcontroller.cxx
+index d5c2f06..2fecd4d 100644
+--- toolkit/source/controls/stdtabcontroller.cxx
++++ toolkit/source/controls/stdtabcontroller.cxx
+@@ -262,6 +262,7 @@ void StdTabController::autoTabOrder(  ) throw(RuntimeException)
+     sal_uInt32 nCtrls = aCompSeq.getLength();
+     Reference< XWindow > * pComponents = aCompSeq.getArray();
+ 
++    // insert sort algorithm
+     ComponentEntryList aCtrls;
+     size_t n;
+     for ( n = 0; n < nCtrls; n++ )
+@@ -277,15 +278,9 @@ void StdTabController::autoTabOrder(  ) throw(RuntimeException)
+         for ( nPos = 0; nPos < aCtrls.size(); nPos++ )
+         {
+             ComponentEntry* pEntry = aCtrls[ nPos ];
+-            if ( pEntry->aPos.Y() >= pE->aPos.Y() )
+-            {
+-                while ( pEntry && ( pEntry->aPos.Y() == pE->aPos.Y() )
+-                                && ( pEntry->aPos.X() < pE->aPos.X() ) )
+-                {
+-                    pEntry = aCtrls[ ++nPos ];
+-                }
+-                break;
+-            }
++            if ( ( pEntry->aPos.Y() > pE->aPos.Y() ) ||
++                 ( ( pEntry->aPos.Y() == pE->aPos.Y() ) && ( pEntry->aPos.X() > pE->aPos.X() ) ) )
++                    break;
+         }
+         if ( nPos < aCtrls.size() ) {
+             ComponentEntryList::iterator it = aCtrls.begin();
+-- 
+1.7.5.4
+
+reverting on repository postprocess from libreoffice-3.4.3.2 to merge-base 22a81f64d484d9beacf7c8d76c95425d608605e1
+commits on repository postprocess merge-base 22a81f64d484d9beacf7c8d76c95425d608605e1 to libreoffice-3.4.4.1
+reverting on repository sdk from libreoffice-3.4.3.2 to merge-base b6eab2b683e2e2de6fd3dd3c048d562f244b05f2
+commits on repository sdk merge-base b6eab2b683e2e2de6fd3dd3c048d562f244b05f2 to libreoffice-3.4.4.1
+reverting on repository testing from libreoffice-3.4.3.2 to merge-base 48a319fa2efc7cc6d3a05b84279e4ba1e58393ec
+commits on repository testing merge-base 48a319fa2efc7cc6d3a05b84279e4ba1e58393ec to libreoffice-3.4.4.1
+reverting on repository ure from libreoffice-3.4.3.2 to merge-base b239d723d17f2da8de3af9d87065851f0ba449ad
+commits on repository ure merge-base b239d723d17f2da8de3af9d87065851f0ba449ad to libreoffice-3.4.4.1
+reverting on repository writer from libreoffice-3.4.3.2 to merge-base db129557dc8b24b3a6e2ab9bfce8748cb592b450
+diff --git a/sw/source/core/inc/cntfrm.hxx b/sw/source/core/inc/cntfrm.hxx
+index 5aab722..898715b 100644
+--- sw/source/core/inc/cntfrm.hxx
++++ sw/source/core/inc/cntfrm.hxx
+@@ -84,8 +84,6 @@ public:
+ 
+     inline const SwCntntFrm *GetFollow() const;
+     inline		 SwCntntFrm *GetFollow();
+-    inline const SwCntntFrm *GetPrecede() const;
+-    inline       SwCntntFrm *GetPrecede();
+     SwTxtFrm* FindMaster() const;
+ 
+         //Layoutabhaengiges Cursortravelling
+@@ -149,14 +147,6 @@ inline SwCntntFrm *SwCntntFrm::GetFollow()
+ {
+     return (SwCntntFrm*)SwFlowFrm::GetFollow();
+ }
+-inline const SwCntntFrm *SwCntntFrm::GetPrecede() const
+-{
+-    return (const SwCntntFrm*)SwFlowFrm::GetPrecede();
+-}
+-inline SwCntntFrm *SwCntntFrm::GetPrecede()
+-{
+-    return (SwCntntFrm*)SwFlowFrm::GetPrecede();
+-}
+ 
+ #endif
+ 
+diff --git a/sw/source/core/inc/flowfrm.hxx b/sw/source/core/inc/flowfrm.hxx
+index bc9557a..da3e5ca 100644
+--- sw/source/core/inc/flowfrm.hxx
++++ sw/source/core/inc/flowfrm.hxx
+@@ -115,7 +115,6 @@ class SwFlowFrm
+ protected:
+ 
+     SwFlowFrm *pFollow;
+-    SwFlowFrm *pPrecede;
+ 
+     sal_Bool bIsFollow	:1;	//Ist's ein Follow
+     sal_Bool bLockJoin	:1;	//Join (und damit deleten) verboten wenn sal_True!
+@@ -172,10 +171,7 @@ public:
+     const  SwFlowFrm *GetFollow() const	   { return pFollow;   }
+            SwFlowFrm *GetFollow()	   	   { return pFollow;   }
+            sal_Bool  	  IsAnFollow( const SwFlowFrm *pFlow ) const;
+-    inline void       SetFollow( SwFlowFrm *pNew );
+-
+-    const  SwFlowFrm *GetPrecede() const   { return pPrecede;   }
+-           SwFlowFrm *GetPrecede()         { return pPrecede;   }
++    inline void   	  SetFollow( SwFlowFrm *pNew ) { pFollow = pNew; }
+ 
+     sal_Bool IsJoinLocked() const { return bLockJoin; }
+     sal_Bool IsAnyJoinLocked() const { return bLockJoin || HasLockedFollow(); }
+@@ -253,12 +249,6 @@ inline sal_Bool SwFlowFrm::IsFwdMoveAllowed()
+     return rThis.GetIndPrev() != 0;
+ }
+ 
+-inline void SwFlowFrm::SetFollow( SwFlowFrm *pNew )
+-{
+-    pFollow = pNew;
+-    if ( pFollow != NULL )
+-        pFollow->pPrecede = this;
+-}
+ 
+ #endif
+ 
+diff --git a/sw/source/core/inc/sectfrm.hxx b/sw/source/core/inc/sectfrm.hxx
+index 20f68f6..f9f7a2e 100644
+--- sw/source/core/inc/sectfrm.hxx
++++ sw/source/core/inc/sectfrm.hxx
+@@ -128,10 +128,6 @@ public:
+ 
+     bool IsBalancedSection() const;
+ 
+-#if OSL_DEBUG_LEVEL > 1
+-    virtual void dumpAsXmlAttributes(xmlTextWriterPtr writer);
+-#endif
+-
+     DECL_FIXEDMEMPOOL_NEWDEL(SwSectionFrm)
+ };
+ 
+diff --git a/sw/source/core/inc/tabfrm.hxx b/sw/source/core/inc/tabfrm.hxx
+index 8e2e507..a81b25b 100644
+--- sw/source/core/inc/tabfrm.hxx
++++ sw/source/core/inc/tabfrm.hxx
+@@ -216,10 +216,6 @@ public:
+     sal_uInt16 GetBottomLineSize() const;
+     // <-- collapsing
+ 
+-#if OSL_DEBUG_LEVEL > 1
+-    virtual void dumpAsXmlAttributes(xmlTextWriterPtr writer);
+-#endif
+-
+     DECL_FIXEDMEMPOOL_NEWDEL(SwTabFrm)
+ };
+ 
+diff --git a/sw/source/core/layout/flowfrm.cxx b/sw/source/core/layout/flowfrm.cxx
+index 51cb49b..9ba8202 100644
+--- sw/source/core/layout/flowfrm.cxx
++++ sw/source/core/layout/flowfrm.cxx
+@@ -81,8 +81,7 @@ sal_Bool SwFlowFrm::bMoveBwdJump = sal_False;
+ 
+ SwFlowFrm::SwFlowFrm( SwFrm &rFrm ) :
+     rThis( rFrm ),
+-    pFollow( 0 ),
+-    pPrecede( 0 )
++    pFollow( 0 )
+ {
+     bLockJoin = bIsFollow = bCntntLock = bOwnFtnNum =
+         bFtnLock = bFlyLock = sal_False;
+@@ -692,12 +691,16 @@ SwTxtFrm* SwCntntFrm::FindMaster() const
+ {
+     OSL_ENSURE( IsFollow(), "SwCntntFrm::FindMaster(): !IsFollow" );
+ 
+-    const SwCntntFrm* pPrec = GetPrecede();
++    const SwCntntFrm* pCnt = GetPrevCntntFrm();
+ 
+-    if ( pPrec && pPrec->HasFollow() && pPrec->GetFollow() == this )
++    while ( pCnt )
+     {
+-        OSL_ENSURE( pPrec->IsTxtFrm(), "NoTxtFrm with follow found" );
+-        return ( SwTxtFrm* )pPrec;
++        if ( pCnt->HasFollow() && pCnt->GetFollow() == this )
++        {
++            OSL_ENSURE( pCnt->IsTxtFrm(), "NoTxtFrm with follow found" );
++            return (SwTxtFrm*)pCnt;
++        }
++        pCnt = pCnt->GetPrevCntntFrm();
+     }
+ 
+     OSL_FAIL( "Follow ist lost in Space." );
+diff --git a/sw/source/core/text/xmldump.cxx b/sw/source/core/text/xmldump.cxx
+index 2d76660..3209fba 100644
+--- sw/source/core/text/xmldump.cxx
++++ sw/source/core/text/xmldump.cxx
+@@ -29,8 +29,6 @@
+ #include "precompiled_sw.hxx"
+ 
+ #include "frame.hxx"
+-#include "sectfrm.hxx"
+-#include "tabfrm.hxx"
+ #include "txtfrm.hxx"
+ #include "porlin.hxx"
+ #include "porlay.hxx"
+@@ -313,29 +311,6 @@ void SwTxtFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
+     SwFrm::dumpAsXmlAttributes( writer );
+     if ( HasFollow() )
+         xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
+-
+-    if ( pPrecede != NULL )
+-        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwTxtFrm*)pPrecede );
+-}
+-
+-void SwSectionFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
+-{
+-    SwFrm::dumpAsXmlAttributes( writer );
+-    if ( HasFollow() )
+-        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
+-
+-    if ( pPrecede != NULL )
+-        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwSectionFrm*)pPrecede );
+-}
+-
+-void SwTabFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
+-{
+-    SwFrm::dumpAsXmlAttributes( writer );
+-    if ( HasFollow() )
+-        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
+-
+-    if ( pPrecede != NULL )
+-        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwTabFrm*)pPrecede );
+ }
+ 
+ #endif
+commits on repository writer merge-base db129557dc8b24b3a6e2ab9bfce8748cb592b450 to libreoffice-3.4.4.1
+From 68b27b713285ddee7b44bb9f57e01066e28eb1b1 Mon Sep 17 00:00:00 2001
+From: =?UTF-8?q?C=C3=A9dric=20Bosdonnat?= <cedric.bosdonnat.ooo@free.fr>
+Date: Tue, 23 Aug 2011 11:36:42 +0200
+Subject: [writer 1/7] cherry-picked core:cc3d0d and fixed a few things
+
+---
+ sw/source/core/inc/cntfrm.hxx     |   10 ++++++++++
+ sw/source/core/inc/flowfrm.hxx    |   12 +++++++++++-
+ sw/source/core/inc/sectfrm.hxx    |    4 ++++
+ sw/source/core/inc/tabfrm.hxx     |    4 ++++
+ sw/source/core/layout/flowfrm.cxx |   15 ++++++---------
+ sw/source/core/text/xmldump.cxx   |   25 +++++++++++++++++++++++++
+ 6 files changed, 60 insertions(+), 10 deletions(-)
+
+diff --git a/sw/source/core/inc/cntfrm.hxx b/sw/source/core/inc/cntfrm.hxx
+index 898715b..5aab722 100644
+--- sw/source/core/inc/cntfrm.hxx
++++ sw/source/core/inc/cntfrm.hxx
+@@ -84,6 +84,8 @@ public:
+ 
+     inline const SwCntntFrm *GetFollow() const;
+     inline		 SwCntntFrm *GetFollow();
++    inline const SwCntntFrm *GetPrecede() const;
++    inline       SwCntntFrm *GetPrecede();
+     SwTxtFrm* FindMaster() const;
+ 
+         //Layoutabhaengiges Cursortravelling
+@@ -147,6 +149,14 @@ inline SwCntntFrm *SwCntntFrm::GetFollow()
+ {
+     return (SwCntntFrm*)SwFlowFrm::GetFollow();
+ }
++inline const SwCntntFrm *SwCntntFrm::GetPrecede() const
++{
++    return (const SwCntntFrm*)SwFlowFrm::GetPrecede();
++}
++inline SwCntntFrm *SwCntntFrm::GetPrecede()
++{
++    return (SwCntntFrm*)SwFlowFrm::GetPrecede();
++}
+ 
+ #endif
+ 
+diff --git a/sw/source/core/inc/flowfrm.hxx b/sw/source/core/inc/flowfrm.hxx
+index da3e5ca..bc9557a 100644
+--- sw/source/core/inc/flowfrm.hxx
++++ sw/source/core/inc/flowfrm.hxx
+@@ -115,6 +115,7 @@ class SwFlowFrm
+ protected:
+ 
+     SwFlowFrm *pFollow;
++    SwFlowFrm *pPrecede;
+ 
+     sal_Bool bIsFollow	:1;	//Ist's ein Follow
+     sal_Bool bLockJoin	:1;	//Join (und damit deleten) verboten wenn sal_True!
+@@ -171,7 +172,10 @@ public:
+     const  SwFlowFrm *GetFollow() const	   { return pFollow;   }
+            SwFlowFrm *GetFollow()	   	   { return pFollow;   }
+            sal_Bool  	  IsAnFollow( const SwFlowFrm *pFlow ) const;
+-    inline void   	  SetFollow( SwFlowFrm *pNew ) { pFollow = pNew; }
++    inline void       SetFollow( SwFlowFrm *pNew );
++
++    const  SwFlowFrm *GetPrecede() const   { return pPrecede;   }
++           SwFlowFrm *GetPrecede()         { return pPrecede;   }
+ 
+     sal_Bool IsJoinLocked() const { return bLockJoin; }
+     sal_Bool IsAnyJoinLocked() const { return bLockJoin || HasLockedFollow(); }
+@@ -249,6 +253,12 @@ inline sal_Bool SwFlowFrm::IsFwdMoveAllowed()
+     return rThis.GetIndPrev() != 0;
+ }
+ 
++inline void SwFlowFrm::SetFollow( SwFlowFrm *pNew )
++{
++    pFollow = pNew;
++    if ( pFollow != NULL )
++        pFollow->pPrecede = this;
++}
+ 
+ #endif
+ 
+diff --git a/sw/source/core/inc/sectfrm.hxx b/sw/source/core/inc/sectfrm.hxx
+index f9f7a2e..20f68f6 100644
+--- sw/source/core/inc/sectfrm.hxx
++++ sw/source/core/inc/sectfrm.hxx
+@@ -128,6 +128,10 @@ public:
+ 
+     bool IsBalancedSection() const;
+ 
++#if OSL_DEBUG_LEVEL > 1
++    virtual void dumpAsXmlAttributes(xmlTextWriterPtr writer);
++#endif
++
+     DECL_FIXEDMEMPOOL_NEWDEL(SwSectionFrm)
+ };
+ 
+diff --git a/sw/source/core/inc/tabfrm.hxx b/sw/source/core/inc/tabfrm.hxx
+index a81b25b..8e2e507 100644
+--- sw/source/core/inc/tabfrm.hxx
++++ sw/source/core/inc/tabfrm.hxx
+@@ -216,6 +216,10 @@ public:
+     sal_uInt16 GetBottomLineSize() const;
+     // <-- collapsing
+ 
++#if OSL_DEBUG_LEVEL > 1
++    virtual void dumpAsXmlAttributes(xmlTextWriterPtr writer);
++#endif
++
+     DECL_FIXEDMEMPOOL_NEWDEL(SwTabFrm)
+ };
+ 
+diff --git a/sw/source/core/layout/flowfrm.cxx b/sw/source/core/layout/flowfrm.cxx
+index 9ba8202..51cb49b 100644
+--- sw/source/core/layout/flowfrm.cxx
++++ sw/source/core/layout/flowfrm.cxx
+@@ -81,7 +81,8 @@ sal_Bool SwFlowFrm::bMoveBwdJump = sal_False;
+ 
+ SwFlowFrm::SwFlowFrm( SwFrm &rFrm ) :
+     rThis( rFrm ),
+-    pFollow( 0 )
++    pFollow( 0 ),
++    pPrecede( 0 )
+ {
+     bLockJoin = bIsFollow = bCntntLock = bOwnFtnNum =
+         bFtnLock = bFlyLock = sal_False;
+@@ -691,16 +692,12 @@ SwTxtFrm* SwCntntFrm::FindMaster() const
+ {
+     OSL_ENSURE( IsFollow(), "SwCntntFrm::FindMaster(): !IsFollow" );
+ 
+-    const SwCntntFrm* pCnt = GetPrevCntntFrm();
++    const SwCntntFrm* pPrec = GetPrecede();
+ 
+-    while ( pCnt )
++    if ( pPrec && pPrec->HasFollow() && pPrec->GetFollow() == this )
+     {
+-        if ( pCnt->HasFollow() && pCnt->GetFollow() == this )
+-        {
+-            OSL_ENSURE( pCnt->IsTxtFrm(), "NoTxtFrm with follow found" );
+-            return (SwTxtFrm*)pCnt;
+-        }
+-        pCnt = pCnt->GetPrevCntntFrm();
++        OSL_ENSURE( pPrec->IsTxtFrm(), "NoTxtFrm with follow found" );
++        return ( SwTxtFrm* )pPrec;
+     }
+ 
+     OSL_FAIL( "Follow ist lost in Space." );
+diff --git a/sw/source/core/text/xmldump.cxx b/sw/source/core/text/xmldump.cxx
+index 3209fba..2d76660 100644
+--- sw/source/core/text/xmldump.cxx
++++ sw/source/core/text/xmldump.cxx
+@@ -29,6 +29,8 @@
+ #include "precompiled_sw.hxx"
+ 
+ #include "frame.hxx"
++#include "sectfrm.hxx"
++#include "tabfrm.hxx"
+ #include "txtfrm.hxx"
+ #include "porlin.hxx"
+ #include "porlay.hxx"
+@@ -311,6 +313,29 @@ void SwTxtFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
+     SwFrm::dumpAsXmlAttributes( writer );
+     if ( HasFollow() )
+         xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
++
++    if ( pPrecede != NULL )
++        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwTxtFrm*)pPrecede );
++}
++
++void SwSectionFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
++{
++    SwFrm::dumpAsXmlAttributes( writer );
++    if ( HasFollow() )
++        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
++
++    if ( pPrecede != NULL )
++        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwSectionFrm*)pPrecede );
++}
++
++void SwTabFrm::dumpAsXmlAttributes( xmlTextWriterPtr writer )
++{
++    SwFrm::dumpAsXmlAttributes( writer );
++    if ( HasFollow() )
++        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "follow" ), "%p", GetFollow() );
++
++    if ( pPrecede != NULL )
++        xmlTextWriterWriteFormatAttribute( writer, BAD_CAST( "precede" ), "%p", (SwTabFrm*)pPrecede );
+ }
+ 
+ #endif
+-- 
+1.7.5.4
+
+
+From ab04c2969ab134ed5131f5777b05d8e5fe9a4d18 Mon Sep 17 00:00:00 2001
+From: Takeshi Abe <tabe@fixedpoint.jp>
+Date: Wed, 24 Aug 2011 16:33:04 +0100
+Subject: [writer 2/7] fdo#40341: hide 'math baseline alignment' unless
+ available
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+Signed-off-by: Caolán McNamara <caolanm@redhat.com>
+---
+ sw/source/ui/config/optpage.cxx |   16 +++++++++++-----
+ 1 files changed, 11 insertions(+), 5 deletions(-)
+
+diff --git a/sw/source/ui/config/optpage.cxx b/sw/source/ui/config/optpage.cxx
+index 4602efe..d941013 100644
+--- sw/source/ui/config/optpage.cxx
++++ sw/source/ui/config/optpage.cxx
+@@ -1456,9 +1456,11 @@ sal_Bool SwShdwCrsrOptionsTabPage::FillItemSet( SfxItemSet& rSet )
+         bRet = sal_True;
+     }
+ 
+-    m_pWrtShell->GetDoc()->set( IDocumentSettingAccess::MATH_BASELINE_ALIGNMENT, 
+-            m_aMathBaselineAlignmentCB.IsChecked() );
+-    bRet |= m_aMathBaselineAlignmentCB.IsChecked() != m_aMathBaselineAlignmentCB.GetSavedValue();
++    if (m_pWrtShell) {
++        m_pWrtShell->GetDoc()->set( IDocumentSettingAccess::MATH_BASELINE_ALIGNMENT,
++                m_aMathBaselineAlignmentCB.IsChecked() );
++        bRet |= m_aMathBaselineAlignmentCB.IsChecked() != m_aMathBaselineAlignmentCB.GetSavedValue();
++    }
+ 
+     if( aCrsrInProtCB.IsChecked() != aCrsrInProtCB.GetSavedValue())
+     {
+@@ -1505,8 +1507,12 @@ void SwShdwCrsrOptionsTabPage::Reset( const SfxItemSet& rSet )
+     aFillTabRB.Check( FILL_TAB == eMode );
+     aFillSpaceRB.Check( FILL_SPACE == eMode );
+ 
+-    m_aMathBaselineAlignmentCB.Check( m_pWrtShell->GetDoc()->get( IDocumentSettingAccess::MATH_BASELINE_ALIGNMENT ) );
+-    m_aMathBaselineAlignmentCB.SaveValue();
++    if (m_pWrtShell) {
++        m_aMathBaselineAlignmentCB.Check( m_pWrtShell->GetDoc()->get( IDocumentSettingAccess::MATH_BASELINE_ALIGNMENT ) );
++        m_aMathBaselineAlignmentCB.SaveValue();
++    } else {
++        m_aMathBaselineAlignmentCB.Hide();
++    }
+ 
+     if( SFX_ITEM_SET == rSet.GetItemState( FN_PARAM_CRSR_IN_PROTECTED, sal_False, &pItem ))
+         aCrsrInProtCB.Check(((const SfxBoolItem*)pItem)->GetValue());
+-- 
+1.7.5.4
+
+
+From c3fd04cda937b9896b5abe6f32a1de459317e8a5 Mon Sep 17 00:00:00 2001
+From: Andor Ertsey <andor.ertsey@muenchen.de>
+Date: Sun, 4 Sep 2011 11:43:45 +0200
+Subject: [writer 3/7] Fix leak in pdf export.
+MIME-Version: 1.0
+Content-Type: text/plain; charset=UTF-8
+Content-Transfer-Encoding: 8bit
+
+This fixes i#116448 - SwViewOption was allocated but never freed
+during pdf export - killed mass document exporting via OOM
+eventually.
+
+Signed-off-by: Caolán McNamara <caolanm@redhat.com>
+---
+ sw/source/ui/app/swmodul1.cxx |    2 ++
+ 1 files changed, 2 insertions(+), 0 deletions(-)
+
+diff --git a/sw/source/ui/app/swmodul1.cxx b/sw/source/ui/app/swmodul1.cxx
+index 1429bc1..82db1af 100644
+--- sw/source/ui/app/swmodul1.cxx
++++ sw/source/ui/app/swmodul1.cxx
+@@ -220,6 +220,8 @@ void SwModule::ApplyUsrPref(const SwViewOption &rUsrPref, SwView* pActView,
+ 
+     // in the end the Idle-Flag is set again
+     pPref->SetIdle(sal_True);
++
++    delete pViewOpt;
+ }
+ 
+ void SwModule::ApplyUserMetric( FieldUnit eMetric, sal_Bool bWeb )
+-- 
+1.7.5.4
+
+
+From a0b3fc96fe985068fc794646570a0f74568941ec Mon Sep 17 00:00:00 2001
+From: Ivan Timofeev <timofeev.i.s@gmail.com>
+Date: Wed, 21 Sep 2011 11:57:47 +0100
+Subject: [writer 4/7] Fix for fdo#35513: avoid crash while processing
+ incorrect range of pages
+
+Signed-off-by: Michael Meeks <michael.meeks@novell.com>
+---
+ sw/source/core/doc/doc.cxx |    5 ++++-
+ 1 files changed, 4 insertions(+), 1 deletions(-)
+
+diff --git a/sw/source/core/doc/doc.cxx b/sw/source/core/doc/doc.cxx
+index 0086fc9..369594a 100644
+--- sw/source/core/doc/doc.cxx
++++ sw/source/core/doc/doc.cxx
+@@ -1628,7 +1628,10 @@ void SwDoc::CalculatePagePairsForProspectPrinting(
+     std::vector< sal_Int32 > aPagesToPrint;
+     StringRangeEnumerator::getRangesFromString( 
+             aPageRange, aPagesToPrint, 1, nDocPageCount, 0 );
+-    
++
++    if (aPagesToPrint.empty())
++        return;
++
+     // now fill the vector for calculating the page pairs with the start frames
+     // from the above obtained vector
+     std::vector< const SwPageFrm * > aVec;
+-- 
+1.7.5.4
+
+
+From f8f5d96666bff5051cc88d06b10d855548a441de Mon Sep 17 00:00:00 2001
+From: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+Date: Thu, 22 Sep 2011 18:47:21 +0200
+Subject: [writer 5/7] fdo#39510 lp#854626: crash on closing document with
+ footnotes
+
+Signed-off-by: Michael Stahl <mst@openoffice.org>
+---
+ sw/source/core/layout/newfrm.cxx |    1 +
+ 1 files changed, 1 insertions(+), 0 deletions(-)
+
+diff --git a/sw/source/core/layout/newfrm.cxx b/sw/source/core/layout/newfrm.cxx
+index 86eefcb..7f19c1a 100644
+--- sw/source/core/layout/newfrm.cxx
++++ sw/source/core/layout/newfrm.cxx
+@@ -607,6 +607,7 @@ SwRootFrm::~SwRootFrm()
+ {
+     bTurboAllowed = sal_False;
+     pTurbo = 0;
++    AllRemoveFtns();
+     if(pBlink)
+         pBlink->FrmDelete( this );
+     if ( static_cast<SwFrmFmt*>(GetRegisteredInNonConst()) )
+-- 
+1.7.5.4
+
+
+From 6a3faed5b459ea133c39ef5243dad8e366ca00c3 Mon Sep 17 00:00:00 2001
+From: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
+Date: Fri, 23 Sep 2011 01:13:34 +0200
+Subject: [writer 6/7] fdo#39510: comment added
+
+Signed-off-by: Michael Stahl <mst@openoffice.org>
+---
+ sw/source/core/layout/newfrm.cxx |   10 ++++++++++
+ 1 files changed, 10 insertions(+), 0 deletions(-)
+
+diff --git a/sw/source/core/layout/newfrm.cxx b/sw/source/core/layout/newfrm.cxx
+index 7f19c1a..3943336 100644
+--- sw/source/core/layout/newfrm.cxx
++++ sw/source/core/layout/newfrm.cxx
+@@ -607,7 +607,17 @@ SwRootFrm::~SwRootFrm()
+ {
+     bTurboAllowed = sal_False;
+     pTurbo = 0;
++    // fdo#39510 crash on document close with footnotes
++    // Object ownership in writer and esp. in layout are a mess: Before the
++    // document/layout split SwDoc and SwRootFrm were essentially one object
++    // and magically/uncleanly worked around their common destruction by call
++    // to SwDoc::IsInDtor() -- even from the layout. As of now destuction of
++    // the layout proceeds forward through the frames. Since SwTxtFtn::DelFrms
++    // also searches backwards to find the master of footnotes, they must be
++    // considered to be owned by the SwRootFrm and also be destroyed here,
++    // before tearing down the (now footnote free) rest of the layout.
+     AllRemoveFtns();
++
+     if(pBlink)
+         pBlink->FrmDelete( this );
+     if ( static_cast<SwFrmFmt*>(GetRegisteredInNonConst()) )
+-- 
+1.7.5.4
+
